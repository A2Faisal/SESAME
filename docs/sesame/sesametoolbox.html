<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.3"/>
    <title>SESAME API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#point_2_grid">point_2_grid</a>
            </li>
            <li>
                    <a class="function" href="#line_2_grid">line_2_grid</a>
            </li>
            <li>
                    <a class="function" href="#poly_2_grid">poly_2_grid</a>
            </li>
            <li>
                    <a class="function" href="#grid_2_grid">grid_2_grid</a>
            </li>
            <li>
                    <a class="function" href="#table_2_grid">table_2_grid</a>
            </li>
            <li>
                    <a class="function" href="#grid_2_table">grid_2_table</a>
            </li>
            <li>
                    <a class="function" href="#get_netcdf_info">get_netcdf_info</a>
            </li>
            <li>
                    <a class="function" href="#add_iso3_column">add_iso3_column</a>
            </li>
            <li>
                    <a class="function" href="#plot_histogram">plot_histogram</a>
            </li>
            <li>
                    <a class="function" href="#plot_scatter">plot_scatter</a>
            </li>
            <li>
                    <a class="function" href="#plot_time_series">plot_time_series</a>
            </li>
            <li>
                    <a class="function" href="#plot_hexbin">plot_hexbin</a>
            </li>
            <li>
                    <a class="function" href="#plot_map">plot_map</a>
            </li>
            <li>
                    <a class="function" href="#plot_country">plot_country</a>
            </li>
            <li>
                    <a class="function" href="#sum_variables">sum_variables</a>
            </li>
            <li>
                    <a class="function" href="#subtract_variables">subtract_variables</a>
            </li>
            <li>
                    <a class="function" href="#divide_variables">divide_variables</a>
            </li>
            <li>
                    <a class="function" href="#multiply_variables">multiply_variables</a>
            </li>
            <li>
                    <a class="function" href="#average_variables">average_variables</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">SESAME</h1>

                
                        <input id="mod-sesametoolbox-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-sesametoolbox-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span> <span class="nn">json</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">create</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">utils</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">calculate</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">plot</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">get</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="k">def</span> <span class="nf">point_2_grid</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;value/grid-cell&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="n">attr_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="w">    </span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">    Converts point data from a shapefile or GeoDataFrame into a gridded netCDF dataset.</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="sd">    Parameters</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="sd">    ----------</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="sd">    - points : GeoDataFrame or str</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd">        Input point data to be gridded. Can be either a GeoDataFrame or a path to a point shapefile (.shp).</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="sd">    - variable_name : str, optional</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">        Name of the variable to include in the netCDF attributes metadata. Defaults to:</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">        - The unique entries in the `attr_field` column if specified.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="sd">        - The input filename without extension if `attr_field` and `variable_name` are not specified.</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">    - long_name : str, optional</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">        A descriptive name for the variable, added to the netCDF metadata. Behaves the same as `variable_name` if</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">        `attr_field` is specified. Defaults to the input filename without extension if unspecified.</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">    - units : str, optional</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">        Units of the data variable to include in the netCDF metadata. Default is &quot;value/grid-cell&quot;.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">    - source : str, optional</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">        String describing the original source of the input data. This will be added to the netCDF metadata.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">    - time : str, optional</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">        Time dimension for the output netCDF. If specified, the output will include a time dimension with the</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">        value provided. Default is None (spatial, 2D netCDF output).</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">    - resolution : float, optional</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">        Desired resolution for the grid cells in the output dataset. Default is 1 degree.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">    - agg_column : str, optional</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">        Column name in the shapefile or GeoDataFrame specifying the values to aggregate in each grid cell.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">        Defaults to counting the number of points per grid cell.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">    - agg_function : str, optional</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">        Aggregation method for combining values in each grid cell. Options include:</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">        - &#39;sum&#39; (default): Sums all point values.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">        - &#39;max&#39;: Takes the maximum value.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">        - &#39;min&#39;: Takes the minimum value.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">        - &#39;std&#39;: Computes the standard deviation.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">    - attr_field : str, optional</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">        Column name in the shapefile or GeoDataFrame specifying the variable names for multiple data types.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">    - output_directory : str, optional</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">        Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">    - output_filename : str, optional</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">        Name of the output NetCDF file (without the `.nc` extension). If not provided:</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">        - Uses the input shapefile name if a shapefile path is given.</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">        - Saves as `&quot;gridded_points.nc&quot;` if a GeoDataFrame is provided as input.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="sd">    - normalize_by_area : bool, optional</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="sd">        If True, normalizes the grid values by area (e.g., converts to value per square meter). Default is False.</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">    - zero_is_value : bool, optional</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="sd">        If True, treats zero values as valid data rather than as no-data. Default is False.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">    - verbose : bool, optional</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">        If True, prints information about the process, such as global sum of values before and after gridding. Default is False.</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">    Returns</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="sd">    -------</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">    netCDF file</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">        Transformed netCDF file with gridded data derived from the input point data.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">    Notes</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">    -----</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">    - The function supports input in the form of a shapefile or GeoDataFrame containing point data.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">    - If points lie exactly on a grid boundary, they are shifted by 0.0001 degrees in both latitude and longitude to ensure assignment to a grid cell.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">    - The function creates a netCDF file, where data variables are aggregated based on the `agg_column` and `agg_function`.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">    </span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">    Example</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">    -------</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">    &gt;&gt;&gt; point_2_grid(points=shapefile_path, </span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">    ...             variable_name=&quot;airplanes&quot;, </span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">    ...             long_name=Airplanes Count&quot;, </span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">    ...             units=&quot;airport/grid-cell&quot;, </span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">    ...             source=&quot;CIA&quot;, </span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">    ...             resolution=1,</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">    ...             verbose=True</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">    ... )</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">    </span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>    <span class="c1"># Determine if input is a path (string or Path) or a GeoDataFrame</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading shapefile from path...&quot;</span><span class="p">)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>        <span class="n">points_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>        <span class="n">points_gdf</span> <span class="o">=</span> <span class="n">points</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input must be a GeoDataFrame or a shapefile path (string or Path).&quot;</span><span class="p">)</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>    <span class="c1"># create gridded polygon</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>    <span class="n">polygons_gdf</span> <span class="o">=</span> <span class="n">create</span><span class="o">.</span><span class="n">create_gridded_polygon</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">out_polygon_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_area</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>    
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>    <span class="k">if</span> <span class="n">attr_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>        <span class="n">unique_rows</span> <span class="o">=</span> <span class="n">points_gdf</span><span class="p">[</span><span class="n">attr_field</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>        <span class="n">dataset_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>        
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>        <span class="k">for</span> <span class="n">filter_var</span> <span class="ow">in</span> <span class="n">unique_rows</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>            <span class="c1"># Filter the GeoDataFrame</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>            <span class="n">filtered_gdf</span> <span class="o">=</span> <span class="n">points_gdf</span><span class="p">[</span><span class="n">points_gdf</span><span class="p">[</span><span class="n">attr_field</span><span class="p">]</span> <span class="o">==</span> <span class="n">filter_var</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>            <span class="n">joined_gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">point_spatial_join</span><span class="p">(</span><span class="n">polygons_gdf</span><span class="p">,</span> <span class="n">filtered_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>            <span class="c1"># Determine agg_column, long_name, and units for the current iteration</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>            <span class="n">current_agg_column</span> <span class="o">=</span> <span class="n">agg_column</span> <span class="ow">or</span> <span class="s2">&quot;count&quot;</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>            <span class="n">current_long_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">reverse_replace_special_characters</span><span class="p">(</span><span class="n">filter_var</span><span class="p">)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>            <span class="n">current_units</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_units_point</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="p">)</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>            <span class="c1"># Convert joined GeoDataFrame to xarray dataset</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>            <span class="n">ds_var</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gridded_poly_2_xarray</span><span class="p">(</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>                <span class="n">polygon_gdf</span><span class="o">=</span><span class="n">joined_gdf</span><span class="p">,</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>                <span class="n">grid_value</span><span class="o">=</span><span class="n">current_agg_column</span><span class="p">,</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>                <span class="n">long_name</span><span class="o">=</span><span class="n">current_long_name</span><span class="p">,</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>                <span class="n">units</span><span class="o">=</span><span class="n">current_units</span><span class="p">,</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>                <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>                <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>                <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>                <span class="n">variable_name</span><span class="o">=</span><span class="n">filter_var</span><span class="p">,</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>                <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>                <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>            <span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>            <span class="c1"># Print or process verbose information</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>                <span class="n">global_summary_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataframe_stats_point</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">filtered_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">current_agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats of </span><span class="si">{</span><span class="n">filter_var</span><span class="si">}</span><span class="s2"> before gridding : </span><span class="si">{</span><span class="n">global_summary_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>                <span class="n">var_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">replace_special_characters</span><span class="p">(</span><span class="n">filter_var</span><span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>                <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds_var</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">var_name</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats of </span><span class="si">{</span><span class="n">filter_var</span><span class="si">}</span><span class="s2"> after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>            <span class="n">dataset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds_var</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>        
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>        <span class="c1"># Merge all datasets from different filtered GeoDataFrames</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataset_list</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>        
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>        <span class="n">joined_gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">point_spatial_join</span><span class="p">(</span><span class="n">polygons_gdf</span><span class="p">,</span> <span class="n">points_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>        <span class="c1"># Determine agg_column, long_name, and units</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>        <span class="n">agg_column</span> <span class="o">=</span> <span class="n">agg_column</span> <span class="ow">or</span> <span class="s2">&quot;count&quot;</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>        <span class="n">long_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_long_name_point</span><span class="p">(</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">long_name</span><span class="p">,</span> <span class="n">agg_function</span><span class="p">)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>        <span class="n">units</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_units_point</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>        
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gridded_poly_2_xarray</span><span class="p">(</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>            <span class="n">polygon_gdf</span><span class="o">=</span><span class="n">joined_gdf</span><span class="p">,</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>            <span class="n">grid_value</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>            <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">,</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>            <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>            <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>            <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>            <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>            <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>            <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>        <span class="p">)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>            <span class="n">global_summary_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataframe_stats_point</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">points_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats before gridding : </span><span class="si">{</span><span class="n">global_summary_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>            <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>    
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>    <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">or</span> <span class="n">output_filename</span><span class="p">:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>        <span class="c1"># Set output directory</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_directory</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>        <span class="c1"># Set base filename</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>        <span class="n">base_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">points</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">))</span> <span class="k">else</span> <span class="s2">&quot;gridded_points&quot;</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>        <span class="c1"># Set output filename</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">output_filename</span> <span class="ow">or</span> <span class="n">base_filename</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>        <span class="c1"># save the xarray dataset</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>        <span class="n">utils</span><span class="o">.</span><span class="n">save_to_nc</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">base_filename</span><span class="o">=</span><span class="n">base_filename</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="k">def</span> <span class="nf">line_2_grid</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;meter/grid-cell&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="n">attr_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="w">    </span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="sd">    Converts line data from a shapefile or GeoDataFrame into a gridded netCDF dataset.</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="sd">    Parameters</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="sd">    ----------</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="sd">    - lines : GeoDataFrame or str</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="sd">        Input lines data to be gridded. Can be either a GeoDataFrame or a path to a line/polyline shapefile (.shp).</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">    - variable_name : str, optional</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">        Name of the variable to include in the netCDF attributes metadata. Defaults to:</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">        - The unique entries in the `attr_field` column if specified.</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">        - The input filename without extension if `attr_field` and `variable_name` are not specified.</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">    - long_name : str, optional</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="sd">        A descriptive name for the variable, added to the netCDF metadata. Behaves the same as `variable_name` if</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">        `attr_field` is specified. Defaults to the input filename without extension if unspecified.</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">    - units : str, optional</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="sd">        Units of the data variable to include in the netCDF metadata. Default is &quot;meter/grid-cell&quot;.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="sd">    - source : str, optional</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">        String describing the original source of the input data. This will be added to the netCDF metadata.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">    - time : str, optional</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="sd">        Time dimension for the output netCDF. If specified, the output will include a time dimension with the</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">        value provided. Default is None (spatial, 2D netCDF output).</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">    - resolution : float, optional</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">        Desired resolution for the grid cells in the output dataset. Default is 1 degree.</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">    - agg_column : str, optional</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">        Column name in the shapefile or GeoDataFrame specifying the values to aggregate in each grid cell.</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">        Defaults to summing the lengths of intersected lines per grid cell.</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="sd">    - agg_function : str, optional</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">        Aggregation method for combining values in each grid cell. Options include:</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="sd">        - &#39;sum&#39; (default): Sums all line values.</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">        - &#39;max&#39;: Takes the maximum value.</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">        - &#39;min&#39;: Takes the minimum value.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="sd">        - &#39;std&#39;: Computes the standard deviation.</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">    - attr_field : str, optional</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">        Column name in the shapefile or GeoDataFrame specifying the variable names for multiple data types.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">    - output_directory : str, optional</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">        Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">    - output_filename : str, optional</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">        Name of the output NetCDF file (without the `.nc` extension). If not provided:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">        - Uses the input shapefile name if a shapefile path is given.</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">        - Saves as `&quot;gridded_lines.nc&quot;` if a GeoDataFrame is provided as input.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">    - normalize_by_area : bool, optional</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">        If True, normalizes the variable in each grid cell by the area of the grid cell (e.g., converts to value per square meter). Default is False.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">    - zero_is_value : bool, optional</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">        If True, treats zero values as valid data rather than as no-data. Default is False.</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">    - verbose : bool, optional</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="sd">        If True, prints information about the process, such as global sum of values before and after gridding. Default is False.</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">    Returns</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">    -------</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">    - xarray.Dataset, Transformed netCDF file with gridded data derived from the input line data.</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">    Notes</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="sd">    -----</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">    - The function supports input in the form of a shapefile or GeoDataFrame containing line data.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">    - Line lengths are calculated and aggregated based on the specified `agg_column` and `agg_function`.</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="sd">    - If lines intersect a grid boundary, their contributions are divided proportionally among the intersected grid cells.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="sd">    - The function creates a netCDF file, where data variables are aggregated and stored with metadata.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">    </span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">    Example</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">    -------</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">    &gt;&gt;&gt; line_2_grid(lines=shapefile_path, </span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">    ...             variable_name=&quot;roads&quot;, </span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">    ...             long_name=&quot;Roads Length&quot;, </span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">    ...             units=&quot;meter/grid-cell&quot;, </span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">    ...             source=&quot;OpenStreetMap&quot;, </span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">    ...             time=None, </span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">    ...             resolution=1,</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">    ...             agg_function=&quot;sum&quot;, </span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="sd">    ...             verbose=True)</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">    ... )</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">        </span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>    <span class="c1"># Determine if input is a path (string or Path) or a GeoDataFrame</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading shapefile from path...&quot;</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>        <span class="n">lines_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>        <span class="n">lines_gdf</span> <span class="o">=</span> <span class="n">lines</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input must be a GeoDataFrame or a shapefile path (string or Path).&quot;</span><span class="p">)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>    <span class="c1"># create gridded polygon</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>    <span class="n">polygons_gdf</span> <span class="o">=</span> <span class="n">create</span><span class="o">.</span><span class="n">create_gridded_polygon</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">out_polygon_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_area</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>    
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>    <span class="k">if</span> <span class="n">attr_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>        <span class="n">unique_rows</span> <span class="o">=</span> <span class="n">lines_gdf</span><span class="p">[</span><span class="n">attr_field</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>        <span class="n">dataset_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>        
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>        <span class="k">for</span> <span class="n">filter_var</span> <span class="ow">in</span> <span class="n">unique_rows</span><span class="p">:</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>            <span class="c1"># Filter the GeoDataFrame</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>            <span class="n">filtered_gdf</span> <span class="o">=</span> <span class="n">lines_gdf</span><span class="p">[</span><span class="n">lines_gdf</span><span class="p">[</span><span class="n">attr_field</span><span class="p">]</span> <span class="o">==</span> <span class="n">filter_var</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>            <span class="n">joined_gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">line_intersect</span><span class="p">(</span><span class="n">polygons_gdf</span><span class="p">,</span> <span class="n">filtered_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>            <span class="c1"># Determine agg_column, long_name, and units for the current iteration</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>            <span class="n">current_agg_column</span> <span class="o">=</span> <span class="n">agg_column</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;length_</span><span class="si">{</span><span class="n">agg_function</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>            <span class="n">current_long_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">reverse_replace_special_characters</span><span class="p">(</span><span class="n">filter_var</span><span class="p">)</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>            <span class="n">current_units</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_units_line</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>            <span class="c1"># Convert joined GeoDataFrame to xarray dataset</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>            <span class="n">ds_var</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gridded_poly_2_xarray</span><span class="p">(</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>                <span class="n">polygon_gdf</span><span class="o">=</span><span class="n">joined_gdf</span><span class="p">,</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>                <span class="n">grid_value</span><span class="o">=</span><span class="n">current_agg_column</span><span class="p">,</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>                <span class="n">long_name</span><span class="o">=</span><span class="n">current_long_name</span><span class="p">,</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>                <span class="n">units</span><span class="o">=</span><span class="n">current_units</span><span class="p">,</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>                <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>                <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>                <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>                <span class="n">variable_name</span><span class="o">=</span><span class="n">filter_var</span><span class="p">,</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>                <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>                <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>            <span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>            <span class="c1"># Print or process verbose information</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>                <span class="n">global_summary_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataframe_stats_line</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">filtered_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats of </span><span class="si">{</span><span class="n">filter_var</span><span class="si">}</span><span class="s2"> before gridding : </span><span class="si">{</span><span class="n">global_summary_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km.&quot;</span><span class="p">)</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>                <span class="n">var_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">replace_special_characters</span><span class="p">(</span><span class="n">filter_var</span><span class="p">)</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>                <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds_var</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">var_name</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats of </span><span class="si">{</span><span class="n">filter_var</span><span class="si">}</span><span class="s2"> after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km.&quot;</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>            <span class="n">dataset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds_var</span><span class="p">)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>        
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>        <span class="c1"># Merge all datasets from different filtered GeoDataFrames</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataset_list</span><span class="p">)</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>        
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>        <span class="n">joined_gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">line_intersect</span><span class="p">(</span><span class="n">polygons_gdf</span><span class="p">,</span> <span class="n">lines_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>        <span class="c1"># Determine agg_column, long_name, and units</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>        <span class="n">agg_column</span> <span class="o">=</span> <span class="n">agg_column</span> <span class="ow">or</span> <span class="s2">&quot;length_m&quot;</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>        <span class="n">long_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_long_name_line</span><span class="p">(</span><span class="n">long_name</span><span class="p">,</span> <span class="n">agg_column</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">)</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>        <span class="n">units</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_units_line</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="p">)</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gridded_poly_2_xarray</span><span class="p">(</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>            <span class="n">polygon_gdf</span><span class="o">=</span><span class="n">joined_gdf</span><span class="p">,</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>            <span class="n">grid_value</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>            <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">,</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>            <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>            <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>            <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>            <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>            <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>            <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>        <span class="p">)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>        
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>            <span class="k">if</span> <span class="n">agg_column</span> <span class="o">==</span> <span class="s2">&quot;length_m&quot;</span><span class="p">:</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>                <span class="n">global_summary_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataframe_stats_line</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">lines_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats before gridding : </span><span class="si">{</span><span class="n">global_summary_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km.&quot;</span><span class="p">)</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>                <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km.&quot;</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>                <span class="n">global_summary_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataframe_stats_line</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">lines_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats before gridding : </span><span class="si">{</span><span class="n">global_summary_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>                <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>    
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>    <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">or</span> <span class="n">output_filename</span><span class="p">:</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>        <span class="c1"># Set output directory</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_directory</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>        <span class="c1"># Set base filename</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>        <span class="n">base_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">lines</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">))</span> <span class="k">else</span> <span class="s2">&quot;gridded_lines&quot;</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>        <span class="c1"># Set output filename</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">output_filename</span> <span class="ow">or</span> <span class="n">base_filename</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>        <span class="c1"># save the xarray dataset</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>        <span class="n">utils</span><span class="o">.</span><span class="n">save_to_nc</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">base_filename</span><span class="o">=</span><span class="n">base_filename</span><span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="k">def</span> <span class="nf">poly_2_grid</span><span class="p">(</span><span class="n">polygons</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m2/grid-cell&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">attr_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">    Converts polygon data from a shapefile or GeoDataFrame into a gridded netCDF dataset.</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a><span class="sd">    Parameters</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">    ----------</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a><span class="sd">    - polygons : GeoDataFrame or str</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a><span class="sd">        Input polygons data to be gridded. Can be either a GeoDataFrame or a path to a polygons shapefile (.shp).</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a><span class="sd">    - variable_name : str, optional</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a><span class="sd">        Name of the variable to include in the netCDF attributes metadata. Defaults to:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a><span class="sd">        - The unique entries in the `attr_field` column if specified.</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a><span class="sd">        - The input filename without extension if `attr_field` and `variable_name` are not specified.</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a><span class="sd">    - long_name : str, optional</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a><span class="sd">        A descriptive name for the variable, added to the netCDF metadata. Behaves the same as `variable_name` if</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="sd">        `attr_field` is specified. Defaults to the input filename without extension if unspecified.</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a><span class="sd">    - units : str, optional</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="sd">        Units of the data variable to include in the netCDF metadata. Default is &quot;m2/grid-cell&quot;.</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="sd">    - source : str, optional</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">        String describing the original source of the input data. This will be added to the netCDF metadata.</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">    - time : str, optional</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">        Time dimension for the output netCDF. If specified, the output will include a time dimension with the</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">        value provided. Default is None (spatial, 2D netCDF output).</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="sd">    - resolution : float, optional</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="sd">        Desired resolution for the grid cells in the output dataset. Default is 1 degree.</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="sd">    - attr_field : str, optional</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a><span class="sd">        Column name in the shapefile or GeoDataFrame specifying the variable names for multiple data types.</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a><span class="sd">    - fraction : bool, optional</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="sd">        If True, calculates the fraction of each polygon within each grid cell. The output values will range from 0 to 1.</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="sd">        Default is False.</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a><span class="sd">    - agg_function : str, optional</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="sd">        Aggregation method for combining values in each grid cell. Default is &#39;sum&#39;. Options include:</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="sd">        - &#39;sum&#39;: Sum of values.</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="sd">        - &#39;max&#39;: Maximum value.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="sd">        - &#39;min&#39;: Minimum value.</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a><span class="sd">        - &#39;std&#39;: Standard deviation.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a><span class="sd">    - output_directory : str, optional</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a><span class="sd">        Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="sd">    - output_filename : str, optional</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="sd">        Name of the output NetCDF file (without the `.nc` extension). If not provided:</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">        - Uses the input shapefile name if a shapefile path is given.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">        - Saves as `&quot;gridded_polygons.nc&quot;` if a GeoDataFrame is provided as input.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="sd">    - normalize_by_area : bool, optional</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a><span class="sd">        If True, normalizes the grid values by area (e.g., converts to value per square meter). Default is False.</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="sd">    - zero_is_value : bool, optional</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a><span class="sd">        If True, treats zero values as valid data rather than as no-data. Default is False.</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a><span class="sd">    - verbose : bool, optional</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a><span class="sd">        If True, prints information about the process, such as global sum of values before and after gridding. Default is False.</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a><span class="sd">    Returns</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a><span class="sd">    -------</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="sd">    - xarray.Dataset, Transformed netCDF file with gridded data derived from the input polygon data.</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="sd">    Notes</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">    -----</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">    - The function supports input in the form of a shapefile or GeoDataFrame containing polygon data.</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">    - Polygon areas are calculated and aggregated based on the specified `attr_field` and `agg_function`.</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">    - If the `fraction` parameter is True, the fraction of each polygon in each grid cell will be computed, with values ranging from 0 to 1.</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">    - The function creates a netCDF file, where data variables are aggregated and stored with metadata.</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">    Example</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a><span class="sd">    -------</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">    &gt;&gt;&gt; poly_2_grid(polygons=shapefile_path, </span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a><span class="sd">    ...             units=&quot;fraction&quot;, </span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a><span class="sd">    ...             source=&quot;The new global lithological map database GLiM&quot;, </span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="sd">    ...             resolution=1, </span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="sd">    ...             attr_field=&quot;Short_Name&quot;, </span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="sd">    ...             fraction=&quot;yes&quot;, </span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">    ...             verbose=True</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="sd">    ... )</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">        </span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>    <span class="c1"># Determine if input is a path (string or Path) or a GeoDataFrame</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polygons</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading shapefile from path...&quot;</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>        <span class="n">poly_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">polygons</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polygons</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>        <span class="n">poly_gdf</span> <span class="o">=</span> <span class="n">polygons</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input must be a GeoDataFrame or a shapefile path (string or Path).&quot;</span><span class="p">)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>    <span class="c1"># create gridded polygon</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>    <span class="n">polygons_gdf</span> <span class="o">=</span> <span class="n">create</span><span class="o">.</span><span class="n">create_gridded_polygon</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">out_polygon_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_area</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>    
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>    <span class="k">if</span> <span class="n">attr_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>        <span class="n">unique_rows</span> <span class="o">=</span> <span class="n">poly_gdf</span><span class="p">[</span><span class="n">attr_field</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="n">dataset_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>        
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>        <span class="k">for</span> <span class="n">filter_var</span> <span class="ow">in</span> <span class="n">unique_rows</span><span class="p">:</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>            
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>            <span class="c1"># Filter the GeoDataFrame</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>            <span class="n">filtered_gdf</span> <span class="o">=</span> <span class="n">poly_gdf</span><span class="p">[</span><span class="n">poly_gdf</span><span class="p">[</span><span class="n">attr_field</span><span class="p">]</span> <span class="o">==</span> <span class="n">filter_var</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>            <span class="c1"># Reset the index to ensure sequential indexing</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>            <span class="n">filtered_gdf</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>            <span class="c1"># Determine agg_column, long_name, and units for the current iteration</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="n">grid_value</span> <span class="o">=</span> <span class="s2">&quot;frac&quot;</span> <span class="k">if</span> <span class="n">fraction</span> <span class="k">else</span> <span class="s2">&quot;in_area&quot;</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>            <span class="n">current_long_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">reverse_replace_special_characters</span><span class="p">(</span><span class="n">filter_var</span><span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>            <span class="n">current_units</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_units_poly</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">fraction</span><span class="p">)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>            <span class="c1"># Convert GeoDataFrame to xarray dataset</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>            <span class="n">ds_var</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">poly_intersect</span><span class="p">(</span><span class="n">poly_gdf</span><span class="o">=</span><span class="n">filtered_gdf</span><span class="p">,</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>                                            <span class="n">polygons_gdf</span><span class="o">=</span><span class="n">polygons_gdf</span><span class="p">,</span> 
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>                                            <span class="n">variable_name</span><span class="o">=</span><span class="n">filter_var</span><span class="p">,</span> 
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>                                            <span class="n">long_name</span><span class="o">=</span><span class="n">current_long_name</span><span class="p">,</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                                            <span class="n">units</span><span class="o">=</span><span class="n">current_units</span><span class="p">,</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                                            <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>                                            <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>                                            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>                                            <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">,</span> 
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>                                            <span class="n">fraction</span><span class="o">=</span><span class="n">fraction</span><span class="p">,</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>                                            <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>                                            <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span><span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>            <span class="c1"># Print or process verbose information</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>                <span class="n">global_summary_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataframe_stats_poly</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">filtered_gdf</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats of </span><span class="si">{</span><span class="n">filter_var</span><span class="si">}</span><span class="s2"> before gridding : </span><span class="si">{</span><span class="n">global_summary_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km2.&quot;</span><span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>                <span class="n">filter_var</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">replace_special_characters</span><span class="p">(</span><span class="n">filter_var</span><span class="p">)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>                <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds_var</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">filter_var</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">grid_value</span><span class="p">,</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>                                                              <span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats of </span><span class="si">{</span><span class="n">filter_var</span><span class="si">}</span><span class="s2"> after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km2.&quot;</span><span class="p">)</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>            <span class="n">dataset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds_var</span><span class="p">)</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>        
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>        <span class="c1"># Merge all datasets from different filtered GeoDataFrames</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataset_list</span><span class="p">)</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>        
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>        
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>        <span class="c1"># Determine agg_column, long_name, and units</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>        <span class="n">grid_value</span> <span class="o">=</span> <span class="s2">&quot;frac&quot;</span> <span class="k">if</span> <span class="n">fraction</span> <span class="k">else</span> <span class="s2">&quot;in_area&quot;</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>        <span class="n">long_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_long_name_poly</span><span class="p">(</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">long_name</span><span class="p">,</span> <span class="n">agg_function</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>        <span class="n">units</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_units_poly</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">fraction</span><span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>        
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>        <span class="c1"># Convert GeoDataFrame to xarray dataset</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">poly_intersect</span><span class="p">(</span><span class="n">poly_gdf</span><span class="o">=</span><span class="n">poly_gdf</span><span class="p">,</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>                                        <span class="n">polygons_gdf</span><span class="o">=</span><span class="n">polygons_gdf</span><span class="p">,</span> 
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>                                        <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> 
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>                                        <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">,</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>                                        <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>                                        <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>                                        <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>                                        <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>                                        <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">,</span> 
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>                                        <span class="n">fraction</span><span class="o">=</span><span class="n">fraction</span><span class="p">,</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>                                        <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>                                        <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span><span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>            <span class="n">global_summary_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataframe_stats_poly</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">poly_gdf</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats before gridding : </span><span class="si">{</span><span class="n">global_summary_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km2.&quot;</span><span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>            <span class="n">variable_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">replace_special_characters</span><span class="p">(</span><span class="n">variable_name</span><span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>            <span class="k">if</span> <span class="n">fraction</span><span class="p">:</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>                <span class="n">normalize_by_area</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>            <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">grid_value</span><span class="p">,</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>                                                              <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km2.&quot;</span><span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>    
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>    <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">or</span> <span class="n">output_filename</span><span class="p">:</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>        <span class="c1"># Set output directory</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_directory</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>        <span class="c1"># Set base filename</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        <span class="n">base_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">polygons</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polygons</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">))</span> <span class="k">else</span> <span class="s2">&quot;gridded_polygons&quot;</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>        <span class="c1"># Set output filename</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">output_filename</span> <span class="ow">or</span> <span class="n">base_filename</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>        <span class="c1"># save the xarray dataset</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>        <span class="n">utils</span><span class="o">.</span><span class="n">save_to_nc</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">base_filename</span><span class="o">=</span><span class="n">base_filename</span><span class="p">)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>    <span class="k">return</span> <span class="n">ds</span>  
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="k">def</span> <span class="nf">grid_2_grid</span><span class="p">(</span><span class="n">raster_path</span><span class="p">,</span> <span class="n">agg_function</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">long_name</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;value/grid-cell&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">netcdf_variable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;symmetric&quot;</span><span class="p">,</span> <span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="sd">    Converts raster data (TIFF or netCDF) into a re-gridded xarray dataset.</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">    Parameters</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="sd">    ----------</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">    - raster_path : str</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">        Path to the input raster data file. This can be either a TIFF or netCDF file.</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a><span class="sd">    - agg_function : str</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">        Aggregation method to apply when re-gridding. Supported values are &#39;SUM&#39;, &#39;MEAN&#39;, or &#39;MAX&#39;.</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">    - variable_name : str</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">        Name of the variable to include in the output dataset.</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a><span class="sd">    - long_name : str</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">        Descriptive name for the variable.</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="sd">    - units : str, optional</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">        Units for the variable. Default is &quot;value/grid-cell&quot;.</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">    - source : str, optional</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">        Source information for the dataset. Default is None.</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">    - time : str or None, optional</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">        Time stamp or identifier for the data. Default is None.</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">    - resolution : int or float, optional</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">        Desired resolution of the grid cells in degree in the output dataset. Default is 1.</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">    - netcdf_variable : str, optional</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">        Name of the variable to extract from the netCDF file, if applicable. Required for netCDF inputs.</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">    - output_directory : str, optional</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">        Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">    - output_filename : str, optional</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">        Name of the output NetCDF file (without the `.nc` extension). If not provided:</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">        - Uses `variable_name` if it is specified.</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">        - Defaults to `regridded.nc` if none of the above are provided.</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">    - padding : str, optional</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">        Padding strategy (&#39;symmetric&#39; or &#39;end&#39;).</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">    - zero_is_value : bool, optional</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a><span class="sd">        Whether to treat zero values as valid data rather than as no-data. Default is False.</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="sd">    - normalize_by_area : bool, optional</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">        Whether to normalize grid values by area (e.g., convert to value per square meter). Default is False.</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">    - verbose : bool, optional</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a><span class="sd">        If True, prints the global sum of values before and after re-gridding. Default is False.</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a><span class="sd">    Returns</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="sd">    -------</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a><span class="sd">    - xarray.Dataset, Re-gridded xarray dataset containing the processed raster data.</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a><span class="sd">    Notes</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a><span class="sd">    -----</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a><span class="sd">    This function supports raster data in TIFF or netCDF format and performs re-gridding based on </span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a><span class="sd">    the specified `agg_function`. The output dataset will include metadata such as the variable name, </span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a><span class="sd">    long name, units, and optional source and time information.</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a><span class="sd">    </span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a><span class="sd">    Example</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a><span class="sd">    -------</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a><span class="sd">    &gt;&gt;&gt; grid_2_grid(raster_path=pop_path, </span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="sd">    ...             agg_function=&quot;sum&quot;, </span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="sd">    ...             variable_name=&quot;population_count&quot;, </span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">    ...             long_name=&quot;Total Population&quot;, </span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a><span class="sd">    ...             units=&quot;people per grid&quot;, </span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="sd">    ...             source=&quot;WorldPop&quot;, </span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a><span class="sd">    ...             resolution=1, </span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="sd">    ...             time=&quot;2020-01-01&quot;, </span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="sd">    ...             verbose=&quot;yes&quot;</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">    ... )</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>    <span class="c1"># Determine the file extension</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>    <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">raster_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>    <span class="k">if</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s2">&quot;.tif&quot;</span><span class="p">:</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading the tif file.&quot;</span><span class="p">)</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>        <span class="c1"># Convert TIFF data to a re-gridded dataset</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">tif_2_ds</span><span class="p">(</span><span class="n">input_raster</span><span class="o">=</span><span class="n">raster_path</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> 
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>                      <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>                      <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>    
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>    <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s2">&quot;.nc&quot;</span> <span class="ow">or</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s2">&quot;.nc4&quot;</span><span class="p">:</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading the nc file.&quot;</span><span class="p">)</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>        <span class="c1"># Convert netCDF to TIFF</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>        <span class="n">netcdf_tif_path</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">netcdf_2_tif</span><span class="p">(</span><span class="n">netcdf_path</span><span class="o">=</span><span class="n">raster_path</span><span class="p">,</span> <span class="n">netcdf_variable</span><span class="o">=</span><span class="n">netcdf_variable</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>        <span class="c1"># Convert netCDF data to a re-gridded dataset</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">tif_2_ds</span><span class="p">(</span><span class="n">input_raster</span><span class="o">=</span><span class="n">netcdf_tif_path</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> 
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>                      <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>                      <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="c1"># Print an error message for unrecognized file types</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: File type is not recognized. File type should be either TIFF or netCDF file.&quot;</span><span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>    <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">or</span> <span class="n">output_filename</span><span class="p">:</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="c1"># Set output directory</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_directory</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>        <span class="c1"># Set base filename</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="n">base_filename</span> <span class="o">=</span> <span class="n">variable_name</span> <span class="ow">or</span> <span class="s2">&quot;regridded&quot;</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="c1"># Set output filename</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">output_filename</span> <span class="ow">or</span> <span class="n">base_filename</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="c1"># save the xarray dataset</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>        <span class="n">utils</span><span class="o">.</span><span class="n">save_to_nc</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">base_filename</span><span class="o">=</span><span class="n">base_filename</span><span class="p">)</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>    
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Re-gridding completed!&quot;</span><span class="p">)</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="k">def</span> <span class="nf">table_2_grid</span><span class="p">(</span><span class="n">surrogate_file</span><span class="p">,</span> <span class="n">surrogate_variable</span><span class="p">,</span> <span class="n">tabular_file</span><span class="p">,</span> <span class="n">tabular_column</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;value/grid-cell&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eez</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="sd">    Convert tabular data to a gridded dataset by spatially distributing values based on a NetCDF variable and a tabular column.</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a><span class="sd">    Parameters:</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a><span class="sd">    -----------</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a><span class="sd">    - surrogate_file : xarray.Dataset or str</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a><span class="sd">        xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded </span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a><span class="sd">        into an xarray.Dataset. The dataset must include the variable specified in `surrogate_variable`.</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a><span class="sd">    - surrogate_variable : str</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="sd">        Variable name in the NetCDF or xarray dataset used for spatial distribution.</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="sd">    - tabular_file : pandas.DataFrame or str</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="sd">        Tabular dataset as a pandas DataFrame or a path to a CSV file. If a file path is provided, it will be </span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a><span class="sd">        automatically loaded into a DataFrame. The data must include a column named &quot;ISO3&quot; representing country codes. </span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="sd">        If not present, use the `add_iso3_column` utility function to convert country names to ISO3 codes.     </span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">    - tabular_column : str</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a><span class="sd">        Column name in the tabular dataset with values to be spatially distributed.</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">    - variable_name : str, optional</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">        Name of the variable. Default is None.</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">    - long_name : str, optional</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">        A long name for the variable. Default is None.</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">    - units : str, optional</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">        Units of the variable. Default is &#39;value/grid&#39;.</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">    - source : str, optional</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a><span class="sd">        Source information, if available. Default is None.</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a><span class="sd">    - filename : str, optional</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="sd">        Additional name for the output raster file. If None, a default name will be used.</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a><span class="sd">    - time : str, optional</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a><span class="sd">        Time information for the dataset.</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a><span class="sd">    - output_directory : str, optional</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a><span class="sd">        Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a><span class="sd">    - output_filename : str, optional</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="sd">        Name of the output NetCDF file (without the `.nc` extension). If not provided:</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="sd">        - Uses `variable_name` if it is specified.</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">        - Falls back to `long_name` or `tabular_column` if `variable_name` is not given.</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="sd">        - Defaults to `gridded_table.nc` if none of the above are provided.</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">    - zero_is_value: bool, optional</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">        If the value is True, then the function will treat zero as an existent value and 0 values will be</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">        considered while calculating mean and STD.</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">    - normalize_by_area : bool, optional</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">        Whether to normalize grid values by area (e.g., convert to value per square meter). Default is False.</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">    - eez : bool, optional</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="sd">        If set to True, the function converts the jurisdictional Exclusive Economic Zone (EEZ) values to a spatial grid.</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a><span class="sd">    - verbose: bool, optional</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a><span class="sd">        If True, the global gridded sum of before and after re-gridding operation will be printed. If any</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="sd">        jurisdiction where surrogate variable is missing and tabular data is evenly distributed over the</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="sd">        jurisdiction, the ISO3 codes of evenly distributed countries will also be printed.</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">    Returns:</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">    --------</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">    - xarray.Dataset, Resulting gridded dataset after spatial distribution of tabular values.</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="sd">    Example</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="sd">    -------</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a><span class="sd">    &gt;&gt;&gt; table_2_grid(surrogate_file=netcdf_file_path, </span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">    ...             surrogate_variable=&quot;railway_length&quot;, </span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="sd">    ...             tabular_file=csv_file_path, </span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="sd">    ...             tabular_column=&quot;steel&quot;, </span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a><span class="sd">    ...             variable_name=&quot;railtract_steel&quot;, </span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a><span class="sd">    ...             long_name=&quot;&#39;Railtrack Steel Mass&#39;&quot;, </span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a><span class="sd">    ...             units=&quot;g m-2&quot;, </span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a><span class="sd">    ...             source=&quot;Matitia (2022)&quot;, </span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="sd">    ...             normalize_by_area=&quot;yes&quot;, </span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a><span class="sd">    ...             verbose=&quot;yes&quot;</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a><span class="sd">    ... )</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>    
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>    <span class="c1"># Load netcdf_file (either path or xarray.Dataset)</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">surrogate_file</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>        <span class="n">input_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">surrogate_file</span><span class="p">)</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">surrogate_file</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>        <span class="n">input_ds</span> <span class="o">=</span> <span class="n">surrogate_file</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`netcdf_file` must be an xarray.Dataset or a path to a NetCDF file.&quot;</span><span class="p">)</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>    <span class="c1"># Load tabular_file (either path or pandas.DataFrame)</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tabular_file</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>        <span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">tabular_file</span><span class="p">)</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tabular_file</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>        <span class="n">input_df</span> <span class="o">=</span> <span class="n">tabular_file</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`tabular_file` must be a pandas.DataFrame or a path to a CSV file.&quot;</span><span class="p">)</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>    
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>    <span class="k">if</span> <span class="n">variable_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>        <span class="n">variable_name</span> <span class="o">=</span> <span class="n">long_name</span> <span class="k">if</span> <span class="n">long_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">tabular_column</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>    <span class="k">if</span> <span class="n">long_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>        <span class="n">long_name</span> <span class="o">=</span> <span class="n">variable_name</span> <span class="k">if</span> <span class="n">variable_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">tabular_column</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>    <span class="c1"># check the netcdf resolution</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>    <span class="n">resolution</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">input_ds</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>    <span class="n">resolution_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>    <span class="k">if</span> <span class="n">time</span><span class="p">:</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>        <span class="c1"># check and convert ISO3 based on occupation or previous control, given a specific year</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>        <span class="n">input_df</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_iso3_by_year</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">input_df</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>    
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>    <span class="n">base_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>    <span class="n">data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_directory</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>    <span class="k">if</span> <span class="n">eez</span><span class="p">:</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>        <span class="n">country_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;eezs.1deg.nc&quot;</span><span class="p">))</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>        <span class="n">input_ds</span> <span class="o">=</span> <span class="n">input_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>        <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>        <span class="c1"># check and print dataframe&#39;s iso3 with country fraction dataset</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>        <span class="n">utils</span><span class="o">.</span><span class="n">check_iso3_with_country_ds</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="n">resolution_str</span><span class="p">)</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>        
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="k">if</span> <span class="n">resolution_str</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span> <span class="ow">or</span> <span class="n">resolution_str</span> <span class="o">==</span> <span class="s2">&quot;1.0&quot;</span><span class="p">:</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>            <span class="n">country_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;country_fraction.1deg.2000-2023.a.nc&quot;</span><span class="p">))</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>            <span class="n">input_ds</span> <span class="o">=</span> <span class="n">input_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>            <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>        <span class="k">elif</span> <span class="n">resolution_str</span> <span class="o">==</span> <span class="s2">&quot;0.5&quot;</span><span class="p">:</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>            <span class="n">country_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;country_fraction.0_5deg.2000-2023.a.nc&quot;</span><span class="p">))</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>            <span class="n">input_ds</span> <span class="o">=</span> <span class="n">input_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>            <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>            
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>        <span class="k">elif</span> <span class="n">resolution_str</span> <span class="o">==</span> <span class="s2">&quot;0.25&quot;</span><span class="p">:</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>            <span class="n">country_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;country_fraction.0_25deg.2000-2023.a.nc&quot;</span><span class="p">))</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>            <span class="n">input_ds</span> <span class="o">=</span> <span class="n">input_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>            <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please re-grid the netcdf file to 1, 0.5 or 0.25 degree.&quot;</span><span class="p">)</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>    <span class="n">input_ds</span><span class="p">,</span> <span class="n">country_ds</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">adjust_datasets</span><span class="p">(</span><span class="n">input_ds</span><span class="p">,</span> <span class="n">country_ds</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distributing </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2"> onto </span><span class="si">{</span><span class="n">surrogate_variable</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>    <span class="n">new_ds</span> <span class="o">=</span> <span class="n">create</span><span class="o">.</span><span class="n">create_new_ds</span><span class="p">(</span><span class="n">input_ds</span><span class="p">,</span> <span class="n">tabular_column</span><span class="p">,</span> <span class="n">country_ds</span><span class="p">,</span> <span class="n">surrogate_variable</span><span class="p">,</span> <span class="n">input_df</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>    <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">new_ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>        <span class="n">a</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">new_ds</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">input_ds</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">input_ds</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]},</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">])</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;value/grid-cell&#39;</span><span class="p">:</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>        <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;value m-2&#39;</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>    <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">da_to_ds</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">long_name</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>                        <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">)</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>    
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global sum of jurisdictional dataset : </span><span class="si">{</span><span class="n">input_df</span><span class="p">[[</span><span class="n">tabular_column</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>    <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">or</span> <span class="n">output_filename</span><span class="p">:</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>        <span class="c1"># Set output directory</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_directory</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>        <span class="c1"># Set base filename</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>        <span class="n">base_filename</span> <span class="o">=</span> <span class="n">variable_name</span> <span class="ow">or</span> <span class="s2">&quot;gridded_table&quot;</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="c1"># Set output filename</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">output_filename</span> <span class="ow">or</span> <span class="n">base_filename</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>        <span class="c1"># save the xarray dataset</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="n">utils</span><span class="o">.</span><span class="n">save_to_nc</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">base_filename</span><span class="o">=</span><span class="n">base_filename</span><span class="p">)</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a><span class="k">def</span> <span class="nf">grid_2_table</span><span class="p">(</span><span class="n">grid_file</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a><span class="sd">    Process gridded data from an xarray Dataset to generate tabular data for different jurisdictions.</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a><span class="sd">    Parameters:</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a><span class="sd">    -----------</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a><span class="sd">    - grid_file : xarray.Dataset or str</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a><span class="sd">        xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a><span class="sd">    - variables : str, optional</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a><span class="sd">        Variables name to be processed. It can either be one variable or list of variables. If None, all variables in the dataset (excluding predefined ones) will be considered.</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="sd">    - time : str, optional</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a><span class="sd">        Time slice for data processing. If provided, the nearest time slice is selected. If None, a default time slice is used.</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">    - resolution : float, optional</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a><span class="sd">        Resolution of gridded data in degree. Default is 1 degree.</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a><span class="sd">    - grid_area : str, optional</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a><span class="sd">        Indicator to consider grid area during processing. If &#39;YES&#39;, the variable is multiplied by grid area.</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a><span class="sd">    - aggregation : str, optional</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a><span class="sd">        Aggregation level for tabular data. If &#39;continent&#39;, the data will be aggregated at the continent level.</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="sd">    - agg_function : str, optional, default &#39;sum&#39;</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a><span class="sd">        Aggregation method. Options: &#39;sum&#39;, &#39;mean&#39;, &#39;max&#39;, &#39;min&#39;, &#39;std&#39;.  </span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a><span class="sd">    Returns:</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a><span class="sd">    --------</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a><span class="sd">    df : pandas DataFrame</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a><span class="sd">        Tabular data for different jurisdictions, including ISO3 codes, variable values, and optional &#39;Year&#39; column.</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">grid_2_table</span><span class="p">(</span><span class="n">grid_file</span><span class="o">=</span><span class="n">grid_file</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">grid_area</span><span class="o">=</span><span class="n">grid_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="n">aggregation</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">agg_function</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>    <span class="k">return</span> <span class="n">df</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="k">def</span> <span class="nf">get_netcdf_info</span><span class="p">(</span><span class="n">netcdf_file</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="sd">    Extract information about variables and dimensions from a NetCDF dataset.</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="sd">    Parameters</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="sd">    ----------</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="sd">    - netcdf_file : xarray.Dataset or str</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">        xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">    - variable_name : str, optional</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">        The prefix or complete name of the variable to filter. If not provided, all variables are included.</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a><span class="sd">    Returns</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="sd">    -------</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a><span class="sd">    - tuple, A tuple containing lists of dimensions, short names, long names, units, &amp; time values (if &#39;time&#39; exists).</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a><span class="sd">        </span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a><span class="sd">    Example</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a><span class="sd">    -------</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a><span class="sd">    &gt;&gt;&gt; get_netcdf_info(netcdf_file=netcdf_file_path, </span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a><span class="sd">    ...                 variable_name=&quot;railway_length&quot;</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a><span class="sd">    ... )</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>    <span class="n">netcdf_info</span> <span class="o">=</span> <span class="n">get</span><span class="o">.</span><span class="n">get_netcdf_info</span><span class="p">(</span><span class="n">netcdf_file</span><span class="o">=</span><span class="n">netcdf_file</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">)</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>    <span class="k">return</span> <span class="n">netcdf_info</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a><span class="k">def</span> <span class="nf">add_iso3_column</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">    Convert country names in a DataFrame column to their corresponding ISO3 country codes.</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">    This function reads a JSON file containing country names and their corresponding ISO3 codes, then </span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">    maps the values from the specified column in the DataFrame to their ISO3 codes based on the JSON data. </span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">    The resulting ISO3 codes are added as a new column named &#39;ISO3&#39;.</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">    Parameters</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">    ----------</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">    - df (pandas.DataFrame): The DataFrame containing a column with country names.</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">    - column (str): The name of the column in the DataFrame that contains country names.</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="sd">    Returns</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="sd">    -------</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="sd">    - pandas.DataFrame: The original DataFrame with an additional &#39;ISO3&#39; column containing the ISO3 country codes.</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="sd">    Raises:</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">    --------</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">    - FileNotFoundError: If the JSON file containing country mappings cannot be found.</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">    - KeyError: If the specified column is not present in the DataFrame.</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">    Example</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">    -------</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="sd">    &gt;&gt;&gt; add_iso3_column(df=dataframe, </span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a><span class="sd">    ...                column=&quot;Country&quot;</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="sd">    ... )</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>    <span class="c1"># Convert country names to ISO3</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>    <span class="n">base_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>    <span class="n">data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_directory</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>    <span class="n">json_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;Names.json&quot;</span><span class="p">)</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>        <span class="n">country_iso3_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>        <span class="c1"># Map the &quot;Country&quot; column to the new &quot;ISO3&quot; column</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ISO3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">country_iso3_data</span><span class="p">)</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>        <span class="c1"># Print rows where the specified column has NaN values</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>        <span class="n">nan_iso3</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ISO3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>        <span class="n">iso3_not_found</span> <span class="o">=</span> <span class="n">nan_iso3</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>        <span class="c1"># Check if the list is not empty before printing</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>        <span class="k">if</span> <span class="n">iso3_not_found</span><span class="p">:</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Country Not Found: </span><span class="si">{</span><span class="n">iso3_not_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>    <span class="k">return</span> <span class="n">df</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="k">def</span> <span class="nf">plot_histogram</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_outliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="w">    </span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a><span class="sd">    Create a histogram for an array variable in an xarray dataset.</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a><span class="sd">    Optionally remove outliers and apply log transformations.</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a><span class="sd">    </span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a><span class="sd">    Parameters:</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a><span class="sd">    - dataset : xarray.Dataset or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="sd">    - variable: str, the name of the variable to plot.</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a><span class="sd">    - bin_size: int, optional, the number of bins in the histogram.</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a><span class="sd">    - color: str, optional, the color of the histogram bars.</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="sd">    - plot_title: str, optional, the title for the plot.</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a><span class="sd">    - x_label: str, optional, the label for the x-axis.</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a><span class="sd">    - remove_outliers: bool, optional, whether to remove outliers.</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a><span class="sd">    - log_transform: str, optional, the type of log transformation (&#39;log10&#39;, &#39;log&#39;, &#39;log2&#39;).</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="sd">    - output_dir : str, optional, Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a><span class="sd">    - filename : str, optional, Filename (with extension) for saving the figure. If not provided, the plot is saved as &quot;output_histogram.png&quot;.</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="sd">    </span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a><span class="sd">    Returns:</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="sd">    - None, displays the plot.</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="sd">    Example</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="sd">    -------</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="sd">    &gt;&gt;&gt; plot_histogram(dataset=dataset, </span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">    ...                variable=&quot;railway_length&quot;, </span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a><span class="sd">    ...                bin_size=30, </span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="sd">    ...                color=&#39;blue&#39;, </span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="sd">    ...                plot_title=&quot;Histogram of Railway Length&quot;</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">    ... )</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>    <span class="n">plot</span><span class="o">.</span><span class="n">plot_histogram</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">plot_title</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">remove_outliers</span><span class="p">,</span> <span class="n">log_transform</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>    
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="k">def</span> <span class="nf">plot_scatter</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">dataset2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_outliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log_transform_1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_transform_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">    Create a scatter plot for two variables in an xarray dataset.</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">    Optionally remove outliers and apply log transformations.</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">    </span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="sd">    Parameters:</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">    - variable1 : str, name of the variable to be plotted on the x-axis. Must be present in `dataset`.</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">    - variable2 : str, name of the variable to be plotted on the y-axis. If `dataset2` is provided, this variable will be extracted from `dataset2`; otherwise, it must exist in `dataset`.</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="sd">    - dataset : xarray.Dataset or str, the primary dataset or a path to a NetCDF file. This dataset must contain the variable specified by `variable1`, which will be used for the x-axis.</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a><span class="sd">    - dataset2 : xarray.Dataset or str, optional, a second dataset or a path to a NetCDF file containing the variable specified by `variable2` (for the y-axis). If not provided, `dataset` will be used for both variables.</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a><span class="sd">    - color: str, optional, the color map of the scatter plot.</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="sd">    - x_label: str, optional, the label for the x-axis.</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="sd">    - y_label: str, optional, the label for the y-axis.</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">    - plot_title: str, optional, the title for the plot.</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">    - remove_outliers: bool, optional, whether to remove outliers from the data.</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="sd">    - log_transform_1: str, optional, the type of log transformation for variable1 (&#39;log10&#39;, &#39;log&#39;, &#39;log2&#39;).</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="sd">    - log_transform_2: str, optional, the type of log transformation for variable2 (&#39;log10&#39;, &#39;log&#39;, &#39;log2&#39;).</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="sd">    - equation : bool, optional, ff True, fits and displays a linear regression equation. </span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="sd">    - output_dir : str, optional, Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="sd">    - filename : str, optional, Filename (with extension) for saving the figure. If not provided, the plot is saved as &quot;output_scatter.png&quot;.</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="sd">    </span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a><span class="sd">    Returns:</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="sd">    - None, displays the plot.</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="sd">    Example</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a><span class="sd">    -------</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a><span class="sd">    &gt;&gt;&gt; plot_scatter(variable1=&quot;roads_gross&quot;, </span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a><span class="sd">    ...             variable2=&quot;buildings_gross&quot;, </span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a><span class="sd">    ...             dataset=ds_road, </span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="sd">    ...             dataset2=ds_build, </span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a><span class="sd">    ...             color=&#39;blue&#39;,</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a><span class="sd">    ...             plot_title=&quot;Building vs Road&quot;, </span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="sd">    ...             remove_outliers=True, </span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="sd">    ...             log_transform_1=&quot;log10&quot;, </span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="sd">    ...             log_transform_2=&quot;log10&quot;</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="sd">    ... )</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>    <span class="n">plot</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">dataset2</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="p">,</span> <span class="n">plot_title</span><span class="p">,</span> <span class="n">remove_outliers</span><span class="p">,</span> <span class="n">log_transform_1</span><span class="p">,</span> <span class="n">log_transform_2</span><span class="p">,</span> <span class="n">equation</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>    
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="k">def</span> <span class="nf">plot_time_series</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;Area Plot&#39;</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;Time Series Plot&#39;</span><span class="p">,</span> <span class="n">smoothing_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a><span class="sd">    Create a line plot and/or area plot for a time series data variable.</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a><span class="sd">    </span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a><span class="sd">    Parameters:</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a><span class="sd">    - dataset : xarray.Dataset or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a><span class="sd">    - variable: str, the name of the variable to plot.</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a><span class="sd">    - agg_function: str, the operation to apply (&#39;sum&#39;, &#39;mean&#39;, &#39;max&#39;, &#39;std&#39;).</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a><span class="sd">    - plot_type: str, optional, the type of plot (&#39;line&#39;, &#39;area&#39;, &#39;both&#39;). Default is &#39;both&#39;.</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a><span class="sd">    - color: str, optional, the color of the plot. Default is &#39;blue&#39;.</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a><span class="sd">    - plot_label: str, optional, the label for the plot. Default is &#39;Area Plot&#39;.</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="sd">    - x_label: str, optional, the label for the x-axis. Default is &#39;Year&#39;.</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="sd">    - y_label: str, optional, the label for the y-axis. Default is &#39;Value&#39;.</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="sd">    - plot_title: str, optional, the title of the plot. Default is &#39;Time Series Plot&#39;.</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="sd">    - smoothing_window: int, optional, the window size for rolling mean smoothing.</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a><span class="sd">    - output_dir : str, optional, Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="sd">    - filename : str, optional, Filename (with extension) for saving the figure. If not provided, the plot is saved as &quot;output_time_series.png&quot;.</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="sd">    </span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="sd">    Returns:</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="sd">    - None, displays the plot.</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="sd">    Example</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="sd">    -------</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="sd">    &gt;&gt;&gt; plot_time_series(variable=&quot;buildings_gross&quot;, </span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="sd">    ...                dataset=ds_build, </span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a><span class="sd">    ...                agg_function=&#39;sum&#39;, </span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="sd">    ...                plot_type=&#39;both&#39;, </span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a><span class="sd">    ...                color=&#39;blue&#39;, </span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a><span class="sd">    ...                x_label=&#39;Year&#39;, </span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a><span class="sd">    ...                y_label=&#39;Value&#39;, </span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a><span class="sd">    ...                plot_title=&#39;Time Series Plot&#39;</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a><span class="sd">    ... )    </span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>    
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>    <span class="n">plot</span><span class="o">.</span><span class="n">plot_time_series</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">agg_function</span><span class="p">,</span> <span class="n">plot_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">plot_label</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="p">,</span> <span class="n">plot_title</span><span class="p">,</span> <span class="n">smoothing_window</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a><span class="k">def</span> <span class="nf">plot_hexbin</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dataset2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink_r&#39;</span><span class="p">,</span> <span class="n">grid_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_outliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log_transform_1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_transform_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a><span class="w">    </span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a><span class="sd">    Create a hexbin plot for two variables in an xarray dataset.</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a><span class="sd">    Parameters:</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="sd">    - variable1 : str, name of the variable to be plotted on the x-axis. Must be present in `dataset`.</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a><span class="sd">    - variable2 : str, name of the variable to be plotted on the y-axis. If `dataset2` is provided, this variable will be extracted from `dataset2`; otherwise, it must exist in `dataset`.</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="sd">    - dataset : xarray.Dataset or str, the primary dataset or a path to a NetCDF file. This dataset must contain the variable specified by `variable1`, which will be used for the x-axis.</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="sd">    - dataset2 : xarray.Dataset or str, optional, a second dataset or a path to a NetCDF file containing the variable specified by `variable2` (for the y-axis). If not provided, `dataset` will be used for both variables.</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a><span class="sd">    - color: str, optional, the color map of the hexbin plot.</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="sd">    - grid_size: int, optional, the number of hexagons in the x-direction.</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="sd">    - x_label: str, optional, the label for the x-axis.</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a><span class="sd">    - y_label: str, optional, the label for the y-axis.</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a><span class="sd">    - plot_title: str, optional, the title for the plot.</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="sd">    - remove_outliers: bool, optional, whether to remove outliers from the data.</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a><span class="sd">    - log_transform_1: str, optional, the type of log transformation for variable1 (&#39;log10&#39;, &#39;log&#39;, &#39;log2&#39;).</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="sd">    - log_transform_2: str, optional, the type of log transformation for variable2 (&#39;log10&#39;, &#39;log&#39;, &#39;log2&#39;).</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a><span class="sd">    - output_dir : str, optional, Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a><span class="sd">    - filename : str, optional, Filename (with extension) for saving the figure. If not provided, the plot is saved as &quot;output_hexbin.png&quot;.</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a><span class="sd">    </span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a><span class="sd">    Returns:</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a><span class="sd">    - None, displays the plot.</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a><span class="sd">    Example</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="sd">    -------</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">    &gt;&gt;&gt; plot_hexbin(variable1=&quot;roads_gross&quot;, </span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a><span class="sd">    ...             variable2=&quot;buildings_gross&quot;, </span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a><span class="sd">    ...             dataset=ds_road, </span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="sd">    ...             dataset2=ds_build, </span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a><span class="sd">    ...             color=&#39;blue&#39;, </span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="sd">    ...             plot_title=&quot;Building vs Road&quot;</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a><span class="sd">    ... )</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>    
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>    <span class="n">plot</span><span class="o">.</span><span class="n">plot_hexbin</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">dataset2</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="p">,</span> <span class="n">plot_title</span><span class="p">,</span> <span class="n">remove_outliers</span><span class="p">,</span> <span class="n">log_transform_1</span><span class="p">,</span> <span class="n">log_transform_2</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>    
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="k">def</span> <span class="nf">plot_map</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;hot_r&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extend_min</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extend_max</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">out_bound</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">remove_ata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="w">    </span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a><span class="sd">    Plots a 2D map of a variable from an xarray Dataset or NetCDF file with customizable colorbar, projection, and map appearance.</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">    Parameters</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="sd">    ----------</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">    variable : str</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">        Name of the variable in the xarray Dataset to plot.</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a><span class="sd">    dataset : xarray.Dataset, or str</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">        xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="sd">    color : str, default &#39;hot_r&#39;</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a><span class="sd">        Matplotlib colormap name for the plot (discrete color scale).</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">    title : str, default &#39;&#39;</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a><span class="sd">        Title of the map.</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a><span class="sd">    label : str, default &#39;&#39;</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a><span class="sd">        Label for the colorbar.</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a><span class="sd">    vmin : float, optional</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a><span class="sd">        Minimum data value for the colorbar range. If not provided, the minimum of the variable is used.</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a><span class="sd">    vmax : float, optional</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a><span class="sd">        Maximum data value for the colorbar range. If not provided, the maximum of the variable is used.</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a><span class="sd">    extend_min : bool, default False</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a><span class="sd">        If True, includes values below `vmin` in the first color class and shows a left arrow on the colorbar.</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a><span class="sd">    extend_max : bool, default False</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a><span class="sd">        If True, includes values above `vmax` in the last color class and shows a right arrow on the colorbar.</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a><span class="sd">    levels : int or list of float, default 10</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a><span class="sd">        Either the number of color intervals or a list of explicit interval boundaries.</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a><span class="sd">    out_bound : bool, default True</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a><span class="sd">        Whether to display the outer boundary (spine) of the map projection.</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a><span class="sd">    remove_ata : bool, default False</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a><span class="sd">        If True, removes Antarctica from the map by excluding data below 60S latitude.</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a><span class="sd">    output_dir : str, optional</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a><span class="sd">        Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a><span class="sd">    filename : str, optional</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a><span class="sd">        Filename (with extension) for saving the figure. If not provided, the plot is saved as &quot;output_plot.png&quot;.</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a><span class="sd">    show: bool, True</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a><span class="sd">        Whether or not show the map</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="sd">    Notes</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">    -----</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a><span class="sd">    - If both `extend_min` and `extend_max` are False, the dataset is clipped strictly within [vmin, vmax].</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a><span class="sd">    - The colorbar will use arrows to indicate out-of-bound values only if `extend_min` or `extend_max` is True.</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a><span class="sd">    - Tick formatting on the colorbar is:</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a><span class="sd">        - Two decimal places if (vmax - vmin) &lt;= 10.</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a><span class="sd">    - If `remove_ata` is True, the colorbar is placed slightly higher to avoid overlap with the map.</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a><span class="sd">    Raises</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a><span class="sd">    ------</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="sd">    ValueError</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a><span class="sd">        If both or neither of `dataset` and `netcdf_directory` are provided.</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a><span class="sd">        </span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="sd">    Returns:</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a><span class="sd">    - Axes class of the map.</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a><span class="sd">    Example</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a><span class="sd">    -------</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a><span class="sd">    &gt;&gt;&gt; plot_map(</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a><span class="sd">    ...     variable=&#39;npp&#39;,</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a><span class="sd">    ...     dataset=ds.isel(time=-1),</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a><span class="sd">    ...     vmin=0,</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a><span class="sd">    ...     vmax=1200,</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="sd">    ...     extend_max=True,</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a><span class="sd">    ...     color=&#39;Greens&#39;,</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a><span class="sd">    ...     levels=10,</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a><span class="sd">    ...     remove_ata=True,</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a><span class="sd">    ...     title=&#39;Net Primary Productivity&#39;,</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a><span class="sd">    ...     label=&#39;gC/m/year&#39;,</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a><span class="sd">    ...     filename=&#39;npp_map.png&#39;</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a><span class="sd">    ... )</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>    
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>             <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">extend_min</span><span class="o">=</span><span class="n">extend_min</span><span class="p">,</span> <span class="n">extend_max</span><span class="o">=</span><span class="n">extend_max</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> 
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>             <span class="n">out_bound</span><span class="o">=</span><span class="n">out_bound</span><span class="p">,</span> <span class="n">remove_ata</span><span class="o">=</span><span class="n">remove_ata</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">)</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>    <span class="k">return</span> <span class="n">ax</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="k">def</span> <span class="nf">plot_country</span><span class="p">(</span><span class="n">tabular_file</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_ata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_bound</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extend_min</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extend_max</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="sd">    Plots a choropleth map of countries using a specified data column and a world shapefile.</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a><span class="sd">    Parameters:</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a><span class="sd">    -----------</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a><span class="sd">    - tabular_file : pandas.DataFrame or str</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="sd">        Input table containing country-level data. Can be either:</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a><span class="sd">        - A pandas DataFrame with the required `column`</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a><span class="sd">        - A string path to a CSV file, which will be automatically read into a DataFrame</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a><span class="sd">    - column : str</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a><span class="sd">        Name of the column in the dataframe to visualize.</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a><span class="sd">    - title : str, optional</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a><span class="sd">        Title of the map. Default is an empty string.</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a><span class="sd">    - label : str, optional</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a><span class="sd">        Label for the colorbar. Default is an empty string.</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a><span class="sd">    - color : str, optional</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a><span class="sd">        Name of the matplotlib colormap to use. Default is &#39;viridis&#39;.</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a><span class="sd">    - levels : int or list of float, optional</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a><span class="sd">        Number of color levels (if int) or list of bin edges (if list). Default is 10.</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a><span class="sd">    - remove_ata : bool, optional</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="sd">        Whether to remove Antarctica (&#39;ATA&#39;) from the data. Default is False.</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a><span class="sd">    - out_bound : bool, optional</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a><span class="sd">        Whether to display map boundaries (spines). Default is True.</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a><span class="sd">    - vmin : float or None, optional</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="sd">        Minimum value for the colormap. If None, calculated from the data.</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">    - vmax : float or None, optional</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">        Maximum value for the colormap. If None, calculated from the data.</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">    - extend_min : bool, optional</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">        Whether to extend the colorbar below `vmin`. Default is False.</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a><span class="sd">    - extend_max : bool, optional</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="sd">        Whether to extend the colorbar above `vmax`. Default is False.</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">    - output_dir : str, optional</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a><span class="sd">        Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">    - filename : str, optional</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">        Filename (with extension) for saving the figure. If not provided, the plot is saved as &quot;output_country_plot.png&quot;.</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a><span class="sd">    Raises:</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a><span class="sd">    -------</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a><span class="sd">    ValueError</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a><span class="sd">        If neither `dataframe` nor `csv_path` is provided, or if both are provided.</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a><span class="sd">    Returns:</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a><span class="sd">    --------</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a><span class="sd">    - None, displays the map and optionally saves it to a file.</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a><span class="sd">    Example</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a><span class="sd">    -------</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a><span class="sd">    &gt;&gt;&gt; plot_country(tabular_file=&quot;country_data.csv&quot;, </span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a><span class="sd">    ...             column=&quot;population&quot;, </span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a><span class="sd">    ...             title=&quot;Population of Countries&quot;, </span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a><span class="sd">    ...             label=&quot;Population&quot;, </span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a><span class="sd">    ...             color=&#39;viridis&#39;</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a><span class="sd">    ... )</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>    <span class="n">plot</span><span class="o">.</span><span class="n">plot_country</span><span class="p">(</span><span class="n">tabular_file</span><span class="o">=</span><span class="n">tabular_file</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">column</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">remove_ata</span><span class="o">=</span><span class="n">remove_ata</span><span class="p">,</span> <span class="n">out_bound</span><span class="o">=</span><span class="n">out_bound</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">extend_min</span><span class="o">=</span><span class="n">extend_min</span><span class="p">,</span> <span class="n">extend_max</span><span class="o">=</span><span class="n">extend_max</span><span class="p">)</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>            
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="k">def</span> <span class="nf">sum_variables</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a><span class="sd">    Sum specified variables in the xarray dataset. If no variables are specified, sum all variables</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a><span class="sd">    except those starting with &#39;grid_area&#39;. Fill NaNs with zero before summing, and convert resulting</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a><span class="sd">    zeros back to NaNs.</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a><span class="sd">    </span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a><span class="sd">    Parameters:</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a><span class="sd">    - dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a><span class="sd">    - variables: list of str, the names of the variables to sum. If None, sum all variables except those starting with &#39;grid_area&#39; and &#39;land_frac&#39;.</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a><span class="sd">    - new_variable_name: str, optional, the name of the new variable to store the sum.</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="sd">    - time: optional, a specific time slice to select from the dataset.</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a><span class="sd">    </span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a><span class="sd">    Returns:</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="sd">    - xarray.Dataset, with the summed variable.</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">    Example</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">    -------</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">    &gt;&gt;&gt; sum_variables(dataset=ds, </span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">    ...              variables=[&quot;roads_gross&quot;, &quot;buildings_gross&quot;], </span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a><span class="sd">    ...              new_variable_name=&quot;total_gross&quot;</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">    ... )</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>    
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>    <span class="n">ds</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">sum_variables</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>    
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a><span class="k">def</span> <span class="nf">subtract_variables</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a><span class="w">    </span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a><span class="sd">    Subtract one variable from another in the xarray dataset.</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a><span class="sd">    Fill NaNs with zero before subtracting, and convert resulting zeros back to NaNs.</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a><span class="sd">    </span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a><span class="sd">    Parameters:</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a><span class="sd">    - variable1: str, the name of the variable to subtract from.</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a><span class="sd">    - variable2: str, the name of the variable to subtract.</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a><span class="sd">    - dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a><span class="sd">    - new_variable_name: str, optional, the name of the new variable to store the result.</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a><span class="sd">    - time: optional, a specific time slice to select from the dataset.</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a><span class="sd">    </span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a><span class="sd">    Returns:</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a><span class="sd">    - xarray.Dataset, with the resulting variable.</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a><span class="sd">    Example</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a><span class="sd">    -------</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a><span class="sd">    &gt;&gt;&gt; subtract_variables(variable1=&quot;precipitation&quot;, </span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a><span class="sd">    ...                   variable2=&quot;evaporation&quot;, </span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a><span class="sd">    ...                   dataset=ds, </span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a><span class="sd">    ...                   new_variable_name=&quot;net_water_gain&quot;</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a><span class="sd">    ... )</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>    <span class="n">ds</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">subtract_variables</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>    
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a><span class="k">def</span> <span class="nf">divide_variables</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a><span class="sd">    Divide one variable by another in the xarray dataset.</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a><span class="sd">    Fill NaNs with zero before dividing, and convert resulting zeros back to NaNs.</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a><span class="sd">    </span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a><span class="sd">    Parameters:</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a><span class="sd">    - variable1: str, the name of the variable to be divided (numerator).</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a><span class="sd">    - variable2: str, the name of the variable to divide by (denominator).</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a><span class="sd">    - dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a><span class="sd">    - new_variable_name: str, optional, the name of the new variable to store the result.</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a><span class="sd">    - time: optional, a specific time slice to select from the dataset.</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a><span class="sd">    </span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a><span class="sd">    Returns:</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a><span class="sd">    - xarray.Dataset, with the resulting variable.</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a><span class="sd">    Example</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a><span class="sd">    -------</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a><span class="sd">    &gt;&gt;&gt; divide_variables(variable1=&quot;roads_gross&quot;, </span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a><span class="sd">    ...                  variable2=&quot;grid_area&quot;, </span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a><span class="sd">    ...                  dataset=ds, </span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a><span class="sd">    ...                  new_variable_name=&quot;road_density&quot;</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a><span class="sd">    ... )</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>    <span class="n">ds</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">divide_variables</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>    
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a><span class="k">def</span> <span class="nf">multiply_variables</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a><span class="sd">    Multiply specified variables in the xarray dataset. If no variables are specified, multiply all variables.</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a><span class="sd">    Fill NaNs with one before multiplying, and convert resulting ones back to NaNs.</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a><span class="sd">    </span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a><span class="sd">    Parameters:</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a><span class="sd">    - dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a><span class="sd">    - variables: list of str, the names of the variables to multiply. If None, multiply all variables, excluding the &quot;grid_area&quot; and &quot;land_frac&quot; variables included in the dataset.</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a><span class="sd">    - new_variable_name: str, optional, the name of the new variable to store the product.</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a><span class="sd">    - time: optional, a specific time slice to select from the dataset.</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a><span class="sd">    </span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a><span class="sd">    Returns:</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a><span class="sd">    - xarray.Dataset, with the resulting variable.</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a><span class="sd">    Example</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a><span class="sd">    -------</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a><span class="sd">    &gt;&gt;&gt; multiply_variables(</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a><span class="sd">    ...     dataset=ds,</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a><span class="sd">    ...     variables=[&quot;crop_area&quot;, &quot;yield_per_hectare&quot;],</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a><span class="sd">    ...     new_variable_name=&quot;total_crop_yield&quot;</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a><span class="sd">    ... )</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>    
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>    <span class="n">ds</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">multiply_variables</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>    
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>    
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a><span class="k">def</span> <span class="nf">average_variables</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a><span class="sd">    Average specified variables in the xarray dataset. If no variables are specified, average all variables</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a><span class="sd">    except those starting with &#39;grid_area&#39;. Fill NaNs with zero before averaging, and convert resulting</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a><span class="sd">    zeros back to NaNs.</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a><span class="sd">    </span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a><span class="sd">    Parameters:</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a><span class="sd">    - dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a><span class="sd">    - variables: list of str, the names of the variables to average. If None, average all variables except those starting with &#39;grid_area&#39; and &#39;land_frac&#39;.</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">    - new_variable_name: str, optional, the name of the new variable to store the average.</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a><span class="sd">    - time: optional, a specific time slice to select from the dataset.</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a><span class="sd">    </span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a><span class="sd">    Returns:</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="sd">    - xarray.Dataset, with the averaged variable.</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a><span class="sd">        Example</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="sd">    -------</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a><span class="sd">    &gt;&gt;&gt; average_variables(dataset=ds, </span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a><span class="sd">    ...                  variables=[&quot;roads_gross&quot;, &quot;buildings_gross&quot;], </span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a><span class="sd">    ...                  new_variable_name=&quot;average_gross&quot;</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a><span class="sd">    ... )</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>    <span class="n">ds</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">average_variables</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span></pre></div>


            </section>
                <section id="point_2_grid">
                            <input id="point_2_grid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">point_2_grid</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">points</span>,</span><span class="param">	<span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span>,</span><span class="param">	<span class="n">long_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span>,</span><span class="param">	<span class="n">units</span><span class="o">=</span><span class="s1">&#39;value/grid-cell&#39;</span>,</span><span class="param">	<span class="n">source</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">time</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">resolution</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">agg_column</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">agg_function</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span>,</span><span class="param">	<span class="n">attr_field</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="point_2_grid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#point_2_grid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="point_2_grid-16"><a href="#point_2_grid-16"><span class="linenos"> 16</span></a><span class="k">def</span> <span class="nf">point_2_grid</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;value/grid-cell&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="n">attr_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="point_2_grid-17"><a href="#point_2_grid-17"><span class="linenos"> 17</span></a><span class="w">    </span>
</span><span id="point_2_grid-18"><a href="#point_2_grid-18"><span class="linenos"> 18</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="point_2_grid-19"><a href="#point_2_grid-19"><span class="linenos"> 19</span></a><span class="sd">    Converts point data from a shapefile or GeoDataFrame into a gridded netCDF dataset.</span>
</span><span id="point_2_grid-20"><a href="#point_2_grid-20"><span class="linenos"> 20</span></a>
</span><span id="point_2_grid-21"><a href="#point_2_grid-21"><span class="linenos"> 21</span></a><span class="sd">    Parameters</span>
</span><span id="point_2_grid-22"><a href="#point_2_grid-22"><span class="linenos"> 22</span></a><span class="sd">    ----------</span>
</span><span id="point_2_grid-23"><a href="#point_2_grid-23"><span class="linenos"> 23</span></a><span class="sd">    - points : GeoDataFrame or str</span>
</span><span id="point_2_grid-24"><a href="#point_2_grid-24"><span class="linenos"> 24</span></a><span class="sd">        Input point data to be gridded. Can be either a GeoDataFrame or a path to a point shapefile (.shp).</span>
</span><span id="point_2_grid-25"><a href="#point_2_grid-25"><span class="linenos"> 25</span></a><span class="sd">    - variable_name : str, optional</span>
</span><span id="point_2_grid-26"><a href="#point_2_grid-26"><span class="linenos"> 26</span></a><span class="sd">        Name of the variable to include in the netCDF attributes metadata. Defaults to:</span>
</span><span id="point_2_grid-27"><a href="#point_2_grid-27"><span class="linenos"> 27</span></a><span class="sd">        - The unique entries in the `attr_field` column if specified.</span>
</span><span id="point_2_grid-28"><a href="#point_2_grid-28"><span class="linenos"> 28</span></a><span class="sd">        - The input filename without extension if `attr_field` and `variable_name` are not specified.</span>
</span><span id="point_2_grid-29"><a href="#point_2_grid-29"><span class="linenos"> 29</span></a><span class="sd">    - long_name : str, optional</span>
</span><span id="point_2_grid-30"><a href="#point_2_grid-30"><span class="linenos"> 30</span></a><span class="sd">        A descriptive name for the variable, added to the netCDF metadata. Behaves the same as `variable_name` if</span>
</span><span id="point_2_grid-31"><a href="#point_2_grid-31"><span class="linenos"> 31</span></a><span class="sd">        `attr_field` is specified. Defaults to the input filename without extension if unspecified.</span>
</span><span id="point_2_grid-32"><a href="#point_2_grid-32"><span class="linenos"> 32</span></a><span class="sd">    - units : str, optional</span>
</span><span id="point_2_grid-33"><a href="#point_2_grid-33"><span class="linenos"> 33</span></a><span class="sd">        Units of the data variable to include in the netCDF metadata. Default is &quot;value/grid-cell&quot;.</span>
</span><span id="point_2_grid-34"><a href="#point_2_grid-34"><span class="linenos"> 34</span></a><span class="sd">    - source : str, optional</span>
</span><span id="point_2_grid-35"><a href="#point_2_grid-35"><span class="linenos"> 35</span></a><span class="sd">        String describing the original source of the input data. This will be added to the netCDF metadata.</span>
</span><span id="point_2_grid-36"><a href="#point_2_grid-36"><span class="linenos"> 36</span></a><span class="sd">    - time : str, optional</span>
</span><span id="point_2_grid-37"><a href="#point_2_grid-37"><span class="linenos"> 37</span></a><span class="sd">        Time dimension for the output netCDF. If specified, the output will include a time dimension with the</span>
</span><span id="point_2_grid-38"><a href="#point_2_grid-38"><span class="linenos"> 38</span></a><span class="sd">        value provided. Default is None (spatial, 2D netCDF output).</span>
</span><span id="point_2_grid-39"><a href="#point_2_grid-39"><span class="linenos"> 39</span></a><span class="sd">    - resolution : float, optional</span>
</span><span id="point_2_grid-40"><a href="#point_2_grid-40"><span class="linenos"> 40</span></a><span class="sd">        Desired resolution for the grid cells in the output dataset. Default is 1 degree.</span>
</span><span id="point_2_grid-41"><a href="#point_2_grid-41"><span class="linenos"> 41</span></a><span class="sd">    - agg_column : str, optional</span>
</span><span id="point_2_grid-42"><a href="#point_2_grid-42"><span class="linenos"> 42</span></a><span class="sd">        Column name in the shapefile or GeoDataFrame specifying the values to aggregate in each grid cell.</span>
</span><span id="point_2_grid-43"><a href="#point_2_grid-43"><span class="linenos"> 43</span></a><span class="sd">        Defaults to counting the number of points per grid cell.</span>
</span><span id="point_2_grid-44"><a href="#point_2_grid-44"><span class="linenos"> 44</span></a><span class="sd">    - agg_function : str, optional</span>
</span><span id="point_2_grid-45"><a href="#point_2_grid-45"><span class="linenos"> 45</span></a><span class="sd">        Aggregation method for combining values in each grid cell. Options include:</span>
</span><span id="point_2_grid-46"><a href="#point_2_grid-46"><span class="linenos"> 46</span></a><span class="sd">        - &#39;sum&#39; (default): Sums all point values.</span>
</span><span id="point_2_grid-47"><a href="#point_2_grid-47"><span class="linenos"> 47</span></a><span class="sd">        - &#39;max&#39;: Takes the maximum value.</span>
</span><span id="point_2_grid-48"><a href="#point_2_grid-48"><span class="linenos"> 48</span></a><span class="sd">        - &#39;min&#39;: Takes the minimum value.</span>
</span><span id="point_2_grid-49"><a href="#point_2_grid-49"><span class="linenos"> 49</span></a><span class="sd">        - &#39;std&#39;: Computes the standard deviation.</span>
</span><span id="point_2_grid-50"><a href="#point_2_grid-50"><span class="linenos"> 50</span></a><span class="sd">    - attr_field : str, optional</span>
</span><span id="point_2_grid-51"><a href="#point_2_grid-51"><span class="linenos"> 51</span></a><span class="sd">        Column name in the shapefile or GeoDataFrame specifying the variable names for multiple data types.</span>
</span><span id="point_2_grid-52"><a href="#point_2_grid-52"><span class="linenos"> 52</span></a><span class="sd">    - output_directory : str, optional</span>
</span><span id="point_2_grid-53"><a href="#point_2_grid-53"><span class="linenos"> 53</span></a><span class="sd">        Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</span>
</span><span id="point_2_grid-54"><a href="#point_2_grid-54"><span class="linenos"> 54</span></a><span class="sd">    - output_filename : str, optional</span>
</span><span id="point_2_grid-55"><a href="#point_2_grid-55"><span class="linenos"> 55</span></a><span class="sd">        Name of the output NetCDF file (without the `.nc` extension). If not provided:</span>
</span><span id="point_2_grid-56"><a href="#point_2_grid-56"><span class="linenos"> 56</span></a><span class="sd">        - Uses the input shapefile name if a shapefile path is given.</span>
</span><span id="point_2_grid-57"><a href="#point_2_grid-57"><span class="linenos"> 57</span></a><span class="sd">        - Saves as `&quot;gridded_points.nc&quot;` if a GeoDataFrame is provided as input.</span>
</span><span id="point_2_grid-58"><a href="#point_2_grid-58"><span class="linenos"> 58</span></a><span class="sd">    - normalize_by_area : bool, optional</span>
</span><span id="point_2_grid-59"><a href="#point_2_grid-59"><span class="linenos"> 59</span></a><span class="sd">        If True, normalizes the grid values by area (e.g., converts to value per square meter). Default is False.</span>
</span><span id="point_2_grid-60"><a href="#point_2_grid-60"><span class="linenos"> 60</span></a><span class="sd">    - zero_is_value : bool, optional</span>
</span><span id="point_2_grid-61"><a href="#point_2_grid-61"><span class="linenos"> 61</span></a><span class="sd">        If True, treats zero values as valid data rather than as no-data. Default is False.</span>
</span><span id="point_2_grid-62"><a href="#point_2_grid-62"><span class="linenos"> 62</span></a><span class="sd">    - verbose : bool, optional</span>
</span><span id="point_2_grid-63"><a href="#point_2_grid-63"><span class="linenos"> 63</span></a><span class="sd">        If True, prints information about the process, such as global sum of values before and after gridding. Default is False.</span>
</span><span id="point_2_grid-64"><a href="#point_2_grid-64"><span class="linenos"> 64</span></a>
</span><span id="point_2_grid-65"><a href="#point_2_grid-65"><span class="linenos"> 65</span></a><span class="sd">    Returns</span>
</span><span id="point_2_grid-66"><a href="#point_2_grid-66"><span class="linenos"> 66</span></a><span class="sd">    -------</span>
</span><span id="point_2_grid-67"><a href="#point_2_grid-67"><span class="linenos"> 67</span></a><span class="sd">    netCDF file</span>
</span><span id="point_2_grid-68"><a href="#point_2_grid-68"><span class="linenos"> 68</span></a><span class="sd">        Transformed netCDF file with gridded data derived from the input point data.</span>
</span><span id="point_2_grid-69"><a href="#point_2_grid-69"><span class="linenos"> 69</span></a>
</span><span id="point_2_grid-70"><a href="#point_2_grid-70"><span class="linenos"> 70</span></a><span class="sd">    Notes</span>
</span><span id="point_2_grid-71"><a href="#point_2_grid-71"><span class="linenos"> 71</span></a><span class="sd">    -----</span>
</span><span id="point_2_grid-72"><a href="#point_2_grid-72"><span class="linenos"> 72</span></a><span class="sd">    - The function supports input in the form of a shapefile or GeoDataFrame containing point data.</span>
</span><span id="point_2_grid-73"><a href="#point_2_grid-73"><span class="linenos"> 73</span></a><span class="sd">    - If points lie exactly on a grid boundary, they are shifted by 0.0001 degrees in both latitude and longitude to ensure assignment to a grid cell.</span>
</span><span id="point_2_grid-74"><a href="#point_2_grid-74"><span class="linenos"> 74</span></a><span class="sd">    - The function creates a netCDF file, where data variables are aggregated based on the `agg_column` and `agg_function`.</span>
</span><span id="point_2_grid-75"><a href="#point_2_grid-75"><span class="linenos"> 75</span></a><span class="sd">    </span>
</span><span id="point_2_grid-76"><a href="#point_2_grid-76"><span class="linenos"> 76</span></a><span class="sd">    Example</span>
</span><span id="point_2_grid-77"><a href="#point_2_grid-77"><span class="linenos"> 77</span></a><span class="sd">    -------</span>
</span><span id="point_2_grid-78"><a href="#point_2_grid-78"><span class="linenos"> 78</span></a><span class="sd">    &gt;&gt;&gt; point_2_grid(points=shapefile_path, </span>
</span><span id="point_2_grid-79"><a href="#point_2_grid-79"><span class="linenos"> 79</span></a><span class="sd">    ...             variable_name=&quot;airplanes&quot;, </span>
</span><span id="point_2_grid-80"><a href="#point_2_grid-80"><span class="linenos"> 80</span></a><span class="sd">    ...             long_name=Airplanes Count&quot;, </span>
</span><span id="point_2_grid-81"><a href="#point_2_grid-81"><span class="linenos"> 81</span></a><span class="sd">    ...             units=&quot;airport/grid-cell&quot;, </span>
</span><span id="point_2_grid-82"><a href="#point_2_grid-82"><span class="linenos"> 82</span></a><span class="sd">    ...             source=&quot;CIA&quot;, </span>
</span><span id="point_2_grid-83"><a href="#point_2_grid-83"><span class="linenos"> 83</span></a><span class="sd">    ...             resolution=1,</span>
</span><span id="point_2_grid-84"><a href="#point_2_grid-84"><span class="linenos"> 84</span></a><span class="sd">    ...             verbose=True</span>
</span><span id="point_2_grid-85"><a href="#point_2_grid-85"><span class="linenos"> 85</span></a><span class="sd">    ... )</span>
</span><span id="point_2_grid-86"><a href="#point_2_grid-86"><span class="linenos"> 86</span></a><span class="sd">    </span>
</span><span id="point_2_grid-87"><a href="#point_2_grid-87"><span class="linenos"> 87</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="point_2_grid-88"><a href="#point_2_grid-88"><span class="linenos"> 88</span></a>
</span><span id="point_2_grid-89"><a href="#point_2_grid-89"><span class="linenos"> 89</span></a>    <span class="c1"># Determine if input is a path (string or Path) or a GeoDataFrame</span>
</span><span id="point_2_grid-90"><a href="#point_2_grid-90"><span class="linenos"> 90</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="point_2_grid-91"><a href="#point_2_grid-91"><span class="linenos"> 91</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="point_2_grid-92"><a href="#point_2_grid-92"><span class="linenos"> 92</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading shapefile from path...&quot;</span><span class="p">)</span>
</span><span id="point_2_grid-93"><a href="#point_2_grid-93"><span class="linenos"> 93</span></a>        <span class="n">points_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
</span><span id="point_2_grid-94"><a href="#point_2_grid-94"><span class="linenos"> 94</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
</span><span id="point_2_grid-95"><a href="#point_2_grid-95"><span class="linenos"> 95</span></a>        <span class="n">points_gdf</span> <span class="o">=</span> <span class="n">points</span>
</span><span id="point_2_grid-96"><a href="#point_2_grid-96"><span class="linenos"> 96</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="point_2_grid-97"><a href="#point_2_grid-97"><span class="linenos"> 97</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input must be a GeoDataFrame or a shapefile path (string or Path).&quot;</span><span class="p">)</span>
</span><span id="point_2_grid-98"><a href="#point_2_grid-98"><span class="linenos"> 98</span></a>
</span><span id="point_2_grid-99"><a href="#point_2_grid-99"><span class="linenos"> 99</span></a>    <span class="c1"># create gridded polygon</span>
</span><span id="point_2_grid-100"><a href="#point_2_grid-100"><span class="linenos">100</span></a>    <span class="n">polygons_gdf</span> <span class="o">=</span> <span class="n">create</span><span class="o">.</span><span class="n">create_gridded_polygon</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">out_polygon_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_area</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="point_2_grid-101"><a href="#point_2_grid-101"><span class="linenos">101</span></a>    
</span><span id="point_2_grid-102"><a href="#point_2_grid-102"><span class="linenos">102</span></a>    <span class="k">if</span> <span class="n">attr_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="point_2_grid-103"><a href="#point_2_grid-103"><span class="linenos">103</span></a>        <span class="n">unique_rows</span> <span class="o">=</span> <span class="n">points_gdf</span><span class="p">[</span><span class="n">attr_field</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="point_2_grid-104"><a href="#point_2_grid-104"><span class="linenos">104</span></a>        <span class="n">dataset_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="point_2_grid-105"><a href="#point_2_grid-105"><span class="linenos">105</span></a>        
</span><span id="point_2_grid-106"><a href="#point_2_grid-106"><span class="linenos">106</span></a>        <span class="k">for</span> <span class="n">filter_var</span> <span class="ow">in</span> <span class="n">unique_rows</span><span class="p">:</span>
</span><span id="point_2_grid-107"><a href="#point_2_grid-107"><span class="linenos">107</span></a>            <span class="c1"># Filter the GeoDataFrame</span>
</span><span id="point_2_grid-108"><a href="#point_2_grid-108"><span class="linenos">108</span></a>            <span class="n">filtered_gdf</span> <span class="o">=</span> <span class="n">points_gdf</span><span class="p">[</span><span class="n">points_gdf</span><span class="p">[</span><span class="n">attr_field</span><span class="p">]</span> <span class="o">==</span> <span class="n">filter_var</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="point_2_grid-109"><a href="#point_2_grid-109"><span class="linenos">109</span></a>            <span class="n">joined_gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">point_spatial_join</span><span class="p">(</span><span class="n">polygons_gdf</span><span class="p">,</span> <span class="n">filtered_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="point_2_grid-110"><a href="#point_2_grid-110"><span class="linenos">110</span></a>
</span><span id="point_2_grid-111"><a href="#point_2_grid-111"><span class="linenos">111</span></a>            <span class="c1"># Determine agg_column, long_name, and units for the current iteration</span>
</span><span id="point_2_grid-112"><a href="#point_2_grid-112"><span class="linenos">112</span></a>            <span class="n">current_agg_column</span> <span class="o">=</span> <span class="n">agg_column</span> <span class="ow">or</span> <span class="s2">&quot;count&quot;</span>
</span><span id="point_2_grid-113"><a href="#point_2_grid-113"><span class="linenos">113</span></a>            <span class="n">current_long_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">reverse_replace_special_characters</span><span class="p">(</span><span class="n">filter_var</span><span class="p">)</span>
</span><span id="point_2_grid-114"><a href="#point_2_grid-114"><span class="linenos">114</span></a>            <span class="n">current_units</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_units_point</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="p">)</span>
</span><span id="point_2_grid-115"><a href="#point_2_grid-115"><span class="linenos">115</span></a>
</span><span id="point_2_grid-116"><a href="#point_2_grid-116"><span class="linenos">116</span></a>            <span class="c1"># Convert joined GeoDataFrame to xarray dataset</span>
</span><span id="point_2_grid-117"><a href="#point_2_grid-117"><span class="linenos">117</span></a>            <span class="n">ds_var</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gridded_poly_2_xarray</span><span class="p">(</span>
</span><span id="point_2_grid-118"><a href="#point_2_grid-118"><span class="linenos">118</span></a>                <span class="n">polygon_gdf</span><span class="o">=</span><span class="n">joined_gdf</span><span class="p">,</span>
</span><span id="point_2_grid-119"><a href="#point_2_grid-119"><span class="linenos">119</span></a>                <span class="n">grid_value</span><span class="o">=</span><span class="n">current_agg_column</span><span class="p">,</span>
</span><span id="point_2_grid-120"><a href="#point_2_grid-120"><span class="linenos">120</span></a>                <span class="n">long_name</span><span class="o">=</span><span class="n">current_long_name</span><span class="p">,</span>
</span><span id="point_2_grid-121"><a href="#point_2_grid-121"><span class="linenos">121</span></a>                <span class="n">units</span><span class="o">=</span><span class="n">current_units</span><span class="p">,</span>
</span><span id="point_2_grid-122"><a href="#point_2_grid-122"><span class="linenos">122</span></a>                <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span id="point_2_grid-123"><a href="#point_2_grid-123"><span class="linenos">123</span></a>                <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="point_2_grid-124"><a href="#point_2_grid-124"><span class="linenos">124</span></a>                <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="point_2_grid-125"><a href="#point_2_grid-125"><span class="linenos">125</span></a>                <span class="n">variable_name</span><span class="o">=</span><span class="n">filter_var</span><span class="p">,</span>
</span><span id="point_2_grid-126"><a href="#point_2_grid-126"><span class="linenos">126</span></a>                <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span>
</span><span id="point_2_grid-127"><a href="#point_2_grid-127"><span class="linenos">127</span></a>                <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span>
</span><span id="point_2_grid-128"><a href="#point_2_grid-128"><span class="linenos">128</span></a>            <span class="p">)</span>
</span><span id="point_2_grid-129"><a href="#point_2_grid-129"><span class="linenos">129</span></a>
</span><span id="point_2_grid-130"><a href="#point_2_grid-130"><span class="linenos">130</span></a>            <span class="c1"># Print or process verbose information</span>
</span><span id="point_2_grid-131"><a href="#point_2_grid-131"><span class="linenos">131</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="point_2_grid-132"><a href="#point_2_grid-132"><span class="linenos">132</span></a>                <span class="n">global_summary_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataframe_stats_point</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">filtered_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">current_agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="point_2_grid-133"><a href="#point_2_grid-133"><span class="linenos">133</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats of </span><span class="si">{</span><span class="n">filter_var</span><span class="si">}</span><span class="s2"> before gridding : </span><span class="si">{</span><span class="n">global_summary_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="point_2_grid-134"><a href="#point_2_grid-134"><span class="linenos">134</span></a>                <span class="n">var_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">replace_special_characters</span><span class="p">(</span><span class="n">filter_var</span><span class="p">)</span>
</span><span id="point_2_grid-135"><a href="#point_2_grid-135"><span class="linenos">135</span></a>                <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds_var</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">var_name</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="point_2_grid-136"><a href="#point_2_grid-136"><span class="linenos">136</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats of </span><span class="si">{</span><span class="n">filter_var</span><span class="si">}</span><span class="s2"> after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="point_2_grid-137"><a href="#point_2_grid-137"><span class="linenos">137</span></a>
</span><span id="point_2_grid-138"><a href="#point_2_grid-138"><span class="linenos">138</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="point_2_grid-139"><a href="#point_2_grid-139"><span class="linenos">139</span></a>            <span class="n">dataset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds_var</span><span class="p">)</span>
</span><span id="point_2_grid-140"><a href="#point_2_grid-140"><span class="linenos">140</span></a>        
</span><span id="point_2_grid-141"><a href="#point_2_grid-141"><span class="linenos">141</span></a>        <span class="c1"># Merge all datasets from different filtered GeoDataFrames</span>
</span><span id="point_2_grid-142"><a href="#point_2_grid-142"><span class="linenos">142</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataset_list</span><span class="p">)</span>
</span><span id="point_2_grid-143"><a href="#point_2_grid-143"><span class="linenos">143</span></a>        
</span><span id="point_2_grid-144"><a href="#point_2_grid-144"><span class="linenos">144</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="point_2_grid-145"><a href="#point_2_grid-145"><span class="linenos">145</span></a>        <span class="n">joined_gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">point_spatial_join</span><span class="p">(</span><span class="n">polygons_gdf</span><span class="p">,</span> <span class="n">points_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="point_2_grid-146"><a href="#point_2_grid-146"><span class="linenos">146</span></a>
</span><span id="point_2_grid-147"><a href="#point_2_grid-147"><span class="linenos">147</span></a>        <span class="c1"># Determine agg_column, long_name, and units</span>
</span><span id="point_2_grid-148"><a href="#point_2_grid-148"><span class="linenos">148</span></a>        <span class="n">agg_column</span> <span class="o">=</span> <span class="n">agg_column</span> <span class="ow">or</span> <span class="s2">&quot;count&quot;</span>
</span><span id="point_2_grid-149"><a href="#point_2_grid-149"><span class="linenos">149</span></a>        <span class="n">long_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_long_name_point</span><span class="p">(</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">long_name</span><span class="p">,</span> <span class="n">agg_function</span><span class="p">)</span>
</span><span id="point_2_grid-150"><a href="#point_2_grid-150"><span class="linenos">150</span></a>        <span class="n">units</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_units_point</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="p">)</span>
</span><span id="point_2_grid-151"><a href="#point_2_grid-151"><span class="linenos">151</span></a>        
</span><span id="point_2_grid-152"><a href="#point_2_grid-152"><span class="linenos">152</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gridded_poly_2_xarray</span><span class="p">(</span>
</span><span id="point_2_grid-153"><a href="#point_2_grid-153"><span class="linenos">153</span></a>            <span class="n">polygon_gdf</span><span class="o">=</span><span class="n">joined_gdf</span><span class="p">,</span>
</span><span id="point_2_grid-154"><a href="#point_2_grid-154"><span class="linenos">154</span></a>            <span class="n">grid_value</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span>
</span><span id="point_2_grid-155"><a href="#point_2_grid-155"><span class="linenos">155</span></a>            <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">,</span>
</span><span id="point_2_grid-156"><a href="#point_2_grid-156"><span class="linenos">156</span></a>            <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
</span><span id="point_2_grid-157"><a href="#point_2_grid-157"><span class="linenos">157</span></a>            <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span id="point_2_grid-158"><a href="#point_2_grid-158"><span class="linenos">158</span></a>            <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="point_2_grid-159"><a href="#point_2_grid-159"><span class="linenos">159</span></a>            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="point_2_grid-160"><a href="#point_2_grid-160"><span class="linenos">160</span></a>            <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span>
</span><span id="point_2_grid-161"><a href="#point_2_grid-161"><span class="linenos">161</span></a>            <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span>
</span><span id="point_2_grid-162"><a href="#point_2_grid-162"><span class="linenos">162</span></a>            <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span>
</span><span id="point_2_grid-163"><a href="#point_2_grid-163"><span class="linenos">163</span></a>        <span class="p">)</span>
</span><span id="point_2_grid-164"><a href="#point_2_grid-164"><span class="linenos">164</span></a>
</span><span id="point_2_grid-165"><a href="#point_2_grid-165"><span class="linenos">165</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="point_2_grid-166"><a href="#point_2_grid-166"><span class="linenos">166</span></a>            <span class="n">global_summary_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataframe_stats_point</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">points_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="point_2_grid-167"><a href="#point_2_grid-167"><span class="linenos">167</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats before gridding : </span><span class="si">{</span><span class="n">global_summary_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="point_2_grid-168"><a href="#point_2_grid-168"><span class="linenos">168</span></a>            <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="point_2_grid-169"><a href="#point_2_grid-169"><span class="linenos">169</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="point_2_grid-170"><a href="#point_2_grid-170"><span class="linenos">170</span></a>    
</span><span id="point_2_grid-171"><a href="#point_2_grid-171"><span class="linenos">171</span></a>    <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">or</span> <span class="n">output_filename</span><span class="p">:</span>
</span><span id="point_2_grid-172"><a href="#point_2_grid-172"><span class="linenos">172</span></a>        <span class="c1"># Set output directory</span>
</span><span id="point_2_grid-173"><a href="#point_2_grid-173"><span class="linenos">173</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_directory</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
</span><span id="point_2_grid-174"><a href="#point_2_grid-174"><span class="linenos">174</span></a>        <span class="c1"># Set base filename</span>
</span><span id="point_2_grid-175"><a href="#point_2_grid-175"><span class="linenos">175</span></a>        <span class="n">base_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">points</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">))</span> <span class="k">else</span> <span class="s2">&quot;gridded_points&quot;</span>
</span><span id="point_2_grid-176"><a href="#point_2_grid-176"><span class="linenos">176</span></a>        <span class="c1"># Set output filename</span>
</span><span id="point_2_grid-177"><a href="#point_2_grid-177"><span class="linenos">177</span></a>        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">output_filename</span> <span class="ow">or</span> <span class="n">base_filename</span>
</span><span id="point_2_grid-178"><a href="#point_2_grid-178"><span class="linenos">178</span></a>        <span class="c1"># save the xarray dataset</span>
</span><span id="point_2_grid-179"><a href="#point_2_grid-179"><span class="linenos">179</span></a>        <span class="n">utils</span><span class="o">.</span><span class="n">save_to_nc</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">base_filename</span><span class="o">=</span><span class="n">base_filename</span><span class="p">)</span>
</span><span id="point_2_grid-180"><a href="#point_2_grid-180"><span class="linenos">180</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span></pre></div>


            <div class="docstring"><p>Converts point data from a shapefile or GeoDataFrame into a gridded netCDF dataset.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li>points : GeoDataFrame or str
Input point data to be gridded. Can be either a GeoDataFrame or a path to a point shapefile (.shp).</li>
<li>variable_name : str, optional
Name of the variable to include in the netCDF attributes metadata. Defaults to:
<ul>
<li>The unique entries in the <code>attr_field</code> column if specified.</li>
<li>The input filename without extension if <code>attr_field</code> and <code>variable_name</code> are not specified.</li>
</ul></li>
<li>long_name : str, optional
A descriptive name for the variable, added to the netCDF metadata. Behaves the same as <code>variable_name</code> if
<code>attr_field</code> is specified. Defaults to the input filename without extension if unspecified.</li>
<li>units : str, optional
Units of the data variable to include in the netCDF metadata. Default is "value/grid-cell".</li>
<li>source : str, optional
String describing the original source of the input data. This will be added to the netCDF metadata.</li>
<li>time : str, optional
Time dimension for the output netCDF. If specified, the output will include a time dimension with the
value provided. Default is None (spatial, 2D netCDF output).</li>
<li>resolution : float, optional
Desired resolution for the grid cells in the output dataset. Default is 1 degree.</li>
<li>agg_column : str, optional
Column name in the shapefile or GeoDataFrame specifying the values to aggregate in each grid cell.
Defaults to counting the number of points per grid cell.</li>
<li>agg_function : str, optional
Aggregation method for combining values in each grid cell. Options include:
<ul>
<li>'sum' (default): Sums all point values.</li>
<li>'max': Takes the maximum value.</li>
<li>'min': Takes the minimum value.</li>
<li>'std': Computes the standard deviation.</li>
</ul></li>
<li>attr_field : str, optional
Column name in the shapefile or GeoDataFrame specifying the variable names for multiple data types.</li>
<li>output_directory : str, optional
Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</li>
<li>output_filename : str, optional
Name of the output NetCDF file (without the <code>.nc</code> extension). If not provided:
<ul>
<li>Uses the input shapefile name if a shapefile path is given.</li>
<li>Saves as <code>"gridded_points.nc"</code> if a GeoDataFrame is provided as input.</li>
</ul></li>
<li>normalize_by_area : bool, optional
If True, normalizes the grid values by area (e.g., converts to value per square meter). Default is False.</li>
<li>zero_is_value : bool, optional
If True, treats zero values as valid data rather than as no-data. Default is False.</li>
<li>verbose : bool, optional
If True, prints information about the process, such as global sum of values before and after gridding. Default is False.</li>
</ul>

<h2 id="returns">Returns</h2>

<p>netCDF file
    Transformed netCDF file with gridded data derived from the input point data.</p>

<h2 id="notes">Notes</h2>

<ul>
<li>The function supports input in the form of a shapefile or GeoDataFrame containing point data.</li>
<li>If points lie exactly on a grid boundary, they are shifted by 0.0001 degrees in both latitude and longitude to ensure assignment to a grid cell.</li>
<li>The function creates a netCDF file, where data variables are aggregated based on the <code>agg_column</code> and <code>agg_function</code>.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">point_2_grid</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">shapefile_path</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">variable_name</span><span class="o">=</span><span class="s2">&quot;airplanes&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">long_name</span><span class="o">=</span><span class="n">Airplanes</span> <span class="n">Count</span><span class="s2">&quot;, </span>
<span class="gp">... </span>            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;airport/grid-cell&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">source</span><span class="o">=</span><span class="s2">&quot;CIA&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="line_2_grid">
                            <input id="line_2_grid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">line_2_grid</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">lines</span>,</span><span class="param">	<span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span>,</span><span class="param">	<span class="n">long_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span>,</span><span class="param">	<span class="n">units</span><span class="o">=</span><span class="s1">&#39;meter/grid-cell&#39;</span>,</span><span class="param">	<span class="n">source</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">time</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">resolution</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">agg_column</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">agg_function</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span>,</span><span class="param">	<span class="n">attr_field</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="line_2_grid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#line_2_grid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="line_2_grid-182"><a href="#line_2_grid-182"><span class="linenos">182</span></a><span class="k">def</span> <span class="nf">line_2_grid</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;meter/grid-cell&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="n">attr_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="line_2_grid-183"><a href="#line_2_grid-183"><span class="linenos">183</span></a><span class="w">    </span>
</span><span id="line_2_grid-184"><a href="#line_2_grid-184"><span class="linenos">184</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line_2_grid-185"><a href="#line_2_grid-185"><span class="linenos">185</span></a><span class="sd">    Converts line data from a shapefile or GeoDataFrame into a gridded netCDF dataset.</span>
</span><span id="line_2_grid-186"><a href="#line_2_grid-186"><span class="linenos">186</span></a>
</span><span id="line_2_grid-187"><a href="#line_2_grid-187"><span class="linenos">187</span></a><span class="sd">    Parameters</span>
</span><span id="line_2_grid-188"><a href="#line_2_grid-188"><span class="linenos">188</span></a><span class="sd">    ----------</span>
</span><span id="line_2_grid-189"><a href="#line_2_grid-189"><span class="linenos">189</span></a><span class="sd">    - lines : GeoDataFrame or str</span>
</span><span id="line_2_grid-190"><a href="#line_2_grid-190"><span class="linenos">190</span></a><span class="sd">        Input lines data to be gridded. Can be either a GeoDataFrame or a path to a line/polyline shapefile (.shp).</span>
</span><span id="line_2_grid-191"><a href="#line_2_grid-191"><span class="linenos">191</span></a><span class="sd">    - variable_name : str, optional</span>
</span><span id="line_2_grid-192"><a href="#line_2_grid-192"><span class="linenos">192</span></a><span class="sd">        Name of the variable to include in the netCDF attributes metadata. Defaults to:</span>
</span><span id="line_2_grid-193"><a href="#line_2_grid-193"><span class="linenos">193</span></a><span class="sd">        - The unique entries in the `attr_field` column if specified.</span>
</span><span id="line_2_grid-194"><a href="#line_2_grid-194"><span class="linenos">194</span></a><span class="sd">        - The input filename without extension if `attr_field` and `variable_name` are not specified.</span>
</span><span id="line_2_grid-195"><a href="#line_2_grid-195"><span class="linenos">195</span></a><span class="sd">    - long_name : str, optional</span>
</span><span id="line_2_grid-196"><a href="#line_2_grid-196"><span class="linenos">196</span></a><span class="sd">        A descriptive name for the variable, added to the netCDF metadata. Behaves the same as `variable_name` if</span>
</span><span id="line_2_grid-197"><a href="#line_2_grid-197"><span class="linenos">197</span></a><span class="sd">        `attr_field` is specified. Defaults to the input filename without extension if unspecified.</span>
</span><span id="line_2_grid-198"><a href="#line_2_grid-198"><span class="linenos">198</span></a><span class="sd">    - units : str, optional</span>
</span><span id="line_2_grid-199"><a href="#line_2_grid-199"><span class="linenos">199</span></a><span class="sd">        Units of the data variable to include in the netCDF metadata. Default is &quot;meter/grid-cell&quot;.</span>
</span><span id="line_2_grid-200"><a href="#line_2_grid-200"><span class="linenos">200</span></a><span class="sd">    - source : str, optional</span>
</span><span id="line_2_grid-201"><a href="#line_2_grid-201"><span class="linenos">201</span></a><span class="sd">        String describing the original source of the input data. This will be added to the netCDF metadata.</span>
</span><span id="line_2_grid-202"><a href="#line_2_grid-202"><span class="linenos">202</span></a><span class="sd">    - time : str, optional</span>
</span><span id="line_2_grid-203"><a href="#line_2_grid-203"><span class="linenos">203</span></a><span class="sd">        Time dimension for the output netCDF. If specified, the output will include a time dimension with the</span>
</span><span id="line_2_grid-204"><a href="#line_2_grid-204"><span class="linenos">204</span></a><span class="sd">        value provided. Default is None (spatial, 2D netCDF output).</span>
</span><span id="line_2_grid-205"><a href="#line_2_grid-205"><span class="linenos">205</span></a><span class="sd">    - resolution : float, optional</span>
</span><span id="line_2_grid-206"><a href="#line_2_grid-206"><span class="linenos">206</span></a><span class="sd">        Desired resolution for the grid cells in the output dataset. Default is 1 degree.</span>
</span><span id="line_2_grid-207"><a href="#line_2_grid-207"><span class="linenos">207</span></a><span class="sd">    - agg_column : str, optional</span>
</span><span id="line_2_grid-208"><a href="#line_2_grid-208"><span class="linenos">208</span></a><span class="sd">        Column name in the shapefile or GeoDataFrame specifying the values to aggregate in each grid cell.</span>
</span><span id="line_2_grid-209"><a href="#line_2_grid-209"><span class="linenos">209</span></a><span class="sd">        Defaults to summing the lengths of intersected lines per grid cell.</span>
</span><span id="line_2_grid-210"><a href="#line_2_grid-210"><span class="linenos">210</span></a><span class="sd">    - agg_function : str, optional</span>
</span><span id="line_2_grid-211"><a href="#line_2_grid-211"><span class="linenos">211</span></a><span class="sd">        Aggregation method for combining values in each grid cell. Options include:</span>
</span><span id="line_2_grid-212"><a href="#line_2_grid-212"><span class="linenos">212</span></a><span class="sd">        - &#39;sum&#39; (default): Sums all line values.</span>
</span><span id="line_2_grid-213"><a href="#line_2_grid-213"><span class="linenos">213</span></a><span class="sd">        - &#39;max&#39;: Takes the maximum value.</span>
</span><span id="line_2_grid-214"><a href="#line_2_grid-214"><span class="linenos">214</span></a><span class="sd">        - &#39;min&#39;: Takes the minimum value.</span>
</span><span id="line_2_grid-215"><a href="#line_2_grid-215"><span class="linenos">215</span></a><span class="sd">        - &#39;std&#39;: Computes the standard deviation.</span>
</span><span id="line_2_grid-216"><a href="#line_2_grid-216"><span class="linenos">216</span></a><span class="sd">    - attr_field : str, optional</span>
</span><span id="line_2_grid-217"><a href="#line_2_grid-217"><span class="linenos">217</span></a><span class="sd">        Column name in the shapefile or GeoDataFrame specifying the variable names for multiple data types.</span>
</span><span id="line_2_grid-218"><a href="#line_2_grid-218"><span class="linenos">218</span></a><span class="sd">    - output_directory : str, optional</span>
</span><span id="line_2_grid-219"><a href="#line_2_grid-219"><span class="linenos">219</span></a><span class="sd">        Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</span>
</span><span id="line_2_grid-220"><a href="#line_2_grid-220"><span class="linenos">220</span></a><span class="sd">    - output_filename : str, optional</span>
</span><span id="line_2_grid-221"><a href="#line_2_grid-221"><span class="linenos">221</span></a><span class="sd">        Name of the output NetCDF file (without the `.nc` extension). If not provided:</span>
</span><span id="line_2_grid-222"><a href="#line_2_grid-222"><span class="linenos">222</span></a><span class="sd">        - Uses the input shapefile name if a shapefile path is given.</span>
</span><span id="line_2_grid-223"><a href="#line_2_grid-223"><span class="linenos">223</span></a><span class="sd">        - Saves as `&quot;gridded_lines.nc&quot;` if a GeoDataFrame is provided as input.</span>
</span><span id="line_2_grid-224"><a href="#line_2_grid-224"><span class="linenos">224</span></a><span class="sd">    - normalize_by_area : bool, optional</span>
</span><span id="line_2_grid-225"><a href="#line_2_grid-225"><span class="linenos">225</span></a><span class="sd">        If True, normalizes the variable in each grid cell by the area of the grid cell (e.g., converts to value per square meter). Default is False.</span>
</span><span id="line_2_grid-226"><a href="#line_2_grid-226"><span class="linenos">226</span></a><span class="sd">    - zero_is_value : bool, optional</span>
</span><span id="line_2_grid-227"><a href="#line_2_grid-227"><span class="linenos">227</span></a><span class="sd">        If True, treats zero values as valid data rather than as no-data. Default is False.</span>
</span><span id="line_2_grid-228"><a href="#line_2_grid-228"><span class="linenos">228</span></a><span class="sd">    - verbose : bool, optional</span>
</span><span id="line_2_grid-229"><a href="#line_2_grid-229"><span class="linenos">229</span></a><span class="sd">        If True, prints information about the process, such as global sum of values before and after gridding. Default is False.</span>
</span><span id="line_2_grid-230"><a href="#line_2_grid-230"><span class="linenos">230</span></a>
</span><span id="line_2_grid-231"><a href="#line_2_grid-231"><span class="linenos">231</span></a><span class="sd">    Returns</span>
</span><span id="line_2_grid-232"><a href="#line_2_grid-232"><span class="linenos">232</span></a><span class="sd">    -------</span>
</span><span id="line_2_grid-233"><a href="#line_2_grid-233"><span class="linenos">233</span></a><span class="sd">    - xarray.Dataset, Transformed netCDF file with gridded data derived from the input line data.</span>
</span><span id="line_2_grid-234"><a href="#line_2_grid-234"><span class="linenos">234</span></a>
</span><span id="line_2_grid-235"><a href="#line_2_grid-235"><span class="linenos">235</span></a><span class="sd">    Notes</span>
</span><span id="line_2_grid-236"><a href="#line_2_grid-236"><span class="linenos">236</span></a><span class="sd">    -----</span>
</span><span id="line_2_grid-237"><a href="#line_2_grid-237"><span class="linenos">237</span></a><span class="sd">    - The function supports input in the form of a shapefile or GeoDataFrame containing line data.</span>
</span><span id="line_2_grid-238"><a href="#line_2_grid-238"><span class="linenos">238</span></a><span class="sd">    - Line lengths are calculated and aggregated based on the specified `agg_column` and `agg_function`.</span>
</span><span id="line_2_grid-239"><a href="#line_2_grid-239"><span class="linenos">239</span></a><span class="sd">    - If lines intersect a grid boundary, their contributions are divided proportionally among the intersected grid cells.</span>
</span><span id="line_2_grid-240"><a href="#line_2_grid-240"><span class="linenos">240</span></a><span class="sd">    - The function creates a netCDF file, where data variables are aggregated and stored with metadata.</span>
</span><span id="line_2_grid-241"><a href="#line_2_grid-241"><span class="linenos">241</span></a><span class="sd">    </span>
</span><span id="line_2_grid-242"><a href="#line_2_grid-242"><span class="linenos">242</span></a><span class="sd">    Example</span>
</span><span id="line_2_grid-243"><a href="#line_2_grid-243"><span class="linenos">243</span></a><span class="sd">    -------</span>
</span><span id="line_2_grid-244"><a href="#line_2_grid-244"><span class="linenos">244</span></a><span class="sd">    &gt;&gt;&gt; line_2_grid(lines=shapefile_path, </span>
</span><span id="line_2_grid-245"><a href="#line_2_grid-245"><span class="linenos">245</span></a><span class="sd">    ...             variable_name=&quot;roads&quot;, </span>
</span><span id="line_2_grid-246"><a href="#line_2_grid-246"><span class="linenos">246</span></a><span class="sd">    ...             long_name=&quot;Roads Length&quot;, </span>
</span><span id="line_2_grid-247"><a href="#line_2_grid-247"><span class="linenos">247</span></a><span class="sd">    ...             units=&quot;meter/grid-cell&quot;, </span>
</span><span id="line_2_grid-248"><a href="#line_2_grid-248"><span class="linenos">248</span></a><span class="sd">    ...             source=&quot;OpenStreetMap&quot;, </span>
</span><span id="line_2_grid-249"><a href="#line_2_grid-249"><span class="linenos">249</span></a><span class="sd">    ...             time=None, </span>
</span><span id="line_2_grid-250"><a href="#line_2_grid-250"><span class="linenos">250</span></a><span class="sd">    ...             resolution=1,</span>
</span><span id="line_2_grid-251"><a href="#line_2_grid-251"><span class="linenos">251</span></a><span class="sd">    ...             agg_function=&quot;sum&quot;, </span>
</span><span id="line_2_grid-252"><a href="#line_2_grid-252"><span class="linenos">252</span></a><span class="sd">    ...             verbose=True)</span>
</span><span id="line_2_grid-253"><a href="#line_2_grid-253"><span class="linenos">253</span></a><span class="sd">    ... )</span>
</span><span id="line_2_grid-254"><a href="#line_2_grid-254"><span class="linenos">254</span></a><span class="sd">        </span>
</span><span id="line_2_grid-255"><a href="#line_2_grid-255"><span class="linenos">255</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line_2_grid-256"><a href="#line_2_grid-256"><span class="linenos">256</span></a>
</span><span id="line_2_grid-257"><a href="#line_2_grid-257"><span class="linenos">257</span></a>    <span class="c1"># Determine if input is a path (string or Path) or a GeoDataFrame</span>
</span><span id="line_2_grid-258"><a href="#line_2_grid-258"><span class="linenos">258</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="line_2_grid-259"><a href="#line_2_grid-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="line_2_grid-260"><a href="#line_2_grid-260"><span class="linenos">260</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading shapefile from path...&quot;</span><span class="p">)</span>
</span><span id="line_2_grid-261"><a href="#line_2_grid-261"><span class="linenos">261</span></a>        <span class="n">lines_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="line_2_grid-262"><a href="#line_2_grid-262"><span class="linenos">262</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
</span><span id="line_2_grid-263"><a href="#line_2_grid-263"><span class="linenos">263</span></a>        <span class="n">lines_gdf</span> <span class="o">=</span> <span class="n">lines</span>
</span><span id="line_2_grid-264"><a href="#line_2_grid-264"><span class="linenos">264</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="line_2_grid-265"><a href="#line_2_grid-265"><span class="linenos">265</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input must be a GeoDataFrame or a shapefile path (string or Path).&quot;</span><span class="p">)</span>
</span><span id="line_2_grid-266"><a href="#line_2_grid-266"><span class="linenos">266</span></a>
</span><span id="line_2_grid-267"><a href="#line_2_grid-267"><span class="linenos">267</span></a>    <span class="c1"># create gridded polygon</span>
</span><span id="line_2_grid-268"><a href="#line_2_grid-268"><span class="linenos">268</span></a>    <span class="n">polygons_gdf</span> <span class="o">=</span> <span class="n">create</span><span class="o">.</span><span class="n">create_gridded_polygon</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">out_polygon_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_area</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="line_2_grid-269"><a href="#line_2_grid-269"><span class="linenos">269</span></a>    
</span><span id="line_2_grid-270"><a href="#line_2_grid-270"><span class="linenos">270</span></a>    <span class="k">if</span> <span class="n">attr_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line_2_grid-271"><a href="#line_2_grid-271"><span class="linenos">271</span></a>        <span class="n">unique_rows</span> <span class="o">=</span> <span class="n">lines_gdf</span><span class="p">[</span><span class="n">attr_field</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="line_2_grid-272"><a href="#line_2_grid-272"><span class="linenos">272</span></a>        <span class="n">dataset_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="line_2_grid-273"><a href="#line_2_grid-273"><span class="linenos">273</span></a>        
</span><span id="line_2_grid-274"><a href="#line_2_grid-274"><span class="linenos">274</span></a>        <span class="k">for</span> <span class="n">filter_var</span> <span class="ow">in</span> <span class="n">unique_rows</span><span class="p">:</span>
</span><span id="line_2_grid-275"><a href="#line_2_grid-275"><span class="linenos">275</span></a>            <span class="c1"># Filter the GeoDataFrame</span>
</span><span id="line_2_grid-276"><a href="#line_2_grid-276"><span class="linenos">276</span></a>            <span class="n">filtered_gdf</span> <span class="o">=</span> <span class="n">lines_gdf</span><span class="p">[</span><span class="n">lines_gdf</span><span class="p">[</span><span class="n">attr_field</span><span class="p">]</span> <span class="o">==</span> <span class="n">filter_var</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="line_2_grid-277"><a href="#line_2_grid-277"><span class="linenos">277</span></a>            <span class="n">joined_gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">line_intersect</span><span class="p">(</span><span class="n">polygons_gdf</span><span class="p">,</span> <span class="n">filtered_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="line_2_grid-278"><a href="#line_2_grid-278"><span class="linenos">278</span></a>
</span><span id="line_2_grid-279"><a href="#line_2_grid-279"><span class="linenos">279</span></a>            <span class="c1"># Determine agg_column, long_name, and units for the current iteration</span>
</span><span id="line_2_grid-280"><a href="#line_2_grid-280"><span class="linenos">280</span></a>            <span class="n">current_agg_column</span> <span class="o">=</span> <span class="n">agg_column</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;length_</span><span class="si">{</span><span class="n">agg_function</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="line_2_grid-281"><a href="#line_2_grid-281"><span class="linenos">281</span></a>            <span class="n">current_long_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">reverse_replace_special_characters</span><span class="p">(</span><span class="n">filter_var</span><span class="p">)</span>
</span><span id="line_2_grid-282"><a href="#line_2_grid-282"><span class="linenos">282</span></a>            <span class="n">current_units</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_units_line</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="p">)</span>
</span><span id="line_2_grid-283"><a href="#line_2_grid-283"><span class="linenos">283</span></a>
</span><span id="line_2_grid-284"><a href="#line_2_grid-284"><span class="linenos">284</span></a>            <span class="c1"># Convert joined GeoDataFrame to xarray dataset</span>
</span><span id="line_2_grid-285"><a href="#line_2_grid-285"><span class="linenos">285</span></a>            <span class="n">ds_var</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gridded_poly_2_xarray</span><span class="p">(</span>
</span><span id="line_2_grid-286"><a href="#line_2_grid-286"><span class="linenos">286</span></a>                <span class="n">polygon_gdf</span><span class="o">=</span><span class="n">joined_gdf</span><span class="p">,</span>
</span><span id="line_2_grid-287"><a href="#line_2_grid-287"><span class="linenos">287</span></a>                <span class="n">grid_value</span><span class="o">=</span><span class="n">current_agg_column</span><span class="p">,</span>
</span><span id="line_2_grid-288"><a href="#line_2_grid-288"><span class="linenos">288</span></a>                <span class="n">long_name</span><span class="o">=</span><span class="n">current_long_name</span><span class="p">,</span>
</span><span id="line_2_grid-289"><a href="#line_2_grid-289"><span class="linenos">289</span></a>                <span class="n">units</span><span class="o">=</span><span class="n">current_units</span><span class="p">,</span>
</span><span id="line_2_grid-290"><a href="#line_2_grid-290"><span class="linenos">290</span></a>                <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span id="line_2_grid-291"><a href="#line_2_grid-291"><span class="linenos">291</span></a>                <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="line_2_grid-292"><a href="#line_2_grid-292"><span class="linenos">292</span></a>                <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="line_2_grid-293"><a href="#line_2_grid-293"><span class="linenos">293</span></a>                <span class="n">variable_name</span><span class="o">=</span><span class="n">filter_var</span><span class="p">,</span>
</span><span id="line_2_grid-294"><a href="#line_2_grid-294"><span class="linenos">294</span></a>                <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span>
</span><span id="line_2_grid-295"><a href="#line_2_grid-295"><span class="linenos">295</span></a>                <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span>
</span><span id="line_2_grid-296"><a href="#line_2_grid-296"><span class="linenos">296</span></a>            <span class="p">)</span>
</span><span id="line_2_grid-297"><a href="#line_2_grid-297"><span class="linenos">297</span></a>
</span><span id="line_2_grid-298"><a href="#line_2_grid-298"><span class="linenos">298</span></a>            <span class="c1"># Print or process verbose information</span>
</span><span id="line_2_grid-299"><a href="#line_2_grid-299"><span class="linenos">299</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="line_2_grid-300"><a href="#line_2_grid-300"><span class="linenos">300</span></a>                <span class="n">global_summary_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataframe_stats_line</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">filtered_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="line_2_grid-301"><a href="#line_2_grid-301"><span class="linenos">301</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats of </span><span class="si">{</span><span class="n">filter_var</span><span class="si">}</span><span class="s2"> before gridding : </span><span class="si">{</span><span class="n">global_summary_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km.&quot;</span><span class="p">)</span>
</span><span id="line_2_grid-302"><a href="#line_2_grid-302"><span class="linenos">302</span></a>                <span class="n">var_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">replace_special_characters</span><span class="p">(</span><span class="n">filter_var</span><span class="p">)</span>
</span><span id="line_2_grid-303"><a href="#line_2_grid-303"><span class="linenos">303</span></a>                <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds_var</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">var_name</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span>
</span><span id="line_2_grid-304"><a href="#line_2_grid-304"><span class="linenos">304</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats of </span><span class="si">{</span><span class="n">filter_var</span><span class="si">}</span><span class="s2"> after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km.&quot;</span><span class="p">)</span>
</span><span id="line_2_grid-305"><a href="#line_2_grid-305"><span class="linenos">305</span></a>
</span><span id="line_2_grid-306"><a href="#line_2_grid-306"><span class="linenos">306</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="line_2_grid-307"><a href="#line_2_grid-307"><span class="linenos">307</span></a>            <span class="n">dataset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds_var</span><span class="p">)</span>
</span><span id="line_2_grid-308"><a href="#line_2_grid-308"><span class="linenos">308</span></a>        
</span><span id="line_2_grid-309"><a href="#line_2_grid-309"><span class="linenos">309</span></a>        <span class="c1"># Merge all datasets from different filtered GeoDataFrames</span>
</span><span id="line_2_grid-310"><a href="#line_2_grid-310"><span class="linenos">310</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataset_list</span><span class="p">)</span>
</span><span id="line_2_grid-311"><a href="#line_2_grid-311"><span class="linenos">311</span></a>        
</span><span id="line_2_grid-312"><a href="#line_2_grid-312"><span class="linenos">312</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="line_2_grid-313"><a href="#line_2_grid-313"><span class="linenos">313</span></a>        <span class="n">joined_gdf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">line_intersect</span><span class="p">(</span><span class="n">polygons_gdf</span><span class="p">,</span> <span class="n">lines_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="line_2_grid-314"><a href="#line_2_grid-314"><span class="linenos">314</span></a>
</span><span id="line_2_grid-315"><a href="#line_2_grid-315"><span class="linenos">315</span></a>        <span class="c1"># Determine agg_column, long_name, and units</span>
</span><span id="line_2_grid-316"><a href="#line_2_grid-316"><span class="linenos">316</span></a>        <span class="n">agg_column</span> <span class="o">=</span> <span class="n">agg_column</span> <span class="ow">or</span> <span class="s2">&quot;length_m&quot;</span>
</span><span id="line_2_grid-317"><a href="#line_2_grid-317"><span class="linenos">317</span></a>        <span class="n">long_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_long_name_line</span><span class="p">(</span><span class="n">long_name</span><span class="p">,</span> <span class="n">agg_column</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">)</span>
</span><span id="line_2_grid-318"><a href="#line_2_grid-318"><span class="linenos">318</span></a>        <span class="n">units</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_units_line</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="p">)</span>
</span><span id="line_2_grid-319"><a href="#line_2_grid-319"><span class="linenos">319</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gridded_poly_2_xarray</span><span class="p">(</span>
</span><span id="line_2_grid-320"><a href="#line_2_grid-320"><span class="linenos">320</span></a>            <span class="n">polygon_gdf</span><span class="o">=</span><span class="n">joined_gdf</span><span class="p">,</span>
</span><span id="line_2_grid-321"><a href="#line_2_grid-321"><span class="linenos">321</span></a>            <span class="n">grid_value</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span>
</span><span id="line_2_grid-322"><a href="#line_2_grid-322"><span class="linenos">322</span></a>            <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">,</span>
</span><span id="line_2_grid-323"><a href="#line_2_grid-323"><span class="linenos">323</span></a>            <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
</span><span id="line_2_grid-324"><a href="#line_2_grid-324"><span class="linenos">324</span></a>            <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span id="line_2_grid-325"><a href="#line_2_grid-325"><span class="linenos">325</span></a>            <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="line_2_grid-326"><a href="#line_2_grid-326"><span class="linenos">326</span></a>            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="line_2_grid-327"><a href="#line_2_grid-327"><span class="linenos">327</span></a>            <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span>
</span><span id="line_2_grid-328"><a href="#line_2_grid-328"><span class="linenos">328</span></a>            <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span>
</span><span id="line_2_grid-329"><a href="#line_2_grid-329"><span class="linenos">329</span></a>            <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span>
</span><span id="line_2_grid-330"><a href="#line_2_grid-330"><span class="linenos">330</span></a>        <span class="p">)</span>
</span><span id="line_2_grid-331"><a href="#line_2_grid-331"><span class="linenos">331</span></a>        
</span><span id="line_2_grid-332"><a href="#line_2_grid-332"><span class="linenos">332</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="line_2_grid-333"><a href="#line_2_grid-333"><span class="linenos">333</span></a>            <span class="k">if</span> <span class="n">agg_column</span> <span class="o">==</span> <span class="s2">&quot;length_m&quot;</span><span class="p">:</span>
</span><span id="line_2_grid-334"><a href="#line_2_grid-334"><span class="linenos">334</span></a>                <span class="n">global_summary_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataframe_stats_line</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">lines_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="line_2_grid-335"><a href="#line_2_grid-335"><span class="linenos">335</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats before gridding : </span><span class="si">{</span><span class="n">global_summary_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km.&quot;</span><span class="p">)</span>
</span><span id="line_2_grid-336"><a href="#line_2_grid-336"><span class="linenos">336</span></a>                <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span>
</span><span id="line_2_grid-337"><a href="#line_2_grid-337"><span class="linenos">337</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km.&quot;</span><span class="p">)</span>
</span><span id="line_2_grid-338"><a href="#line_2_grid-338"><span class="linenos">338</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="line_2_grid-339"><a href="#line_2_grid-339"><span class="linenos">339</span></a>                <span class="n">global_summary_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataframe_stats_line</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">lines_gdf</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="line_2_grid-340"><a href="#line_2_grid-340"><span class="linenos">340</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats before gridding : </span><span class="si">{</span><span class="n">global_summary_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="line_2_grid-341"><a href="#line_2_grid-341"><span class="linenos">341</span></a>                <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">agg_column</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="line_2_grid-342"><a href="#line_2_grid-342"><span class="linenos">342</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="line_2_grid-343"><a href="#line_2_grid-343"><span class="linenos">343</span></a>    
</span><span id="line_2_grid-344"><a href="#line_2_grid-344"><span class="linenos">344</span></a>    <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">or</span> <span class="n">output_filename</span><span class="p">:</span>
</span><span id="line_2_grid-345"><a href="#line_2_grid-345"><span class="linenos">345</span></a>        <span class="c1"># Set output directory</span>
</span><span id="line_2_grid-346"><a href="#line_2_grid-346"><span class="linenos">346</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_directory</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
</span><span id="line_2_grid-347"><a href="#line_2_grid-347"><span class="linenos">347</span></a>        <span class="c1"># Set base filename</span>
</span><span id="line_2_grid-348"><a href="#line_2_grid-348"><span class="linenos">348</span></a>        <span class="n">base_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">lines</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">))</span> <span class="k">else</span> <span class="s2">&quot;gridded_lines&quot;</span>
</span><span id="line_2_grid-349"><a href="#line_2_grid-349"><span class="linenos">349</span></a>        <span class="c1"># Set output filename</span>
</span><span id="line_2_grid-350"><a href="#line_2_grid-350"><span class="linenos">350</span></a>        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">output_filename</span> <span class="ow">or</span> <span class="n">base_filename</span>
</span><span id="line_2_grid-351"><a href="#line_2_grid-351"><span class="linenos">351</span></a>        <span class="c1"># save the xarray dataset</span>
</span><span id="line_2_grid-352"><a href="#line_2_grid-352"><span class="linenos">352</span></a>        <span class="n">utils</span><span class="o">.</span><span class="n">save_to_nc</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">base_filename</span><span class="o">=</span><span class="n">base_filename</span><span class="p">)</span>
</span><span id="line_2_grid-353"><a href="#line_2_grid-353"><span class="linenos">353</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span></pre></div>


            <div class="docstring"><p>Converts line data from a shapefile or GeoDataFrame into a gridded netCDF dataset.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li>lines : GeoDataFrame or str
Input lines data to be gridded. Can be either a GeoDataFrame or a path to a line/polyline shapefile (.shp).</li>
<li>variable_name : str, optional
Name of the variable to include in the netCDF attributes metadata. Defaults to:
<ul>
<li>The unique entries in the <code>attr_field</code> column if specified.</li>
<li>The input filename without extension if <code>attr_field</code> and <code>variable_name</code> are not specified.</li>
</ul></li>
<li>long_name : str, optional
A descriptive name for the variable, added to the netCDF metadata. Behaves the same as <code>variable_name</code> if
<code>attr_field</code> is specified. Defaults to the input filename without extension if unspecified.</li>
<li>units : str, optional
Units of the data variable to include in the netCDF metadata. Default is "meter/grid-cell".</li>
<li>source : str, optional
String describing the original source of the input data. This will be added to the netCDF metadata.</li>
<li>time : str, optional
Time dimension for the output netCDF. If specified, the output will include a time dimension with the
value provided. Default is None (spatial, 2D netCDF output).</li>
<li>resolution : float, optional
Desired resolution for the grid cells in the output dataset. Default is 1 degree.</li>
<li>agg_column : str, optional
Column name in the shapefile or GeoDataFrame specifying the values to aggregate in each grid cell.
Defaults to summing the lengths of intersected lines per grid cell.</li>
<li>agg_function : str, optional
Aggregation method for combining values in each grid cell. Options include:
<ul>
<li>'sum' (default): Sums all line values.</li>
<li>'max': Takes the maximum value.</li>
<li>'min': Takes the minimum value.</li>
<li>'std': Computes the standard deviation.</li>
</ul></li>
<li>attr_field : str, optional
Column name in the shapefile or GeoDataFrame specifying the variable names for multiple data types.</li>
<li>output_directory : str, optional
Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</li>
<li>output_filename : str, optional
Name of the output NetCDF file (without the <code>.nc</code> extension). If not provided:
<ul>
<li>Uses the input shapefile name if a shapefile path is given.</li>
<li>Saves as <code>"gridded_lines.nc"</code> if a GeoDataFrame is provided as input.</li>
</ul></li>
<li>normalize_by_area : bool, optional
If True, normalizes the variable in each grid cell by the area of the grid cell (e.g., converts to value per square meter). Default is False.</li>
<li>zero_is_value : bool, optional
If True, treats zero values as valid data rather than as no-data. Default is False.</li>
<li>verbose : bool, optional
If True, prints information about the process, such as global sum of values before and after gridding. Default is False.</li>
</ul>

<h2 id="returns">Returns</h2>

<ul>
<li>xarray.Dataset, Transformed netCDF file with gridded data derived from the input line data.</li>
</ul>

<h2 id="notes">Notes</h2>

<ul>
<li>The function supports input in the form of a shapefile or GeoDataFrame containing line data.</li>
<li>Line lengths are calculated and aggregated based on the specified <code>agg_column</code> and <code>agg_function</code>.</li>
<li>If lines intersect a grid boundary, their contributions are divided proportionally among the intersected grid cells.</li>
<li>The function creates a netCDF file, where data variables are aggregated and stored with metadata.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">line_2_grid</span><span class="p">(</span><span class="n">lines</span><span class="o">=</span><span class="n">shapefile_path</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">variable_name</span><span class="o">=</span><span class="s2">&quot;roads&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;Roads Length&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;meter/grid-cell&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">source</span><span class="o">=</span><span class="s2">&quot;OpenStreetMap&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">agg_function</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="poly_2_grid">
                            <input id="poly_2_grid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">poly_2_grid</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">polygons</span>,</span><span class="param">	<span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span>,</span><span class="param">	<span class="n">long_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span>,</span><span class="param">	<span class="n">units</span><span class="o">=</span><span class="s1">&#39;m2/grid-cell&#39;</span>,</span><span class="param">	<span class="n">source</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">time</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">resolution</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">attr_field</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">fraction</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">agg_function</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span>,</span><span class="param">	<span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="poly_2_grid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#poly_2_grid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="poly_2_grid-355"><a href="#poly_2_grid-355"><span class="linenos">355</span></a><span class="k">def</span> <span class="nf">poly_2_grid</span><span class="p">(</span><span class="n">polygons</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m2/grid-cell&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">attr_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="poly_2_grid-356"><a href="#poly_2_grid-356"><span class="linenos">356</span></a>
</span><span id="poly_2_grid-357"><a href="#poly_2_grid-357"><span class="linenos">357</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="poly_2_grid-358"><a href="#poly_2_grid-358"><span class="linenos">358</span></a><span class="sd">    Converts polygon data from a shapefile or GeoDataFrame into a gridded netCDF dataset.</span>
</span><span id="poly_2_grid-359"><a href="#poly_2_grid-359"><span class="linenos">359</span></a>
</span><span id="poly_2_grid-360"><a href="#poly_2_grid-360"><span class="linenos">360</span></a><span class="sd">    Parameters</span>
</span><span id="poly_2_grid-361"><a href="#poly_2_grid-361"><span class="linenos">361</span></a><span class="sd">    ----------</span>
</span><span id="poly_2_grid-362"><a href="#poly_2_grid-362"><span class="linenos">362</span></a><span class="sd">    - polygons : GeoDataFrame or str</span>
</span><span id="poly_2_grid-363"><a href="#poly_2_grid-363"><span class="linenos">363</span></a><span class="sd">        Input polygons data to be gridded. Can be either a GeoDataFrame or a path to a polygons shapefile (.shp).</span>
</span><span id="poly_2_grid-364"><a href="#poly_2_grid-364"><span class="linenos">364</span></a><span class="sd">    - variable_name : str, optional</span>
</span><span id="poly_2_grid-365"><a href="#poly_2_grid-365"><span class="linenos">365</span></a><span class="sd">        Name of the variable to include in the netCDF attributes metadata. Defaults to:</span>
</span><span id="poly_2_grid-366"><a href="#poly_2_grid-366"><span class="linenos">366</span></a><span class="sd">        - The unique entries in the `attr_field` column if specified.</span>
</span><span id="poly_2_grid-367"><a href="#poly_2_grid-367"><span class="linenos">367</span></a><span class="sd">        - The input filename without extension if `attr_field` and `variable_name` are not specified.</span>
</span><span id="poly_2_grid-368"><a href="#poly_2_grid-368"><span class="linenos">368</span></a><span class="sd">    - long_name : str, optional</span>
</span><span id="poly_2_grid-369"><a href="#poly_2_grid-369"><span class="linenos">369</span></a><span class="sd">        A descriptive name for the variable, added to the netCDF metadata. Behaves the same as `variable_name` if</span>
</span><span id="poly_2_grid-370"><a href="#poly_2_grid-370"><span class="linenos">370</span></a><span class="sd">        `attr_field` is specified. Defaults to the input filename without extension if unspecified.</span>
</span><span id="poly_2_grid-371"><a href="#poly_2_grid-371"><span class="linenos">371</span></a><span class="sd">    - units : str, optional</span>
</span><span id="poly_2_grid-372"><a href="#poly_2_grid-372"><span class="linenos">372</span></a><span class="sd">        Units of the data variable to include in the netCDF metadata. Default is &quot;m2/grid-cell&quot;.</span>
</span><span id="poly_2_grid-373"><a href="#poly_2_grid-373"><span class="linenos">373</span></a><span class="sd">    - source : str, optional</span>
</span><span id="poly_2_grid-374"><a href="#poly_2_grid-374"><span class="linenos">374</span></a><span class="sd">        String describing the original source of the input data. This will be added to the netCDF metadata.</span>
</span><span id="poly_2_grid-375"><a href="#poly_2_grid-375"><span class="linenos">375</span></a><span class="sd">    - time : str, optional</span>
</span><span id="poly_2_grid-376"><a href="#poly_2_grid-376"><span class="linenos">376</span></a><span class="sd">        Time dimension for the output netCDF. If specified, the output will include a time dimension with the</span>
</span><span id="poly_2_grid-377"><a href="#poly_2_grid-377"><span class="linenos">377</span></a><span class="sd">        value provided. Default is None (spatial, 2D netCDF output).</span>
</span><span id="poly_2_grid-378"><a href="#poly_2_grid-378"><span class="linenos">378</span></a><span class="sd">    - resolution : float, optional</span>
</span><span id="poly_2_grid-379"><a href="#poly_2_grid-379"><span class="linenos">379</span></a><span class="sd">        Desired resolution for the grid cells in the output dataset. Default is 1 degree.</span>
</span><span id="poly_2_grid-380"><a href="#poly_2_grid-380"><span class="linenos">380</span></a><span class="sd">    - attr_field : str, optional</span>
</span><span id="poly_2_grid-381"><a href="#poly_2_grid-381"><span class="linenos">381</span></a><span class="sd">        Column name in the shapefile or GeoDataFrame specifying the variable names for multiple data types.</span>
</span><span id="poly_2_grid-382"><a href="#poly_2_grid-382"><span class="linenos">382</span></a><span class="sd">    - fraction : bool, optional</span>
</span><span id="poly_2_grid-383"><a href="#poly_2_grid-383"><span class="linenos">383</span></a><span class="sd">        If True, calculates the fraction of each polygon within each grid cell. The output values will range from 0 to 1.</span>
</span><span id="poly_2_grid-384"><a href="#poly_2_grid-384"><span class="linenos">384</span></a><span class="sd">        Default is False.</span>
</span><span id="poly_2_grid-385"><a href="#poly_2_grid-385"><span class="linenos">385</span></a><span class="sd">    - agg_function : str, optional</span>
</span><span id="poly_2_grid-386"><a href="#poly_2_grid-386"><span class="linenos">386</span></a><span class="sd">        Aggregation method for combining values in each grid cell. Default is &#39;sum&#39;. Options include:</span>
</span><span id="poly_2_grid-387"><a href="#poly_2_grid-387"><span class="linenos">387</span></a><span class="sd">        - &#39;sum&#39;: Sum of values.</span>
</span><span id="poly_2_grid-388"><a href="#poly_2_grid-388"><span class="linenos">388</span></a><span class="sd">        - &#39;max&#39;: Maximum value.</span>
</span><span id="poly_2_grid-389"><a href="#poly_2_grid-389"><span class="linenos">389</span></a><span class="sd">        - &#39;min&#39;: Minimum value.</span>
</span><span id="poly_2_grid-390"><a href="#poly_2_grid-390"><span class="linenos">390</span></a><span class="sd">        - &#39;std&#39;: Standard deviation.</span>
</span><span id="poly_2_grid-391"><a href="#poly_2_grid-391"><span class="linenos">391</span></a><span class="sd">    - output_directory : str, optional</span>
</span><span id="poly_2_grid-392"><a href="#poly_2_grid-392"><span class="linenos">392</span></a><span class="sd">        Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</span>
</span><span id="poly_2_grid-393"><a href="#poly_2_grid-393"><span class="linenos">393</span></a><span class="sd">    - output_filename : str, optional</span>
</span><span id="poly_2_grid-394"><a href="#poly_2_grid-394"><span class="linenos">394</span></a><span class="sd">        Name of the output NetCDF file (without the `.nc` extension). If not provided:</span>
</span><span id="poly_2_grid-395"><a href="#poly_2_grid-395"><span class="linenos">395</span></a><span class="sd">        - Uses the input shapefile name if a shapefile path is given.</span>
</span><span id="poly_2_grid-396"><a href="#poly_2_grid-396"><span class="linenos">396</span></a><span class="sd">        - Saves as `&quot;gridded_polygons.nc&quot;` if a GeoDataFrame is provided as input.</span>
</span><span id="poly_2_grid-397"><a href="#poly_2_grid-397"><span class="linenos">397</span></a><span class="sd">    - normalize_by_area : bool, optional</span>
</span><span id="poly_2_grid-398"><a href="#poly_2_grid-398"><span class="linenos">398</span></a><span class="sd">        If True, normalizes the grid values by area (e.g., converts to value per square meter). Default is False.</span>
</span><span id="poly_2_grid-399"><a href="#poly_2_grid-399"><span class="linenos">399</span></a><span class="sd">    - zero_is_value : bool, optional</span>
</span><span id="poly_2_grid-400"><a href="#poly_2_grid-400"><span class="linenos">400</span></a><span class="sd">        If True, treats zero values as valid data rather than as no-data. Default is False.</span>
</span><span id="poly_2_grid-401"><a href="#poly_2_grid-401"><span class="linenos">401</span></a><span class="sd">    - verbose : bool, optional</span>
</span><span id="poly_2_grid-402"><a href="#poly_2_grid-402"><span class="linenos">402</span></a><span class="sd">        If True, prints information about the process, such as global sum of values before and after gridding. Default is False.</span>
</span><span id="poly_2_grid-403"><a href="#poly_2_grid-403"><span class="linenos">403</span></a>
</span><span id="poly_2_grid-404"><a href="#poly_2_grid-404"><span class="linenos">404</span></a><span class="sd">    Returns</span>
</span><span id="poly_2_grid-405"><a href="#poly_2_grid-405"><span class="linenos">405</span></a><span class="sd">    -------</span>
</span><span id="poly_2_grid-406"><a href="#poly_2_grid-406"><span class="linenos">406</span></a><span class="sd">    - xarray.Dataset, Transformed netCDF file with gridded data derived from the input polygon data.</span>
</span><span id="poly_2_grid-407"><a href="#poly_2_grid-407"><span class="linenos">407</span></a>
</span><span id="poly_2_grid-408"><a href="#poly_2_grid-408"><span class="linenos">408</span></a><span class="sd">    Notes</span>
</span><span id="poly_2_grid-409"><a href="#poly_2_grid-409"><span class="linenos">409</span></a><span class="sd">    -----</span>
</span><span id="poly_2_grid-410"><a href="#poly_2_grid-410"><span class="linenos">410</span></a><span class="sd">    - The function supports input in the form of a shapefile or GeoDataFrame containing polygon data.</span>
</span><span id="poly_2_grid-411"><a href="#poly_2_grid-411"><span class="linenos">411</span></a><span class="sd">    - Polygon areas are calculated and aggregated based on the specified `attr_field` and `agg_function`.</span>
</span><span id="poly_2_grid-412"><a href="#poly_2_grid-412"><span class="linenos">412</span></a><span class="sd">    - If the `fraction` parameter is True, the fraction of each polygon in each grid cell will be computed, with values ranging from 0 to 1.</span>
</span><span id="poly_2_grid-413"><a href="#poly_2_grid-413"><span class="linenos">413</span></a><span class="sd">    - The function creates a netCDF file, where data variables are aggregated and stored with metadata.</span>
</span><span id="poly_2_grid-414"><a href="#poly_2_grid-414"><span class="linenos">414</span></a>
</span><span id="poly_2_grid-415"><a href="#poly_2_grid-415"><span class="linenos">415</span></a><span class="sd">    Example</span>
</span><span id="poly_2_grid-416"><a href="#poly_2_grid-416"><span class="linenos">416</span></a><span class="sd">    -------</span>
</span><span id="poly_2_grid-417"><a href="#poly_2_grid-417"><span class="linenos">417</span></a><span class="sd">    &gt;&gt;&gt; poly_2_grid(polygons=shapefile_path, </span>
</span><span id="poly_2_grid-418"><a href="#poly_2_grid-418"><span class="linenos">418</span></a><span class="sd">    ...             units=&quot;fraction&quot;, </span>
</span><span id="poly_2_grid-419"><a href="#poly_2_grid-419"><span class="linenos">419</span></a><span class="sd">    ...             source=&quot;The new global lithological map database GLiM&quot;, </span>
</span><span id="poly_2_grid-420"><a href="#poly_2_grid-420"><span class="linenos">420</span></a><span class="sd">    ...             resolution=1, </span>
</span><span id="poly_2_grid-421"><a href="#poly_2_grid-421"><span class="linenos">421</span></a><span class="sd">    ...             attr_field=&quot;Short_Name&quot;, </span>
</span><span id="poly_2_grid-422"><a href="#poly_2_grid-422"><span class="linenos">422</span></a><span class="sd">    ...             fraction=&quot;yes&quot;, </span>
</span><span id="poly_2_grid-423"><a href="#poly_2_grid-423"><span class="linenos">423</span></a><span class="sd">    ...             verbose=True</span>
</span><span id="poly_2_grid-424"><a href="#poly_2_grid-424"><span class="linenos">424</span></a><span class="sd">    ... )</span>
</span><span id="poly_2_grid-425"><a href="#poly_2_grid-425"><span class="linenos">425</span></a><span class="sd">        </span>
</span><span id="poly_2_grid-426"><a href="#poly_2_grid-426"><span class="linenos">426</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="poly_2_grid-427"><a href="#poly_2_grid-427"><span class="linenos">427</span></a>
</span><span id="poly_2_grid-428"><a href="#poly_2_grid-428"><span class="linenos">428</span></a>    <span class="c1"># Determine if input is a path (string or Path) or a GeoDataFrame</span>
</span><span id="poly_2_grid-429"><a href="#poly_2_grid-429"><span class="linenos">429</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polygons</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="poly_2_grid-430"><a href="#poly_2_grid-430"><span class="linenos">430</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="poly_2_grid-431"><a href="#poly_2_grid-431"><span class="linenos">431</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading shapefile from path...&quot;</span><span class="p">)</span>
</span><span id="poly_2_grid-432"><a href="#poly_2_grid-432"><span class="linenos">432</span></a>        <span class="n">poly_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">polygons</span><span class="p">)</span>
</span><span id="poly_2_grid-433"><a href="#poly_2_grid-433"><span class="linenos">433</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polygons</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
</span><span id="poly_2_grid-434"><a href="#poly_2_grid-434"><span class="linenos">434</span></a>        <span class="n">poly_gdf</span> <span class="o">=</span> <span class="n">polygons</span>
</span><span id="poly_2_grid-435"><a href="#poly_2_grid-435"><span class="linenos">435</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="poly_2_grid-436"><a href="#poly_2_grid-436"><span class="linenos">436</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input must be a GeoDataFrame or a shapefile path (string or Path).&quot;</span><span class="p">)</span>
</span><span id="poly_2_grid-437"><a href="#poly_2_grid-437"><span class="linenos">437</span></a>
</span><span id="poly_2_grid-438"><a href="#poly_2_grid-438"><span class="linenos">438</span></a>    <span class="c1"># create gridded polygon</span>
</span><span id="poly_2_grid-439"><a href="#poly_2_grid-439"><span class="linenos">439</span></a>    <span class="n">polygons_gdf</span> <span class="o">=</span> <span class="n">create</span><span class="o">.</span><span class="n">create_gridded_polygon</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">out_polygon_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_area</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="poly_2_grid-440"><a href="#poly_2_grid-440"><span class="linenos">440</span></a>    
</span><span id="poly_2_grid-441"><a href="#poly_2_grid-441"><span class="linenos">441</span></a>    <span class="k">if</span> <span class="n">attr_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="poly_2_grid-442"><a href="#poly_2_grid-442"><span class="linenos">442</span></a>        <span class="n">unique_rows</span> <span class="o">=</span> <span class="n">poly_gdf</span><span class="p">[</span><span class="n">attr_field</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="poly_2_grid-443"><a href="#poly_2_grid-443"><span class="linenos">443</span></a>        <span class="n">dataset_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="poly_2_grid-444"><a href="#poly_2_grid-444"><span class="linenos">444</span></a>        
</span><span id="poly_2_grid-445"><a href="#poly_2_grid-445"><span class="linenos">445</span></a>        <span class="k">for</span> <span class="n">filter_var</span> <span class="ow">in</span> <span class="n">unique_rows</span><span class="p">:</span>
</span><span id="poly_2_grid-446"><a href="#poly_2_grid-446"><span class="linenos">446</span></a>            
</span><span id="poly_2_grid-447"><a href="#poly_2_grid-447"><span class="linenos">447</span></a>            <span class="c1"># Filter the GeoDataFrame</span>
</span><span id="poly_2_grid-448"><a href="#poly_2_grid-448"><span class="linenos">448</span></a>            <span class="n">filtered_gdf</span> <span class="o">=</span> <span class="n">poly_gdf</span><span class="p">[</span><span class="n">poly_gdf</span><span class="p">[</span><span class="n">attr_field</span><span class="p">]</span> <span class="o">==</span> <span class="n">filter_var</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="poly_2_grid-449"><a href="#poly_2_grid-449"><span class="linenos">449</span></a>            <span class="c1"># Reset the index to ensure sequential indexing</span>
</span><span id="poly_2_grid-450"><a href="#poly_2_grid-450"><span class="linenos">450</span></a>            <span class="n">filtered_gdf</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="poly_2_grid-451"><a href="#poly_2_grid-451"><span class="linenos">451</span></a>
</span><span id="poly_2_grid-452"><a href="#poly_2_grid-452"><span class="linenos">452</span></a>            <span class="c1"># Determine agg_column, long_name, and units for the current iteration</span>
</span><span id="poly_2_grid-453"><a href="#poly_2_grid-453"><span class="linenos">453</span></a>            <span class="n">grid_value</span> <span class="o">=</span> <span class="s2">&quot;frac&quot;</span> <span class="k">if</span> <span class="n">fraction</span> <span class="k">else</span> <span class="s2">&quot;in_area&quot;</span>
</span><span id="poly_2_grid-454"><a href="#poly_2_grid-454"><span class="linenos">454</span></a>            <span class="n">current_long_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">reverse_replace_special_characters</span><span class="p">(</span><span class="n">filter_var</span><span class="p">)</span>
</span><span id="poly_2_grid-455"><a href="#poly_2_grid-455"><span class="linenos">455</span></a>            <span class="n">current_units</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_units_poly</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">fraction</span><span class="p">)</span>
</span><span id="poly_2_grid-456"><a href="#poly_2_grid-456"><span class="linenos">456</span></a>
</span><span id="poly_2_grid-457"><a href="#poly_2_grid-457"><span class="linenos">457</span></a>            <span class="c1"># Convert GeoDataFrame to xarray dataset</span>
</span><span id="poly_2_grid-458"><a href="#poly_2_grid-458"><span class="linenos">458</span></a>            <span class="n">ds_var</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">poly_intersect</span><span class="p">(</span><span class="n">poly_gdf</span><span class="o">=</span><span class="n">filtered_gdf</span><span class="p">,</span>
</span><span id="poly_2_grid-459"><a href="#poly_2_grid-459"><span class="linenos">459</span></a>                                            <span class="n">polygons_gdf</span><span class="o">=</span><span class="n">polygons_gdf</span><span class="p">,</span> 
</span><span id="poly_2_grid-460"><a href="#poly_2_grid-460"><span class="linenos">460</span></a>                                            <span class="n">variable_name</span><span class="o">=</span><span class="n">filter_var</span><span class="p">,</span> 
</span><span id="poly_2_grid-461"><a href="#poly_2_grid-461"><span class="linenos">461</span></a>                                            <span class="n">long_name</span><span class="o">=</span><span class="n">current_long_name</span><span class="p">,</span>
</span><span id="poly_2_grid-462"><a href="#poly_2_grid-462"><span class="linenos">462</span></a>                                            <span class="n">units</span><span class="o">=</span><span class="n">current_units</span><span class="p">,</span>
</span><span id="poly_2_grid-463"><a href="#poly_2_grid-463"><span class="linenos">463</span></a>                                            <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span id="poly_2_grid-464"><a href="#poly_2_grid-464"><span class="linenos">464</span></a>                                            <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="poly_2_grid-465"><a href="#poly_2_grid-465"><span class="linenos">465</span></a>                                            <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="poly_2_grid-466"><a href="#poly_2_grid-466"><span class="linenos">466</span></a>                                            <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">,</span> 
</span><span id="poly_2_grid-467"><a href="#poly_2_grid-467"><span class="linenos">467</span></a>                                            <span class="n">fraction</span><span class="o">=</span><span class="n">fraction</span><span class="p">,</span>
</span><span id="poly_2_grid-468"><a href="#poly_2_grid-468"><span class="linenos">468</span></a>                                            <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span>
</span><span id="poly_2_grid-469"><a href="#poly_2_grid-469"><span class="linenos">469</span></a>                                            <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span><span class="p">)</span>
</span><span id="poly_2_grid-470"><a href="#poly_2_grid-470"><span class="linenos">470</span></a>
</span><span id="poly_2_grid-471"><a href="#poly_2_grid-471"><span class="linenos">471</span></a>            <span class="c1"># Print or process verbose information</span>
</span><span id="poly_2_grid-472"><a href="#poly_2_grid-472"><span class="linenos">472</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="poly_2_grid-473"><a href="#poly_2_grid-473"><span class="linenos">473</span></a>                <span class="n">global_summary_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataframe_stats_poly</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">filtered_gdf</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="poly_2_grid-474"><a href="#poly_2_grid-474"><span class="linenos">474</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats of </span><span class="si">{</span><span class="n">filter_var</span><span class="si">}</span><span class="s2"> before gridding : </span><span class="si">{</span><span class="n">global_summary_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km2.&quot;</span><span class="p">)</span>
</span><span id="poly_2_grid-475"><a href="#poly_2_grid-475"><span class="linenos">475</span></a>                <span class="n">filter_var</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">replace_special_characters</span><span class="p">(</span><span class="n">filter_var</span><span class="p">)</span>
</span><span id="poly_2_grid-476"><a href="#poly_2_grid-476"><span class="linenos">476</span></a>                <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds_var</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">filter_var</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">grid_value</span><span class="p">,</span>
</span><span id="poly_2_grid-477"><a href="#poly_2_grid-477"><span class="linenos">477</span></a>                                                              <span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span>
</span><span id="poly_2_grid-478"><a href="#poly_2_grid-478"><span class="linenos">478</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats of </span><span class="si">{</span><span class="n">filter_var</span><span class="si">}</span><span class="s2"> after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km2.&quot;</span><span class="p">)</span>
</span><span id="poly_2_grid-479"><a href="#poly_2_grid-479"><span class="linenos">479</span></a>
</span><span id="poly_2_grid-480"><a href="#poly_2_grid-480"><span class="linenos">480</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="poly_2_grid-481"><a href="#poly_2_grid-481"><span class="linenos">481</span></a>            <span class="n">dataset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds_var</span><span class="p">)</span>
</span><span id="poly_2_grid-482"><a href="#poly_2_grid-482"><span class="linenos">482</span></a>        
</span><span id="poly_2_grid-483"><a href="#poly_2_grid-483"><span class="linenos">483</span></a>        <span class="c1"># Merge all datasets from different filtered GeoDataFrames</span>
</span><span id="poly_2_grid-484"><a href="#poly_2_grid-484"><span class="linenos">484</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataset_list</span><span class="p">)</span>
</span><span id="poly_2_grid-485"><a href="#poly_2_grid-485"><span class="linenos">485</span></a>        
</span><span id="poly_2_grid-486"><a href="#poly_2_grid-486"><span class="linenos">486</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="poly_2_grid-487"><a href="#poly_2_grid-487"><span class="linenos">487</span></a>        
</span><span id="poly_2_grid-488"><a href="#poly_2_grid-488"><span class="linenos">488</span></a>        <span class="c1"># Determine agg_column, long_name, and units</span>
</span><span id="poly_2_grid-489"><a href="#poly_2_grid-489"><span class="linenos">489</span></a>        <span class="n">grid_value</span> <span class="o">=</span> <span class="s2">&quot;frac&quot;</span> <span class="k">if</span> <span class="n">fraction</span> <span class="k">else</span> <span class="s2">&quot;in_area&quot;</span>
</span><span id="poly_2_grid-490"><a href="#poly_2_grid-490"><span class="linenos">490</span></a>        <span class="n">long_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_long_name_poly</span><span class="p">(</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">long_name</span><span class="p">,</span> <span class="n">agg_function</span><span class="p">)</span>
</span><span id="poly_2_grid-491"><a href="#poly_2_grid-491"><span class="linenos">491</span></a>        <span class="n">units</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_units_poly</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">fraction</span><span class="p">)</span>
</span><span id="poly_2_grid-492"><a href="#poly_2_grid-492"><span class="linenos">492</span></a>        
</span><span id="poly_2_grid-493"><a href="#poly_2_grid-493"><span class="linenos">493</span></a>        <span class="c1"># Convert GeoDataFrame to xarray dataset</span>
</span><span id="poly_2_grid-494"><a href="#poly_2_grid-494"><span class="linenos">494</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">poly_intersect</span><span class="p">(</span><span class="n">poly_gdf</span><span class="o">=</span><span class="n">poly_gdf</span><span class="p">,</span>
</span><span id="poly_2_grid-495"><a href="#poly_2_grid-495"><span class="linenos">495</span></a>                                        <span class="n">polygons_gdf</span><span class="o">=</span><span class="n">polygons_gdf</span><span class="p">,</span> 
</span><span id="poly_2_grid-496"><a href="#poly_2_grid-496"><span class="linenos">496</span></a>                                        <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> 
</span><span id="poly_2_grid-497"><a href="#poly_2_grid-497"><span class="linenos">497</span></a>                                        <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">,</span>
</span><span id="poly_2_grid-498"><a href="#poly_2_grid-498"><span class="linenos">498</span></a>                                        <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
</span><span id="poly_2_grid-499"><a href="#poly_2_grid-499"><span class="linenos">499</span></a>                                        <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span id="poly_2_grid-500"><a href="#poly_2_grid-500"><span class="linenos">500</span></a>                                        <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="poly_2_grid-501"><a href="#poly_2_grid-501"><span class="linenos">501</span></a>                                        <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="poly_2_grid-502"><a href="#poly_2_grid-502"><span class="linenos">502</span></a>                                        <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">,</span> 
</span><span id="poly_2_grid-503"><a href="#poly_2_grid-503"><span class="linenos">503</span></a>                                        <span class="n">fraction</span><span class="o">=</span><span class="n">fraction</span><span class="p">,</span>
</span><span id="poly_2_grid-504"><a href="#poly_2_grid-504"><span class="linenos">504</span></a>                                        <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span>
</span><span id="poly_2_grid-505"><a href="#poly_2_grid-505"><span class="linenos">505</span></a>                                        <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span><span class="p">)</span>
</span><span id="poly_2_grid-506"><a href="#poly_2_grid-506"><span class="linenos">506</span></a>
</span><span id="poly_2_grid-507"><a href="#poly_2_grid-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="poly_2_grid-508"><a href="#poly_2_grid-508"><span class="linenos">508</span></a>            <span class="n">global_summary_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataframe_stats_poly</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">poly_gdf</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">)</span>
</span><span id="poly_2_grid-509"><a href="#poly_2_grid-509"><span class="linenos">509</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats before gridding : </span><span class="si">{</span><span class="n">global_summary_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km2.&quot;</span><span class="p">)</span>
</span><span id="poly_2_grid-510"><a href="#poly_2_grid-510"><span class="linenos">510</span></a>            <span class="n">variable_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">replace_special_characters</span><span class="p">(</span><span class="n">variable_name</span><span class="p">)</span>
</span><span id="poly_2_grid-511"><a href="#poly_2_grid-511"><span class="linenos">511</span></a>            <span class="k">if</span> <span class="n">fraction</span><span class="p">:</span>
</span><span id="poly_2_grid-512"><a href="#poly_2_grid-512"><span class="linenos">512</span></a>                <span class="n">normalize_by_area</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="poly_2_grid-513"><a href="#poly_2_grid-513"><span class="linenos">513</span></a>            <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="n">grid_value</span><span class="p">,</span>
</span><span id="poly_2_grid-514"><a href="#poly_2_grid-514"><span class="linenos">514</span></a>                                                              <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span>
</span><span id="poly_2_grid-515"><a href="#poly_2_grid-515"><span class="linenos">515</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> km2.&quot;</span><span class="p">)</span>
</span><span id="poly_2_grid-516"><a href="#poly_2_grid-516"><span class="linenos">516</span></a>    
</span><span id="poly_2_grid-517"><a href="#poly_2_grid-517"><span class="linenos">517</span></a>    <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">or</span> <span class="n">output_filename</span><span class="p">:</span>
</span><span id="poly_2_grid-518"><a href="#poly_2_grid-518"><span class="linenos">518</span></a>        <span class="c1"># Set output directory</span>
</span><span id="poly_2_grid-519"><a href="#poly_2_grid-519"><span class="linenos">519</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_directory</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
</span><span id="poly_2_grid-520"><a href="#poly_2_grid-520"><span class="linenos">520</span></a>        <span class="c1"># Set base filename</span>
</span><span id="poly_2_grid-521"><a href="#poly_2_grid-521"><span class="linenos">521</span></a>        <span class="n">base_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">polygons</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polygons</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">))</span> <span class="k">else</span> <span class="s2">&quot;gridded_polygons&quot;</span>
</span><span id="poly_2_grid-522"><a href="#poly_2_grid-522"><span class="linenos">522</span></a>        <span class="c1"># Set output filename</span>
</span><span id="poly_2_grid-523"><a href="#poly_2_grid-523"><span class="linenos">523</span></a>        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">output_filename</span> <span class="ow">or</span> <span class="n">base_filename</span>
</span><span id="poly_2_grid-524"><a href="#poly_2_grid-524"><span class="linenos">524</span></a>        <span class="c1"># save the xarray dataset</span>
</span><span id="poly_2_grid-525"><a href="#poly_2_grid-525"><span class="linenos">525</span></a>        <span class="n">utils</span><span class="o">.</span><span class="n">save_to_nc</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">base_filename</span><span class="o">=</span><span class="n">base_filename</span><span class="p">)</span>
</span><span id="poly_2_grid-526"><a href="#poly_2_grid-526"><span class="linenos">526</span></a>    <span class="k">return</span> <span class="n">ds</span>  
</span></pre></div>


            <div class="docstring"><p>Converts polygon data from a shapefile or GeoDataFrame into a gridded netCDF dataset.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li>polygons : GeoDataFrame or str
Input polygons data to be gridded. Can be either a GeoDataFrame or a path to a polygons shapefile (.shp).</li>
<li>variable_name : str, optional
Name of the variable to include in the netCDF attributes metadata. Defaults to:
<ul>
<li>The unique entries in the <code>attr_field</code> column if specified.</li>
<li>The input filename without extension if <code>attr_field</code> and <code>variable_name</code> are not specified.</li>
</ul></li>
<li>long_name : str, optional
A descriptive name for the variable, added to the netCDF metadata. Behaves the same as <code>variable_name</code> if
<code>attr_field</code> is specified. Defaults to the input filename without extension if unspecified.</li>
<li>units : str, optional
Units of the data variable to include in the netCDF metadata. Default is "m2/grid-cell".</li>
<li>source : str, optional
String describing the original source of the input data. This will be added to the netCDF metadata.</li>
<li>time : str, optional
Time dimension for the output netCDF. If specified, the output will include a time dimension with the
value provided. Default is None (spatial, 2D netCDF output).</li>
<li>resolution : float, optional
Desired resolution for the grid cells in the output dataset. Default is 1 degree.</li>
<li>attr_field : str, optional
Column name in the shapefile or GeoDataFrame specifying the variable names for multiple data types.</li>
<li>fraction : bool, optional
If True, calculates the fraction of each polygon within each grid cell. The output values will range from 0 to 1.
Default is False.</li>
<li>agg_function : str, optional
Aggregation method for combining values in each grid cell. Default is 'sum'. Options include:
<ul>
<li>'sum': Sum of values.</li>
<li>'max': Maximum value.</li>
<li>'min': Minimum value.</li>
<li>'std': Standard deviation.</li>
</ul></li>
<li>output_directory : str, optional
Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</li>
<li>output_filename : str, optional
Name of the output NetCDF file (without the <code>.nc</code> extension). If not provided:
<ul>
<li>Uses the input shapefile name if a shapefile path is given.</li>
<li>Saves as <code>"gridded_polygons.nc"</code> if a GeoDataFrame is provided as input.</li>
</ul></li>
<li>normalize_by_area : bool, optional
If True, normalizes the grid values by area (e.g., converts to value per square meter). Default is False.</li>
<li>zero_is_value : bool, optional
If True, treats zero values as valid data rather than as no-data. Default is False.</li>
<li>verbose : bool, optional
If True, prints information about the process, such as global sum of values before and after gridding. Default is False.</li>
</ul>

<h2 id="returns">Returns</h2>

<ul>
<li>xarray.Dataset, Transformed netCDF file with gridded data derived from the input polygon data.</li>
</ul>

<h2 id="notes">Notes</h2>

<ul>
<li>The function supports input in the form of a shapefile or GeoDataFrame containing polygon data.</li>
<li>Polygon areas are calculated and aggregated based on the specified <code>attr_field</code> and <code>agg_function</code>.</li>
<li>If the <code>fraction</code> parameter is True, the fraction of each polygon in each grid cell will be computed, with values ranging from 0 to 1.</li>
<li>The function creates a netCDF file, where data variables are aggregated and stored with metadata.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">poly_2_grid</span><span class="p">(</span><span class="n">polygons</span><span class="o">=</span><span class="n">shapefile_path</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;fraction&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">source</span><span class="o">=</span><span class="s2">&quot;The new global lithological map database GLiM&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">attr_field</span><span class="o">=</span><span class="s2">&quot;Short_Name&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">fraction</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="grid_2_grid">
                            <input id="grid_2_grid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">grid_2_grid</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">raster_path</span>,</span><span class="param">	<span class="n">agg_function</span>,</span><span class="param">	<span class="n">variable_name</span>,</span><span class="param">	<span class="n">long_name</span>,</span><span class="param">	<span class="n">units</span><span class="o">=</span><span class="s1">&#39;value/grid-cell&#39;</span>,</span><span class="param">	<span class="n">source</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">time</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">resolution</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">netcdf_variable</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">padding</span><span class="o">=</span><span class="s1">&#39;symmetric&#39;</span>,</span><span class="param">	<span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="grid_2_grid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#grid_2_grid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="grid_2_grid-528"><a href="#grid_2_grid-528"><span class="linenos">528</span></a><span class="k">def</span> <span class="nf">grid_2_grid</span><span class="p">(</span><span class="n">raster_path</span><span class="p">,</span> <span class="n">agg_function</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">long_name</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;value/grid-cell&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">netcdf_variable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;symmetric&quot;</span><span class="p">,</span> <span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  
</span><span id="grid_2_grid-529"><a href="#grid_2_grid-529"><span class="linenos">529</span></a>
</span><span id="grid_2_grid-530"><a href="#grid_2_grid-530"><span class="linenos">530</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="grid_2_grid-531"><a href="#grid_2_grid-531"><span class="linenos">531</span></a><span class="sd">    Converts raster data (TIFF or netCDF) into a re-gridded xarray dataset.</span>
</span><span id="grid_2_grid-532"><a href="#grid_2_grid-532"><span class="linenos">532</span></a>
</span><span id="grid_2_grid-533"><a href="#grid_2_grid-533"><span class="linenos">533</span></a><span class="sd">    Parameters</span>
</span><span id="grid_2_grid-534"><a href="#grid_2_grid-534"><span class="linenos">534</span></a><span class="sd">    ----------</span>
</span><span id="grid_2_grid-535"><a href="#grid_2_grid-535"><span class="linenos">535</span></a><span class="sd">    - raster_path : str</span>
</span><span id="grid_2_grid-536"><a href="#grid_2_grid-536"><span class="linenos">536</span></a><span class="sd">        Path to the input raster data file. This can be either a TIFF or netCDF file.</span>
</span><span id="grid_2_grid-537"><a href="#grid_2_grid-537"><span class="linenos">537</span></a><span class="sd">    - agg_function : str</span>
</span><span id="grid_2_grid-538"><a href="#grid_2_grid-538"><span class="linenos">538</span></a><span class="sd">        Aggregation method to apply when re-gridding. Supported values are &#39;SUM&#39;, &#39;MEAN&#39;, or &#39;MAX&#39;.</span>
</span><span id="grid_2_grid-539"><a href="#grid_2_grid-539"><span class="linenos">539</span></a><span class="sd">    - variable_name : str</span>
</span><span id="grid_2_grid-540"><a href="#grid_2_grid-540"><span class="linenos">540</span></a><span class="sd">        Name of the variable to include in the output dataset.</span>
</span><span id="grid_2_grid-541"><a href="#grid_2_grid-541"><span class="linenos">541</span></a><span class="sd">    - long_name : str</span>
</span><span id="grid_2_grid-542"><a href="#grid_2_grid-542"><span class="linenos">542</span></a><span class="sd">        Descriptive name for the variable.</span>
</span><span id="grid_2_grid-543"><a href="#grid_2_grid-543"><span class="linenos">543</span></a><span class="sd">    - units : str, optional</span>
</span><span id="grid_2_grid-544"><a href="#grid_2_grid-544"><span class="linenos">544</span></a><span class="sd">        Units for the variable. Default is &quot;value/grid-cell&quot;.</span>
</span><span id="grid_2_grid-545"><a href="#grid_2_grid-545"><span class="linenos">545</span></a><span class="sd">    - source : str, optional</span>
</span><span id="grid_2_grid-546"><a href="#grid_2_grid-546"><span class="linenos">546</span></a><span class="sd">        Source information for the dataset. Default is None.</span>
</span><span id="grid_2_grid-547"><a href="#grid_2_grid-547"><span class="linenos">547</span></a><span class="sd">    - time : str or None, optional</span>
</span><span id="grid_2_grid-548"><a href="#grid_2_grid-548"><span class="linenos">548</span></a><span class="sd">        Time stamp or identifier for the data. Default is None.</span>
</span><span id="grid_2_grid-549"><a href="#grid_2_grid-549"><span class="linenos">549</span></a><span class="sd">    - resolution : int or float, optional</span>
</span><span id="grid_2_grid-550"><a href="#grid_2_grid-550"><span class="linenos">550</span></a><span class="sd">        Desired resolution of the grid cells in degree in the output dataset. Default is 1.</span>
</span><span id="grid_2_grid-551"><a href="#grid_2_grid-551"><span class="linenos">551</span></a><span class="sd">    - netcdf_variable : str, optional</span>
</span><span id="grid_2_grid-552"><a href="#grid_2_grid-552"><span class="linenos">552</span></a><span class="sd">        Name of the variable to extract from the netCDF file, if applicable. Required for netCDF inputs.</span>
</span><span id="grid_2_grid-553"><a href="#grid_2_grid-553"><span class="linenos">553</span></a><span class="sd">    - output_directory : str, optional</span>
</span><span id="grid_2_grid-554"><a href="#grid_2_grid-554"><span class="linenos">554</span></a><span class="sd">        Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</span>
</span><span id="grid_2_grid-555"><a href="#grid_2_grid-555"><span class="linenos">555</span></a><span class="sd">    - output_filename : str, optional</span>
</span><span id="grid_2_grid-556"><a href="#grid_2_grid-556"><span class="linenos">556</span></a><span class="sd">        Name of the output NetCDF file (without the `.nc` extension). If not provided:</span>
</span><span id="grid_2_grid-557"><a href="#grid_2_grid-557"><span class="linenos">557</span></a><span class="sd">        - Uses `variable_name` if it is specified.</span>
</span><span id="grid_2_grid-558"><a href="#grid_2_grid-558"><span class="linenos">558</span></a><span class="sd">        - Defaults to `regridded.nc` if none of the above are provided.</span>
</span><span id="grid_2_grid-559"><a href="#grid_2_grid-559"><span class="linenos">559</span></a><span class="sd">    - padding : str, optional</span>
</span><span id="grid_2_grid-560"><a href="#grid_2_grid-560"><span class="linenos">560</span></a><span class="sd">        Padding strategy (&#39;symmetric&#39; or &#39;end&#39;).</span>
</span><span id="grid_2_grid-561"><a href="#grid_2_grid-561"><span class="linenos">561</span></a><span class="sd">    - zero_is_value : bool, optional</span>
</span><span id="grid_2_grid-562"><a href="#grid_2_grid-562"><span class="linenos">562</span></a><span class="sd">        Whether to treat zero values as valid data rather than as no-data. Default is False.</span>
</span><span id="grid_2_grid-563"><a href="#grid_2_grid-563"><span class="linenos">563</span></a><span class="sd">    - normalize_by_area : bool, optional</span>
</span><span id="grid_2_grid-564"><a href="#grid_2_grid-564"><span class="linenos">564</span></a><span class="sd">        Whether to normalize grid values by area (e.g., convert to value per square meter). Default is False.</span>
</span><span id="grid_2_grid-565"><a href="#grid_2_grid-565"><span class="linenos">565</span></a><span class="sd">    - verbose : bool, optional</span>
</span><span id="grid_2_grid-566"><a href="#grid_2_grid-566"><span class="linenos">566</span></a><span class="sd">        If True, prints the global sum of values before and after re-gridding. Default is False.</span>
</span><span id="grid_2_grid-567"><a href="#grid_2_grid-567"><span class="linenos">567</span></a>
</span><span id="grid_2_grid-568"><a href="#grid_2_grid-568"><span class="linenos">568</span></a><span class="sd">    Returns</span>
</span><span id="grid_2_grid-569"><a href="#grid_2_grid-569"><span class="linenos">569</span></a><span class="sd">    -------</span>
</span><span id="grid_2_grid-570"><a href="#grid_2_grid-570"><span class="linenos">570</span></a><span class="sd">    - xarray.Dataset, Re-gridded xarray dataset containing the processed raster data.</span>
</span><span id="grid_2_grid-571"><a href="#grid_2_grid-571"><span class="linenos">571</span></a>
</span><span id="grid_2_grid-572"><a href="#grid_2_grid-572"><span class="linenos">572</span></a><span class="sd">    Notes</span>
</span><span id="grid_2_grid-573"><a href="#grid_2_grid-573"><span class="linenos">573</span></a><span class="sd">    -----</span>
</span><span id="grid_2_grid-574"><a href="#grid_2_grid-574"><span class="linenos">574</span></a><span class="sd">    This function supports raster data in TIFF or netCDF format and performs re-gridding based on </span>
</span><span id="grid_2_grid-575"><a href="#grid_2_grid-575"><span class="linenos">575</span></a><span class="sd">    the specified `agg_function`. The output dataset will include metadata such as the variable name, </span>
</span><span id="grid_2_grid-576"><a href="#grid_2_grid-576"><span class="linenos">576</span></a><span class="sd">    long name, units, and optional source and time information.</span>
</span><span id="grid_2_grid-577"><a href="#grid_2_grid-577"><span class="linenos">577</span></a><span class="sd">    </span>
</span><span id="grid_2_grid-578"><a href="#grid_2_grid-578"><span class="linenos">578</span></a><span class="sd">    Example</span>
</span><span id="grid_2_grid-579"><a href="#grid_2_grid-579"><span class="linenos">579</span></a><span class="sd">    -------</span>
</span><span id="grid_2_grid-580"><a href="#grid_2_grid-580"><span class="linenos">580</span></a><span class="sd">    &gt;&gt;&gt; grid_2_grid(raster_path=pop_path, </span>
</span><span id="grid_2_grid-581"><a href="#grid_2_grid-581"><span class="linenos">581</span></a><span class="sd">    ...             agg_function=&quot;sum&quot;, </span>
</span><span id="grid_2_grid-582"><a href="#grid_2_grid-582"><span class="linenos">582</span></a><span class="sd">    ...             variable_name=&quot;population_count&quot;, </span>
</span><span id="grid_2_grid-583"><a href="#grid_2_grid-583"><span class="linenos">583</span></a><span class="sd">    ...             long_name=&quot;Total Population&quot;, </span>
</span><span id="grid_2_grid-584"><a href="#grid_2_grid-584"><span class="linenos">584</span></a><span class="sd">    ...             units=&quot;people per grid&quot;, </span>
</span><span id="grid_2_grid-585"><a href="#grid_2_grid-585"><span class="linenos">585</span></a><span class="sd">    ...             source=&quot;WorldPop&quot;, </span>
</span><span id="grid_2_grid-586"><a href="#grid_2_grid-586"><span class="linenos">586</span></a><span class="sd">    ...             resolution=1, </span>
</span><span id="grid_2_grid-587"><a href="#grid_2_grid-587"><span class="linenos">587</span></a><span class="sd">    ...             time=&quot;2020-01-01&quot;, </span>
</span><span id="grid_2_grid-588"><a href="#grid_2_grid-588"><span class="linenos">588</span></a><span class="sd">    ...             verbose=&quot;yes&quot;</span>
</span><span id="grid_2_grid-589"><a href="#grid_2_grid-589"><span class="linenos">589</span></a><span class="sd">    ... )</span>
</span><span id="grid_2_grid-590"><a href="#grid_2_grid-590"><span class="linenos">590</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="grid_2_grid-591"><a href="#grid_2_grid-591"><span class="linenos">591</span></a>
</span><span id="grid_2_grid-592"><a href="#grid_2_grid-592"><span class="linenos">592</span></a>    <span class="c1"># Determine the file extension</span>
</span><span id="grid_2_grid-593"><a href="#grid_2_grid-593"><span class="linenos">593</span></a>    <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">raster_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="grid_2_grid-594"><a href="#grid_2_grid-594"><span class="linenos">594</span></a>
</span><span id="grid_2_grid-595"><a href="#grid_2_grid-595"><span class="linenos">595</span></a>    <span class="k">if</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s2">&quot;.tif&quot;</span><span class="p">:</span>
</span><span id="grid_2_grid-596"><a href="#grid_2_grid-596"><span class="linenos">596</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="grid_2_grid-597"><a href="#grid_2_grid-597"><span class="linenos">597</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading the tif file.&quot;</span><span class="p">)</span>
</span><span id="grid_2_grid-598"><a href="#grid_2_grid-598"><span class="linenos">598</span></a>        <span class="c1"># Convert TIFF data to a re-gridded dataset</span>
</span><span id="grid_2_grid-599"><a href="#grid_2_grid-599"><span class="linenos">599</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">tif_2_ds</span><span class="p">(</span><span class="n">input_raster</span><span class="o">=</span><span class="n">raster_path</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> 
</span><span id="grid_2_grid-600"><a href="#grid_2_grid-600"><span class="linenos">600</span></a>                      <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
</span><span id="grid_2_grid-601"><a href="#grid_2_grid-601"><span class="linenos">601</span></a>                      <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="grid_2_grid-602"><a href="#grid_2_grid-602"><span class="linenos">602</span></a>    
</span><span id="grid_2_grid-603"><a href="#grid_2_grid-603"><span class="linenos">603</span></a>    <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s2">&quot;.nc&quot;</span> <span class="ow">or</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s2">&quot;.nc4&quot;</span><span class="p">:</span>
</span><span id="grid_2_grid-604"><a href="#grid_2_grid-604"><span class="linenos">604</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="grid_2_grid-605"><a href="#grid_2_grid-605"><span class="linenos">605</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading the nc file.&quot;</span><span class="p">)</span>
</span><span id="grid_2_grid-606"><a href="#grid_2_grid-606"><span class="linenos">606</span></a>        <span class="c1"># Convert netCDF to TIFF</span>
</span><span id="grid_2_grid-607"><a href="#grid_2_grid-607"><span class="linenos">607</span></a>        <span class="n">netcdf_tif_path</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">netcdf_2_tif</span><span class="p">(</span><span class="n">netcdf_path</span><span class="o">=</span><span class="n">raster_path</span><span class="p">,</span> <span class="n">netcdf_variable</span><span class="o">=</span><span class="n">netcdf_variable</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</span><span id="grid_2_grid-608"><a href="#grid_2_grid-608"><span class="linenos">608</span></a>        <span class="c1"># Convert netCDF data to a re-gridded dataset</span>
</span><span id="grid_2_grid-609"><a href="#grid_2_grid-609"><span class="linenos">609</span></a>        <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">tif_2_ds</span><span class="p">(</span><span class="n">input_raster</span><span class="o">=</span><span class="n">netcdf_tif_path</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="n">agg_function</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> 
</span><span id="grid_2_grid-610"><a href="#grid_2_grid-610"><span class="linenos">610</span></a>                      <span class="n">long_name</span><span class="o">=</span><span class="n">long_name</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
</span><span id="grid_2_grid-611"><a href="#grid_2_grid-611"><span class="linenos">611</span></a>                      <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="grid_2_grid-612"><a href="#grid_2_grid-612"><span class="linenos">612</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="grid_2_grid-613"><a href="#grid_2_grid-613"><span class="linenos">613</span></a>        <span class="c1"># Print an error message for unrecognized file types</span>
</span><span id="grid_2_grid-614"><a href="#grid_2_grid-614"><span class="linenos">614</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: File type is not recognized. File type should be either TIFF or netCDF file.&quot;</span><span class="p">)</span>
</span><span id="grid_2_grid-615"><a href="#grid_2_grid-615"><span class="linenos">615</span></a>
</span><span id="grid_2_grid-616"><a href="#grid_2_grid-616"><span class="linenos">616</span></a>    <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">or</span> <span class="n">output_filename</span><span class="p">:</span>
</span><span id="grid_2_grid-617"><a href="#grid_2_grid-617"><span class="linenos">617</span></a>        <span class="c1"># Set output directory</span>
</span><span id="grid_2_grid-618"><a href="#grid_2_grid-618"><span class="linenos">618</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_directory</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
</span><span id="grid_2_grid-619"><a href="#grid_2_grid-619"><span class="linenos">619</span></a>        <span class="c1"># Set base filename</span>
</span><span id="grid_2_grid-620"><a href="#grid_2_grid-620"><span class="linenos">620</span></a>        <span class="n">base_filename</span> <span class="o">=</span> <span class="n">variable_name</span> <span class="ow">or</span> <span class="s2">&quot;regridded&quot;</span>
</span><span id="grid_2_grid-621"><a href="#grid_2_grid-621"><span class="linenos">621</span></a>        <span class="c1"># Set output filename</span>
</span><span id="grid_2_grid-622"><a href="#grid_2_grid-622"><span class="linenos">622</span></a>        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">output_filename</span> <span class="ow">or</span> <span class="n">base_filename</span>
</span><span id="grid_2_grid-623"><a href="#grid_2_grid-623"><span class="linenos">623</span></a>        <span class="c1"># save the xarray dataset</span>
</span><span id="grid_2_grid-624"><a href="#grid_2_grid-624"><span class="linenos">624</span></a>        <span class="n">utils</span><span class="o">.</span><span class="n">save_to_nc</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">base_filename</span><span class="o">=</span><span class="n">base_filename</span><span class="p">)</span>
</span><span id="grid_2_grid-625"><a href="#grid_2_grid-625"><span class="linenos">625</span></a>    
</span><span id="grid_2_grid-626"><a href="#grid_2_grid-626"><span class="linenos">626</span></a>    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="grid_2_grid-627"><a href="#grid_2_grid-627"><span class="linenos">627</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Re-gridding completed!&quot;</span><span class="p">)</span>
</span><span id="grid_2_grid-628"><a href="#grid_2_grid-628"><span class="linenos">628</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span></pre></div>


            <div class="docstring"><p>Converts raster data (TIFF or netCDF) into a re-gridded xarray dataset.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li>raster_path : str
Path to the input raster data file. This can be either a TIFF or netCDF file.</li>
<li>agg_function : str
Aggregation method to apply when re-gridding. Supported values are 'SUM', 'MEAN', or 'MAX'.</li>
<li>variable_name : str
Name of the variable to include in the output dataset.</li>
<li>long_name : str
Descriptive name for the variable.</li>
<li>units : str, optional
Units for the variable. Default is "value/grid-cell".</li>
<li>source : str, optional
Source information for the dataset. Default is None.</li>
<li>time : str or None, optional
Time stamp or identifier for the data. Default is None.</li>
<li>resolution : int or float, optional
Desired resolution of the grid cells in degree in the output dataset. Default is 1.</li>
<li>netcdf_variable : str, optional
Name of the variable to extract from the netCDF file, if applicable. Required for netCDF inputs.</li>
<li>output_directory : str, optional
Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</li>
<li>output_filename : str, optional
Name of the output NetCDF file (without the <code>.nc</code> extension). If not provided:
<ul>
<li>Uses <code>variable_name</code> if it is specified.</li>
<li>Defaults to <code>regridded.nc</code> if none of the above are provided.</li>
</ul></li>
<li>padding : str, optional
Padding strategy ('symmetric' or 'end').</li>
<li>zero_is_value : bool, optional
Whether to treat zero values as valid data rather than as no-data. Default is False.</li>
<li>normalize_by_area : bool, optional
Whether to normalize grid values by area (e.g., convert to value per square meter). Default is False.</li>
<li>verbose : bool, optional
If True, prints the global sum of values before and after re-gridding. Default is False.</li>
</ul>

<h2 id="returns">Returns</h2>

<ul>
<li>xarray.Dataset, Re-gridded xarray dataset containing the processed raster data.</li>
</ul>

<h2 id="notes">Notes</h2>

<p>This function supports raster data in TIFF or netCDF format and performs re-gridding based on 
the specified <code>agg_function</code>. The output dataset will include metadata such as the variable name, 
long name, units, and optional source and time information.</p>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">grid_2_grid</span><span class="p">(</span><span class="n">raster_path</span><span class="o">=</span><span class="n">pop_path</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">agg_function</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">variable_name</span><span class="o">=</span><span class="s2">&quot;population_count&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;Total Population&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;people per grid&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">source</span><span class="o">=</span><span class="s2">&quot;WorldPop&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">time</span><span class="o">=</span><span class="s2">&quot;2020-01-01&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">verbose</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="table_2_grid">
                            <input id="table_2_grid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">table_2_grid</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">surrogate_file</span>,</span><span class="param">	<span class="n">surrogate_variable</span>,</span><span class="param">	<span class="n">tabular_file</span>,</span><span class="param">	<span class="n">tabular_column</span>,</span><span class="param">	<span class="n">variable_name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">long_name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">units</span><span class="o">=</span><span class="s1">&#39;value/grid-cell&#39;</span>,</span><span class="param">	<span class="n">source</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">time</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">eez</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="table_2_grid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#table_2_grid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="table_2_grid-630"><a href="#table_2_grid-630"><span class="linenos">630</span></a><span class="k">def</span> <span class="nf">table_2_grid</span><span class="p">(</span><span class="n">surrogate_file</span><span class="p">,</span> <span class="n">surrogate_variable</span><span class="p">,</span> <span class="n">tabular_file</span><span class="p">,</span> <span class="n">tabular_column</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;value/grid-cell&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zero_is_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eez</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="table_2_grid-631"><a href="#table_2_grid-631"><span class="linenos">631</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="table_2_grid-632"><a href="#table_2_grid-632"><span class="linenos">632</span></a><span class="sd">    Convert tabular data to a gridded dataset by spatially distributing values based on a NetCDF variable and a tabular column.</span>
</span><span id="table_2_grid-633"><a href="#table_2_grid-633"><span class="linenos">633</span></a>
</span><span id="table_2_grid-634"><a href="#table_2_grid-634"><span class="linenos">634</span></a><span class="sd">    Parameters:</span>
</span><span id="table_2_grid-635"><a href="#table_2_grid-635"><span class="linenos">635</span></a><span class="sd">    -----------</span>
</span><span id="table_2_grid-636"><a href="#table_2_grid-636"><span class="linenos">636</span></a><span class="sd">    - surrogate_file : xarray.Dataset or str</span>
</span><span id="table_2_grid-637"><a href="#table_2_grid-637"><span class="linenos">637</span></a><span class="sd">        xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded </span>
</span><span id="table_2_grid-638"><a href="#table_2_grid-638"><span class="linenos">638</span></a><span class="sd">        into an xarray.Dataset. The dataset must include the variable specified in `surrogate_variable`.</span>
</span><span id="table_2_grid-639"><a href="#table_2_grid-639"><span class="linenos">639</span></a><span class="sd">    - surrogate_variable : str</span>
</span><span id="table_2_grid-640"><a href="#table_2_grid-640"><span class="linenos">640</span></a><span class="sd">        Variable name in the NetCDF or xarray dataset used for spatial distribution.</span>
</span><span id="table_2_grid-641"><a href="#table_2_grid-641"><span class="linenos">641</span></a><span class="sd">    - tabular_file : pandas.DataFrame or str</span>
</span><span id="table_2_grid-642"><a href="#table_2_grid-642"><span class="linenos">642</span></a><span class="sd">        Tabular dataset as a pandas DataFrame or a path to a CSV file. If a file path is provided, it will be </span>
</span><span id="table_2_grid-643"><a href="#table_2_grid-643"><span class="linenos">643</span></a><span class="sd">        automatically loaded into a DataFrame. The data must include a column named &quot;ISO3&quot; representing country codes. </span>
</span><span id="table_2_grid-644"><a href="#table_2_grid-644"><span class="linenos">644</span></a><span class="sd">        If not present, use the `add_iso3_column` utility function to convert country names to ISO3 codes.     </span>
</span><span id="table_2_grid-645"><a href="#table_2_grid-645"><span class="linenos">645</span></a><span class="sd">    - tabular_column : str</span>
</span><span id="table_2_grid-646"><a href="#table_2_grid-646"><span class="linenos">646</span></a><span class="sd">        Column name in the tabular dataset with values to be spatially distributed.</span>
</span><span id="table_2_grid-647"><a href="#table_2_grid-647"><span class="linenos">647</span></a><span class="sd">    - variable_name : str, optional</span>
</span><span id="table_2_grid-648"><a href="#table_2_grid-648"><span class="linenos">648</span></a><span class="sd">        Name of the variable. Default is None.</span>
</span><span id="table_2_grid-649"><a href="#table_2_grid-649"><span class="linenos">649</span></a><span class="sd">    - long_name : str, optional</span>
</span><span id="table_2_grid-650"><a href="#table_2_grid-650"><span class="linenos">650</span></a><span class="sd">        A long name for the variable. Default is None.</span>
</span><span id="table_2_grid-651"><a href="#table_2_grid-651"><span class="linenos">651</span></a><span class="sd">    - units : str, optional</span>
</span><span id="table_2_grid-652"><a href="#table_2_grid-652"><span class="linenos">652</span></a><span class="sd">        Units of the variable. Default is &#39;value/grid&#39;.</span>
</span><span id="table_2_grid-653"><a href="#table_2_grid-653"><span class="linenos">653</span></a><span class="sd">    - source : str, optional</span>
</span><span id="table_2_grid-654"><a href="#table_2_grid-654"><span class="linenos">654</span></a><span class="sd">        Source information, if available. Default is None.</span>
</span><span id="table_2_grid-655"><a href="#table_2_grid-655"><span class="linenos">655</span></a><span class="sd">    - filename : str, optional</span>
</span><span id="table_2_grid-656"><a href="#table_2_grid-656"><span class="linenos">656</span></a><span class="sd">        Additional name for the output raster file. If None, a default name will be used.</span>
</span><span id="table_2_grid-657"><a href="#table_2_grid-657"><span class="linenos">657</span></a><span class="sd">    - time : str, optional</span>
</span><span id="table_2_grid-658"><a href="#table_2_grid-658"><span class="linenos">658</span></a><span class="sd">        Time information for the dataset.</span>
</span><span id="table_2_grid-659"><a href="#table_2_grid-659"><span class="linenos">659</span></a><span class="sd">    - output_directory : str, optional</span>
</span><span id="table_2_grid-660"><a href="#table_2_grid-660"><span class="linenos">660</span></a><span class="sd">        Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</span>
</span><span id="table_2_grid-661"><a href="#table_2_grid-661"><span class="linenos">661</span></a><span class="sd">    - output_filename : str, optional</span>
</span><span id="table_2_grid-662"><a href="#table_2_grid-662"><span class="linenos">662</span></a><span class="sd">        Name of the output NetCDF file (without the `.nc` extension). If not provided:</span>
</span><span id="table_2_grid-663"><a href="#table_2_grid-663"><span class="linenos">663</span></a><span class="sd">        - Uses `variable_name` if it is specified.</span>
</span><span id="table_2_grid-664"><a href="#table_2_grid-664"><span class="linenos">664</span></a><span class="sd">        - Falls back to `long_name` or `tabular_column` if `variable_name` is not given.</span>
</span><span id="table_2_grid-665"><a href="#table_2_grid-665"><span class="linenos">665</span></a><span class="sd">        - Defaults to `gridded_table.nc` if none of the above are provided.</span>
</span><span id="table_2_grid-666"><a href="#table_2_grid-666"><span class="linenos">666</span></a><span class="sd">    - zero_is_value: bool, optional</span>
</span><span id="table_2_grid-667"><a href="#table_2_grid-667"><span class="linenos">667</span></a><span class="sd">        If the value is True, then the function will treat zero as an existent value and 0 values will be</span>
</span><span id="table_2_grid-668"><a href="#table_2_grid-668"><span class="linenos">668</span></a><span class="sd">        considered while calculating mean and STD.</span>
</span><span id="table_2_grid-669"><a href="#table_2_grid-669"><span class="linenos">669</span></a><span class="sd">    - normalize_by_area : bool, optional</span>
</span><span id="table_2_grid-670"><a href="#table_2_grid-670"><span class="linenos">670</span></a><span class="sd">        Whether to normalize grid values by area (e.g., convert to value per square meter). Default is False.</span>
</span><span id="table_2_grid-671"><a href="#table_2_grid-671"><span class="linenos">671</span></a><span class="sd">    - eez : bool, optional</span>
</span><span id="table_2_grid-672"><a href="#table_2_grid-672"><span class="linenos">672</span></a><span class="sd">        If set to True, the function converts the jurisdictional Exclusive Economic Zone (EEZ) values to a spatial grid.</span>
</span><span id="table_2_grid-673"><a href="#table_2_grid-673"><span class="linenos">673</span></a><span class="sd">    - verbose: bool, optional</span>
</span><span id="table_2_grid-674"><a href="#table_2_grid-674"><span class="linenos">674</span></a><span class="sd">        If True, the global gridded sum of before and after re-gridding operation will be printed. If any</span>
</span><span id="table_2_grid-675"><a href="#table_2_grid-675"><span class="linenos">675</span></a><span class="sd">        jurisdiction where surrogate variable is missing and tabular data is evenly distributed over the</span>
</span><span id="table_2_grid-676"><a href="#table_2_grid-676"><span class="linenos">676</span></a><span class="sd">        jurisdiction, the ISO3 codes of evenly distributed countries will also be printed.</span>
</span><span id="table_2_grid-677"><a href="#table_2_grid-677"><span class="linenos">677</span></a>
</span><span id="table_2_grid-678"><a href="#table_2_grid-678"><span class="linenos">678</span></a><span class="sd">    Returns:</span>
</span><span id="table_2_grid-679"><a href="#table_2_grid-679"><span class="linenos">679</span></a><span class="sd">    --------</span>
</span><span id="table_2_grid-680"><a href="#table_2_grid-680"><span class="linenos">680</span></a><span class="sd">    - xarray.Dataset, Resulting gridded dataset after spatial distribution of tabular values.</span>
</span><span id="table_2_grid-681"><a href="#table_2_grid-681"><span class="linenos">681</span></a>
</span><span id="table_2_grid-682"><a href="#table_2_grid-682"><span class="linenos">682</span></a><span class="sd">    Example</span>
</span><span id="table_2_grid-683"><a href="#table_2_grid-683"><span class="linenos">683</span></a><span class="sd">    -------</span>
</span><span id="table_2_grid-684"><a href="#table_2_grid-684"><span class="linenos">684</span></a><span class="sd">    &gt;&gt;&gt; table_2_grid(surrogate_file=netcdf_file_path, </span>
</span><span id="table_2_grid-685"><a href="#table_2_grid-685"><span class="linenos">685</span></a><span class="sd">    ...             surrogate_variable=&quot;railway_length&quot;, </span>
</span><span id="table_2_grid-686"><a href="#table_2_grid-686"><span class="linenos">686</span></a><span class="sd">    ...             tabular_file=csv_file_path, </span>
</span><span id="table_2_grid-687"><a href="#table_2_grid-687"><span class="linenos">687</span></a><span class="sd">    ...             tabular_column=&quot;steel&quot;, </span>
</span><span id="table_2_grid-688"><a href="#table_2_grid-688"><span class="linenos">688</span></a><span class="sd">    ...             variable_name=&quot;railtract_steel&quot;, </span>
</span><span id="table_2_grid-689"><a href="#table_2_grid-689"><span class="linenos">689</span></a><span class="sd">    ...             long_name=&quot;&#39;Railtrack Steel Mass&#39;&quot;, </span>
</span><span id="table_2_grid-690"><a href="#table_2_grid-690"><span class="linenos">690</span></a><span class="sd">    ...             units=&quot;g m-2&quot;, </span>
</span><span id="table_2_grid-691"><a href="#table_2_grid-691"><span class="linenos">691</span></a><span class="sd">    ...             source=&quot;Matitia (2022)&quot;, </span>
</span><span id="table_2_grid-692"><a href="#table_2_grid-692"><span class="linenos">692</span></a><span class="sd">    ...             normalize_by_area=&quot;yes&quot;, </span>
</span><span id="table_2_grid-693"><a href="#table_2_grid-693"><span class="linenos">693</span></a><span class="sd">    ...             verbose=&quot;yes&quot;</span>
</span><span id="table_2_grid-694"><a href="#table_2_grid-694"><span class="linenos">694</span></a><span class="sd">    ... )</span>
</span><span id="table_2_grid-695"><a href="#table_2_grid-695"><span class="linenos">695</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="table_2_grid-696"><a href="#table_2_grid-696"><span class="linenos">696</span></a>    
</span><span id="table_2_grid-697"><a href="#table_2_grid-697"><span class="linenos">697</span></a>    <span class="c1"># Load netcdf_file (either path or xarray.Dataset)</span>
</span><span id="table_2_grid-698"><a href="#table_2_grid-698"><span class="linenos">698</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">surrogate_file</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="table_2_grid-699"><a href="#table_2_grid-699"><span class="linenos">699</span></a>        <span class="n">input_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">surrogate_file</span><span class="p">)</span>
</span><span id="table_2_grid-700"><a href="#table_2_grid-700"><span class="linenos">700</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">surrogate_file</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
</span><span id="table_2_grid-701"><a href="#table_2_grid-701"><span class="linenos">701</span></a>        <span class="n">input_ds</span> <span class="o">=</span> <span class="n">surrogate_file</span>
</span><span id="table_2_grid-702"><a href="#table_2_grid-702"><span class="linenos">702</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="table_2_grid-703"><a href="#table_2_grid-703"><span class="linenos">703</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`netcdf_file` must be an xarray.Dataset or a path to a NetCDF file.&quot;</span><span class="p">)</span>
</span><span id="table_2_grid-704"><a href="#table_2_grid-704"><span class="linenos">704</span></a>
</span><span id="table_2_grid-705"><a href="#table_2_grid-705"><span class="linenos">705</span></a>    <span class="c1"># Load tabular_file (either path or pandas.DataFrame)</span>
</span><span id="table_2_grid-706"><a href="#table_2_grid-706"><span class="linenos">706</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tabular_file</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="table_2_grid-707"><a href="#table_2_grid-707"><span class="linenos">707</span></a>        <span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">tabular_file</span><span class="p">)</span>
</span><span id="table_2_grid-708"><a href="#table_2_grid-708"><span class="linenos">708</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tabular_file</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="table_2_grid-709"><a href="#table_2_grid-709"><span class="linenos">709</span></a>        <span class="n">input_df</span> <span class="o">=</span> <span class="n">tabular_file</span>
</span><span id="table_2_grid-710"><a href="#table_2_grid-710"><span class="linenos">710</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="table_2_grid-711"><a href="#table_2_grid-711"><span class="linenos">711</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`tabular_file` must be a pandas.DataFrame or a path to a CSV file.&quot;</span><span class="p">)</span>
</span><span id="table_2_grid-712"><a href="#table_2_grid-712"><span class="linenos">712</span></a>    
</span><span id="table_2_grid-713"><a href="#table_2_grid-713"><span class="linenos">713</span></a>    <span class="k">if</span> <span class="n">variable_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="table_2_grid-714"><a href="#table_2_grid-714"><span class="linenos">714</span></a>        <span class="n">variable_name</span> <span class="o">=</span> <span class="n">long_name</span> <span class="k">if</span> <span class="n">long_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">tabular_column</span>
</span><span id="table_2_grid-715"><a href="#table_2_grid-715"><span class="linenos">715</span></a>
</span><span id="table_2_grid-716"><a href="#table_2_grid-716"><span class="linenos">716</span></a>    <span class="k">if</span> <span class="n">long_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="table_2_grid-717"><a href="#table_2_grid-717"><span class="linenos">717</span></a>        <span class="n">long_name</span> <span class="o">=</span> <span class="n">variable_name</span> <span class="k">if</span> <span class="n">variable_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">tabular_column</span>
</span><span id="table_2_grid-718"><a href="#table_2_grid-718"><span class="linenos">718</span></a>
</span><span id="table_2_grid-719"><a href="#table_2_grid-719"><span class="linenos">719</span></a>    <span class="c1"># check the netcdf resolution</span>
</span><span id="table_2_grid-720"><a href="#table_2_grid-720"><span class="linenos">720</span></a>    <span class="n">resolution</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">input_ds</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="table_2_grid-721"><a href="#table_2_grid-721"><span class="linenos">721</span></a>    <span class="n">resolution_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="table_2_grid-722"><a href="#table_2_grid-722"><span class="linenos">722</span></a>
</span><span id="table_2_grid-723"><a href="#table_2_grid-723"><span class="linenos">723</span></a>    <span class="k">if</span> <span class="n">time</span><span class="p">:</span>
</span><span id="table_2_grid-724"><a href="#table_2_grid-724"><span class="linenos">724</span></a>        <span class="c1"># check and convert ISO3 based on occupation or previous control, given a specific year</span>
</span><span id="table_2_grid-725"><a href="#table_2_grid-725"><span class="linenos">725</span></a>        <span class="n">input_df</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_iso3_by_year</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">input_df</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</span><span id="table_2_grid-726"><a href="#table_2_grid-726"><span class="linenos">726</span></a>    
</span><span id="table_2_grid-727"><a href="#table_2_grid-727"><span class="linenos">727</span></a>    <span class="n">base_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
</span><span id="table_2_grid-728"><a href="#table_2_grid-728"><span class="linenos">728</span></a>    <span class="n">data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_directory</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
</span><span id="table_2_grid-729"><a href="#table_2_grid-729"><span class="linenos">729</span></a>    <span class="k">if</span> <span class="n">eez</span><span class="p">:</span>
</span><span id="table_2_grid-730"><a href="#table_2_grid-730"><span class="linenos">730</span></a>        <span class="n">country_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;eezs.1deg.nc&quot;</span><span class="p">))</span>
</span><span id="table_2_grid-731"><a href="#table_2_grid-731"><span class="linenos">731</span></a>        <span class="n">input_ds</span> <span class="o">=</span> <span class="n">input_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="table_2_grid-732"><a href="#table_2_grid-732"><span class="linenos">732</span></a>        <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="table_2_grid-733"><a href="#table_2_grid-733"><span class="linenos">733</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="table_2_grid-734"><a href="#table_2_grid-734"><span class="linenos">734</span></a>        <span class="c1"># check and print dataframe&#39;s iso3 with country fraction dataset</span>
</span><span id="table_2_grid-735"><a href="#table_2_grid-735"><span class="linenos">735</span></a>        <span class="n">utils</span><span class="o">.</span><span class="n">check_iso3_with_country_ds</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="n">resolution_str</span><span class="p">)</span>
</span><span id="table_2_grid-736"><a href="#table_2_grid-736"><span class="linenos">736</span></a>        
</span><span id="table_2_grid-737"><a href="#table_2_grid-737"><span class="linenos">737</span></a>        <span class="k">if</span> <span class="n">resolution_str</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span> <span class="ow">or</span> <span class="n">resolution_str</span> <span class="o">==</span> <span class="s2">&quot;1.0&quot;</span><span class="p">:</span>
</span><span id="table_2_grid-738"><a href="#table_2_grid-738"><span class="linenos">738</span></a>            <span class="n">country_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;country_fraction.1deg.2000-2023.a.nc&quot;</span><span class="p">))</span>
</span><span id="table_2_grid-739"><a href="#table_2_grid-739"><span class="linenos">739</span></a>            <span class="n">input_ds</span> <span class="o">=</span> <span class="n">input_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="table_2_grid-740"><a href="#table_2_grid-740"><span class="linenos">740</span></a>            <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="table_2_grid-741"><a href="#table_2_grid-741"><span class="linenos">741</span></a>
</span><span id="table_2_grid-742"><a href="#table_2_grid-742"><span class="linenos">742</span></a>        <span class="k">elif</span> <span class="n">resolution_str</span> <span class="o">==</span> <span class="s2">&quot;0.5&quot;</span><span class="p">:</span>
</span><span id="table_2_grid-743"><a href="#table_2_grid-743"><span class="linenos">743</span></a>            <span class="n">country_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;country_fraction.0_5deg.2000-2023.a.nc&quot;</span><span class="p">))</span>
</span><span id="table_2_grid-744"><a href="#table_2_grid-744"><span class="linenos">744</span></a>            <span class="n">input_ds</span> <span class="o">=</span> <span class="n">input_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="table_2_grid-745"><a href="#table_2_grid-745"><span class="linenos">745</span></a>            <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="table_2_grid-746"><a href="#table_2_grid-746"><span class="linenos">746</span></a>            
</span><span id="table_2_grid-747"><a href="#table_2_grid-747"><span class="linenos">747</span></a>        <span class="k">elif</span> <span class="n">resolution_str</span> <span class="o">==</span> <span class="s2">&quot;0.25&quot;</span><span class="p">:</span>
</span><span id="table_2_grid-748"><a href="#table_2_grid-748"><span class="linenos">748</span></a>            <span class="n">country_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;country_fraction.0_25deg.2000-2023.a.nc&quot;</span><span class="p">))</span>
</span><span id="table_2_grid-749"><a href="#table_2_grid-749"><span class="linenos">749</span></a>            <span class="n">input_ds</span> <span class="o">=</span> <span class="n">input_ds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="table_2_grid-750"><a href="#table_2_grid-750"><span class="linenos">750</span></a>            <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_ds</span><span class="p">[</span><span class="n">surrogate_variable</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="table_2_grid-751"><a href="#table_2_grid-751"><span class="linenos">751</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="table_2_grid-752"><a href="#table_2_grid-752"><span class="linenos">752</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please re-grid the netcdf file to 1, 0.5 or 0.25 degree.&quot;</span><span class="p">)</span>
</span><span id="table_2_grid-753"><a href="#table_2_grid-753"><span class="linenos">753</span></a>
</span><span id="table_2_grid-754"><a href="#table_2_grid-754"><span class="linenos">754</span></a>    <span class="n">input_ds</span><span class="p">,</span> <span class="n">country_ds</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">adjust_datasets</span><span class="p">(</span><span class="n">input_ds</span><span class="p">,</span> <span class="n">country_ds</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="table_2_grid-755"><a href="#table_2_grid-755"><span class="linenos">755</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distributing </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2"> onto </span><span class="si">{</span><span class="n">surrogate_variable</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="table_2_grid-756"><a href="#table_2_grid-756"><span class="linenos">756</span></a>
</span><span id="table_2_grid-757"><a href="#table_2_grid-757"><span class="linenos">757</span></a>    <span class="n">new_ds</span> <span class="o">=</span> <span class="n">create</span><span class="o">.</span><span class="n">create_new_ds</span><span class="p">(</span><span class="n">input_ds</span><span class="p">,</span> <span class="n">tabular_column</span><span class="p">,</span> <span class="n">country_ds</span><span class="p">,</span> <span class="n">surrogate_variable</span><span class="p">,</span> <span class="n">input_df</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
</span><span id="table_2_grid-758"><a href="#table_2_grid-758"><span class="linenos">758</span></a>
</span><span id="table_2_grid-759"><a href="#table_2_grid-759"><span class="linenos">759</span></a>    <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">new_ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
</span><span id="table_2_grid-760"><a href="#table_2_grid-760"><span class="linenos">760</span></a>        <span class="n">a</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">new_ds</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
</span><span id="table_2_grid-761"><a href="#table_2_grid-761"><span class="linenos">761</span></a>
</span><span id="table_2_grid-762"><a href="#table_2_grid-762"><span class="linenos">762</span></a>    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">input_ds</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">input_ds</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]},</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">])</span>
</span><span id="table_2_grid-763"><a href="#table_2_grid-763"><span class="linenos">763</span></a>
</span><span id="table_2_grid-764"><a href="#table_2_grid-764"><span class="linenos">764</span></a>    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;value/grid-cell&#39;</span><span class="p">:</span>
</span><span id="table_2_grid-765"><a href="#table_2_grid-765"><span class="linenos">765</span></a>        <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;value m-2&#39;</span>
</span><span id="table_2_grid-766"><a href="#table_2_grid-766"><span class="linenos">766</span></a>
</span><span id="table_2_grid-767"><a href="#table_2_grid-767"><span class="linenos">767</span></a>    <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">da_to_ds</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">long_name</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="table_2_grid-768"><a href="#table_2_grid-768"><span class="linenos">768</span></a>                        <span class="n">zero_is_value</span><span class="o">=</span><span class="n">zero_is_value</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">)</span>
</span><span id="table_2_grid-769"><a href="#table_2_grid-769"><span class="linenos">769</span></a>    
</span><span id="table_2_grid-770"><a href="#table_2_grid-770"><span class="linenos">770</span></a>    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="table_2_grid-771"><a href="#table_2_grid-771"><span class="linenos">771</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global sum of jurisdictional dataset : </span><span class="si">{</span><span class="n">input_df</span><span class="p">[[</span><span class="n">tabular_column</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="table_2_grid-772"><a href="#table_2_grid-772"><span class="linenos">772</span></a>        <span class="n">global_gridded_stats</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xarray_dataset_stats</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">agg_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize_by_area</span><span class="o">=</span><span class="n">normalize_by_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="table_2_grid-773"><a href="#table_2_grid-773"><span class="linenos">773</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global stats after gridding: </span><span class="si">{</span><span class="n">global_gridded_stats</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="table_2_grid-774"><a href="#table_2_grid-774"><span class="linenos">774</span></a>
</span><span id="table_2_grid-775"><a href="#table_2_grid-775"><span class="linenos">775</span></a>    <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">or</span> <span class="n">output_filename</span><span class="p">:</span>
</span><span id="table_2_grid-776"><a href="#table_2_grid-776"><span class="linenos">776</span></a>        <span class="c1"># Set output directory</span>
</span><span id="table_2_grid-777"><a href="#table_2_grid-777"><span class="linenos">777</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_directory</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
</span><span id="table_2_grid-778"><a href="#table_2_grid-778"><span class="linenos">778</span></a>        <span class="c1"># Set base filename</span>
</span><span id="table_2_grid-779"><a href="#table_2_grid-779"><span class="linenos">779</span></a>        <span class="n">base_filename</span> <span class="o">=</span> <span class="n">variable_name</span> <span class="ow">or</span> <span class="s2">&quot;gridded_table&quot;</span>
</span><span id="table_2_grid-780"><a href="#table_2_grid-780"><span class="linenos">780</span></a>        <span class="c1"># Set output filename</span>
</span><span id="table_2_grid-781"><a href="#table_2_grid-781"><span class="linenos">781</span></a>        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">output_filename</span> <span class="ow">or</span> <span class="n">base_filename</span>
</span><span id="table_2_grid-782"><a href="#table_2_grid-782"><span class="linenos">782</span></a>        <span class="c1"># save the xarray dataset</span>
</span><span id="table_2_grid-783"><a href="#table_2_grid-783"><span class="linenos">783</span></a>        <span class="n">utils</span><span class="o">.</span><span class="n">save_to_nc</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">output_filename</span><span class="o">=</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">base_filename</span><span class="o">=</span><span class="n">base_filename</span><span class="p">)</span>
</span><span id="table_2_grid-784"><a href="#table_2_grid-784"><span class="linenos">784</span></a>
</span><span id="table_2_grid-785"><a href="#table_2_grid-785"><span class="linenos">785</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span></pre></div>


            <div class="docstring"><p>Convert tabular data to a gridded dataset by spatially distributing values based on a NetCDF variable and a tabular column.</p>

<h2 id="parameters">Parameters:</h2>

<ul>
<li>surrogate_file : xarray.Dataset or str
xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded 
into an xarray.Dataset. The dataset must include the variable specified in <code>surrogate_variable</code>.</li>
<li>surrogate_variable : str
Variable name in the NetCDF or xarray dataset used for spatial distribution.</li>
<li>tabular_file : pandas.DataFrame or str
Tabular dataset as a pandas DataFrame or a path to a CSV file. If a file path is provided, it will be 
automatically loaded into a DataFrame. The data must include a column named "ISO3" representing country codes. 
If not present, use the <code><a href="#add_iso3_column">add_iso3_column</a></code> utility function to convert country names to ISO3 codes.     </li>
<li>tabular_column : str
Column name in the tabular dataset with values to be spatially distributed.</li>
<li>variable_name : str, optional
Name of the variable. Default is None.</li>
<li>long_name : str, optional
A long name for the variable. Default is None.</li>
<li>units : str, optional
Units of the variable. Default is 'value/grid'.</li>
<li>source : str, optional
Source information, if available. Default is None.</li>
<li>filename : str, optional
Additional name for the output raster file. If None, a default name will be used.</li>
<li>time : str, optional
Time information for the dataset.</li>
<li>output_directory : str, optional
Directory where the output NetCDF file will be saved. If None, but output_filename is True, the file will be saved in the current working directory.</li>
<li>output_filename : str, optional
Name of the output NetCDF file (without the <code>.nc</code> extension). If not provided:
<ul>
<li>Uses <code>variable_name</code> if it is specified.</li>
<li>Falls back to <code>long_name</code> or <code>tabular_column</code> if <code>variable_name</code> is not given.</li>
<li>Defaults to <code>gridded_table.nc</code> if none of the above are provided.</li>
</ul></li>
<li>zero_is_value: bool, optional
If the value is True, then the function will treat zero as an existent value and 0 values will be
considered while calculating mean and STD.</li>
<li>normalize_by_area : bool, optional
Whether to normalize grid values by area (e.g., convert to value per square meter). Default is False.</li>
<li>eez : bool, optional
If set to True, the function converts the jurisdictional Exclusive Economic Zone (EEZ) values to a spatial grid.</li>
<li>verbose: bool, optional
If True, the global gridded sum of before and after re-gridding operation will be printed. If any
jurisdiction where surrogate variable is missing and tabular data is evenly distributed over the
jurisdiction, the ISO3 codes of evenly distributed countries will also be printed.</li>
</ul>

<h2 id="returns">Returns:</h2>

<ul>
<li>xarray.Dataset, Resulting gridded dataset after spatial distribution of tabular values.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">table_2_grid</span><span class="p">(</span><span class="n">surrogate_file</span><span class="o">=</span><span class="n">netcdf_file_path</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">surrogate_variable</span><span class="o">=</span><span class="s2">&quot;railway_length&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">tabular_file</span><span class="o">=</span><span class="n">csv_file_path</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">tabular_column</span><span class="o">=</span><span class="s2">&quot;steel&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">variable_name</span><span class="o">=</span><span class="s2">&quot;railtract_steel&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;&#39;Railtrack Steel Mass&#39;&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;g m-2&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">source</span><span class="o">=</span><span class="s2">&quot;Matitia (2022)&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">normalize_by_area</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">verbose</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="grid_2_table">
                            <input id="grid_2_table-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">grid_2_table</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">grid_file</span>,</span><span class="param">	<span class="n">variables</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">time</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">grid_area</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">resolution</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">aggregation</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">agg_function</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="grid_2_table-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#grid_2_table"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="grid_2_table-787"><a href="#grid_2_table-787"><span class="linenos">787</span></a><span class="k">def</span> <span class="nf">grid_2_table</span><span class="p">(</span><span class="n">grid_file</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="grid_2_table-788"><a href="#grid_2_table-788"><span class="linenos">788</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="grid_2_table-789"><a href="#grid_2_table-789"><span class="linenos">789</span></a><span class="sd">    Process gridded data from an xarray Dataset to generate tabular data for different jurisdictions.</span>
</span><span id="grid_2_table-790"><a href="#grid_2_table-790"><span class="linenos">790</span></a>
</span><span id="grid_2_table-791"><a href="#grid_2_table-791"><span class="linenos">791</span></a><span class="sd">    Parameters:</span>
</span><span id="grid_2_table-792"><a href="#grid_2_table-792"><span class="linenos">792</span></a><span class="sd">    -----------</span>
</span><span id="grid_2_table-793"><a href="#grid_2_table-793"><span class="linenos">793</span></a><span class="sd">    - grid_file : xarray.Dataset or str</span>
</span><span id="grid_2_table-794"><a href="#grid_2_table-794"><span class="linenos">794</span></a><span class="sd">        xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="grid_2_table-795"><a href="#grid_2_table-795"><span class="linenos">795</span></a><span class="sd">    - variables : str, optional</span>
</span><span id="grid_2_table-796"><a href="#grid_2_table-796"><span class="linenos">796</span></a><span class="sd">        Variables name to be processed. It can either be one variable or list of variables. If None, all variables in the dataset (excluding predefined ones) will be considered.</span>
</span><span id="grid_2_table-797"><a href="#grid_2_table-797"><span class="linenos">797</span></a><span class="sd">    - time : str, optional</span>
</span><span id="grid_2_table-798"><a href="#grid_2_table-798"><span class="linenos">798</span></a><span class="sd">        Time slice for data processing. If provided, the nearest time slice is selected. If None, a default time slice is used.</span>
</span><span id="grid_2_table-799"><a href="#grid_2_table-799"><span class="linenos">799</span></a><span class="sd">    - resolution : float, optional</span>
</span><span id="grid_2_table-800"><a href="#grid_2_table-800"><span class="linenos">800</span></a><span class="sd">        Resolution of gridded data in degree. Default is 1 degree.</span>
</span><span id="grid_2_table-801"><a href="#grid_2_table-801"><span class="linenos">801</span></a><span class="sd">    - grid_area : str, optional</span>
</span><span id="grid_2_table-802"><a href="#grid_2_table-802"><span class="linenos">802</span></a><span class="sd">        Indicator to consider grid area during processing. If &#39;YES&#39;, the variable is multiplied by grid area.</span>
</span><span id="grid_2_table-803"><a href="#grid_2_table-803"><span class="linenos">803</span></a><span class="sd">    - aggregation : str, optional</span>
</span><span id="grid_2_table-804"><a href="#grid_2_table-804"><span class="linenos">804</span></a><span class="sd">        Aggregation level for tabular data. If &#39;continent&#39;, the data will be aggregated at the continent level.</span>
</span><span id="grid_2_table-805"><a href="#grid_2_table-805"><span class="linenos">805</span></a><span class="sd">    - agg_function : str, optional, default &#39;sum&#39;</span>
</span><span id="grid_2_table-806"><a href="#grid_2_table-806"><span class="linenos">806</span></a><span class="sd">        Aggregation method. Options: &#39;sum&#39;, &#39;mean&#39;, &#39;max&#39;, &#39;min&#39;, &#39;std&#39;.  </span>
</span><span id="grid_2_table-807"><a href="#grid_2_table-807"><span class="linenos">807</span></a><span class="sd">    Returns:</span>
</span><span id="grid_2_table-808"><a href="#grid_2_table-808"><span class="linenos">808</span></a><span class="sd">    --------</span>
</span><span id="grid_2_table-809"><a href="#grid_2_table-809"><span class="linenos">809</span></a><span class="sd">    df : pandas DataFrame</span>
</span><span id="grid_2_table-810"><a href="#grid_2_table-810"><span class="linenos">810</span></a><span class="sd">        Tabular data for different jurisdictions, including ISO3 codes, variable values, and optional &#39;Year&#39; column.</span>
</span><span id="grid_2_table-811"><a href="#grid_2_table-811"><span class="linenos">811</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="grid_2_table-812"><a href="#grid_2_table-812"><span class="linenos">812</span></a>
</span><span id="grid_2_table-813"><a href="#grid_2_table-813"><span class="linenos">813</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">grid_2_table</span><span class="p">(</span><span class="n">grid_file</span><span class="o">=</span><span class="n">grid_file</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">grid_area</span><span class="o">=</span><span class="n">grid_area</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="n">aggregation</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">agg_function</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="grid_2_table-814"><a href="#grid_2_table-814"><span class="linenos">814</span></a>    <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>Process gridded data from an xarray Dataset to generate tabular data for different jurisdictions.</p>

<h2 id="parameters">Parameters:</h2>

<ul>
<li>grid_file : xarray.Dataset or str
xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</li>
<li>variables : str, optional
Variables name to be processed. It can either be one variable or list of variables. If None, all variables in the dataset (excluding predefined ones) will be considered.</li>
<li>time : str, optional
Time slice for data processing. If provided, the nearest time slice is selected. If None, a default time slice is used.</li>
<li>resolution : float, optional
Resolution of gridded data in degree. Default is 1 degree.</li>
<li>grid_area : str, optional
Indicator to consider grid area during processing. If 'YES', the variable is multiplied by grid area.</li>
<li>aggregation : str, optional
Aggregation level for tabular data. If 'continent', the data will be aggregated at the continent level.</li>
<li>agg_function : str, optional, default 'sum'
Aggregation method. Options: 'sum', 'mean', 'max', 'min', 'std'.<br />
<h2 id="returns">Returns:</h2></li>
</ul>

<p>df : pandas DataFrame
    Tabular data for different jurisdictions, including ISO3 codes, variable values, and optional 'Year' column.</p>
</div>


                </section>
                <section id="get_netcdf_info">
                            <input id="get_netcdf_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_netcdf_info</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">netcdf_file</span>, </span><span class="param"><span class="n">variable_name</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_netcdf_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_netcdf_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_netcdf_info-816"><a href="#get_netcdf_info-816"><span class="linenos">816</span></a><span class="k">def</span> <span class="nf">get_netcdf_info</span><span class="p">(</span><span class="n">netcdf_file</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="get_netcdf_info-817"><a href="#get_netcdf_info-817"><span class="linenos">817</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_netcdf_info-818"><a href="#get_netcdf_info-818"><span class="linenos">818</span></a><span class="sd">    Extract information about variables and dimensions from a NetCDF dataset.</span>
</span><span id="get_netcdf_info-819"><a href="#get_netcdf_info-819"><span class="linenos">819</span></a>
</span><span id="get_netcdf_info-820"><a href="#get_netcdf_info-820"><span class="linenos">820</span></a><span class="sd">    Parameters</span>
</span><span id="get_netcdf_info-821"><a href="#get_netcdf_info-821"><span class="linenos">821</span></a><span class="sd">    ----------</span>
</span><span id="get_netcdf_info-822"><a href="#get_netcdf_info-822"><span class="linenos">822</span></a><span class="sd">    - netcdf_file : xarray.Dataset or str</span>
</span><span id="get_netcdf_info-823"><a href="#get_netcdf_info-823"><span class="linenos">823</span></a><span class="sd">        xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="get_netcdf_info-824"><a href="#get_netcdf_info-824"><span class="linenos">824</span></a><span class="sd">    - variable_name : str, optional</span>
</span><span id="get_netcdf_info-825"><a href="#get_netcdf_info-825"><span class="linenos">825</span></a><span class="sd">        The prefix or complete name of the variable to filter. If not provided, all variables are included.</span>
</span><span id="get_netcdf_info-826"><a href="#get_netcdf_info-826"><span class="linenos">826</span></a>
</span><span id="get_netcdf_info-827"><a href="#get_netcdf_info-827"><span class="linenos">827</span></a><span class="sd">    Returns</span>
</span><span id="get_netcdf_info-828"><a href="#get_netcdf_info-828"><span class="linenos">828</span></a><span class="sd">    -------</span>
</span><span id="get_netcdf_info-829"><a href="#get_netcdf_info-829"><span class="linenos">829</span></a><span class="sd">    - tuple, A tuple containing lists of dimensions, short names, long names, units, &amp; time values (if &#39;time&#39; exists).</span>
</span><span id="get_netcdf_info-830"><a href="#get_netcdf_info-830"><span class="linenos">830</span></a><span class="sd">        </span>
</span><span id="get_netcdf_info-831"><a href="#get_netcdf_info-831"><span class="linenos">831</span></a><span class="sd">    Example</span>
</span><span id="get_netcdf_info-832"><a href="#get_netcdf_info-832"><span class="linenos">832</span></a><span class="sd">    -------</span>
</span><span id="get_netcdf_info-833"><a href="#get_netcdf_info-833"><span class="linenos">833</span></a><span class="sd">    &gt;&gt;&gt; get_netcdf_info(netcdf_file=netcdf_file_path, </span>
</span><span id="get_netcdf_info-834"><a href="#get_netcdf_info-834"><span class="linenos">834</span></a><span class="sd">    ...                 variable_name=&quot;railway_length&quot;</span>
</span><span id="get_netcdf_info-835"><a href="#get_netcdf_info-835"><span class="linenos">835</span></a><span class="sd">    ... )</span>
</span><span id="get_netcdf_info-836"><a href="#get_netcdf_info-836"><span class="linenos">836</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_netcdf_info-837"><a href="#get_netcdf_info-837"><span class="linenos">837</span></a>
</span><span id="get_netcdf_info-838"><a href="#get_netcdf_info-838"><span class="linenos">838</span></a>    <span class="n">netcdf_info</span> <span class="o">=</span> <span class="n">get</span><span class="o">.</span><span class="n">get_netcdf_info</span><span class="p">(</span><span class="n">netcdf_file</span><span class="o">=</span><span class="n">netcdf_file</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">)</span>
</span><span id="get_netcdf_info-839"><a href="#get_netcdf_info-839"><span class="linenos">839</span></a>    <span class="k">return</span> <span class="n">netcdf_info</span>
</span></pre></div>


            <div class="docstring"><p>Extract information about variables and dimensions from a NetCDF dataset.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li>netcdf_file : xarray.Dataset or str
xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</li>
<li>variable_name : str, optional
The prefix or complete name of the variable to filter. If not provided, all variables are included.</li>
</ul>

<h2 id="returns">Returns</h2>

<ul>
<li>tuple, A tuple containing lists of dimensions, short names, long names, units, &amp; time values (if 'time' exists).</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">get_netcdf_info</span><span class="p">(</span><span class="n">netcdf_file</span><span class="o">=</span><span class="n">netcdf_file_path</span><span class="p">,</span> 
<span class="gp">... </span>                <span class="n">variable_name</span><span class="o">=</span><span class="s2">&quot;railway_length&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="add_iso3_column">
                            <input id="add_iso3_column-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_iso3_column</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df</span>, </span><span class="param"><span class="n">column</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="add_iso3_column-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#add_iso3_column"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="add_iso3_column-841"><a href="#add_iso3_column-841"><span class="linenos">841</span></a><span class="k">def</span> <span class="nf">add_iso3_column</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
</span><span id="add_iso3_column-842"><a href="#add_iso3_column-842"><span class="linenos">842</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="add_iso3_column-843"><a href="#add_iso3_column-843"><span class="linenos">843</span></a><span class="sd">    Convert country names in a DataFrame column to their corresponding ISO3 country codes.</span>
</span><span id="add_iso3_column-844"><a href="#add_iso3_column-844"><span class="linenos">844</span></a>
</span><span id="add_iso3_column-845"><a href="#add_iso3_column-845"><span class="linenos">845</span></a><span class="sd">    This function reads a JSON file containing country names and their corresponding ISO3 codes, then </span>
</span><span id="add_iso3_column-846"><a href="#add_iso3_column-846"><span class="linenos">846</span></a><span class="sd">    maps the values from the specified column in the DataFrame to their ISO3 codes based on the JSON data. </span>
</span><span id="add_iso3_column-847"><a href="#add_iso3_column-847"><span class="linenos">847</span></a><span class="sd">    The resulting ISO3 codes are added as a new column named &#39;ISO3&#39;.</span>
</span><span id="add_iso3_column-848"><a href="#add_iso3_column-848"><span class="linenos">848</span></a>
</span><span id="add_iso3_column-849"><a href="#add_iso3_column-849"><span class="linenos">849</span></a><span class="sd">    Parameters</span>
</span><span id="add_iso3_column-850"><a href="#add_iso3_column-850"><span class="linenos">850</span></a><span class="sd">    ----------</span>
</span><span id="add_iso3_column-851"><a href="#add_iso3_column-851"><span class="linenos">851</span></a><span class="sd">    - df (pandas.DataFrame): The DataFrame containing a column with country names.</span>
</span><span id="add_iso3_column-852"><a href="#add_iso3_column-852"><span class="linenos">852</span></a><span class="sd">    - column (str): The name of the column in the DataFrame that contains country names.</span>
</span><span id="add_iso3_column-853"><a href="#add_iso3_column-853"><span class="linenos">853</span></a>
</span><span id="add_iso3_column-854"><a href="#add_iso3_column-854"><span class="linenos">854</span></a><span class="sd">    Returns</span>
</span><span id="add_iso3_column-855"><a href="#add_iso3_column-855"><span class="linenos">855</span></a><span class="sd">    -------</span>
</span><span id="add_iso3_column-856"><a href="#add_iso3_column-856"><span class="linenos">856</span></a><span class="sd">    - pandas.DataFrame: The original DataFrame with an additional &#39;ISO3&#39; column containing the ISO3 country codes.</span>
</span><span id="add_iso3_column-857"><a href="#add_iso3_column-857"><span class="linenos">857</span></a>
</span><span id="add_iso3_column-858"><a href="#add_iso3_column-858"><span class="linenos">858</span></a><span class="sd">    Raises:</span>
</span><span id="add_iso3_column-859"><a href="#add_iso3_column-859"><span class="linenos">859</span></a><span class="sd">    --------</span>
</span><span id="add_iso3_column-860"><a href="#add_iso3_column-860"><span class="linenos">860</span></a><span class="sd">    - FileNotFoundError: If the JSON file containing country mappings cannot be found.</span>
</span><span id="add_iso3_column-861"><a href="#add_iso3_column-861"><span class="linenos">861</span></a><span class="sd">    - KeyError: If the specified column is not present in the DataFrame.</span>
</span><span id="add_iso3_column-862"><a href="#add_iso3_column-862"><span class="linenos">862</span></a>
</span><span id="add_iso3_column-863"><a href="#add_iso3_column-863"><span class="linenos">863</span></a><span class="sd">    Example</span>
</span><span id="add_iso3_column-864"><a href="#add_iso3_column-864"><span class="linenos">864</span></a><span class="sd">    -------</span>
</span><span id="add_iso3_column-865"><a href="#add_iso3_column-865"><span class="linenos">865</span></a><span class="sd">    &gt;&gt;&gt; add_iso3_column(df=dataframe, </span>
</span><span id="add_iso3_column-866"><a href="#add_iso3_column-866"><span class="linenos">866</span></a><span class="sd">    ...                column=&quot;Country&quot;</span>
</span><span id="add_iso3_column-867"><a href="#add_iso3_column-867"><span class="linenos">867</span></a><span class="sd">    ... )</span>
</span><span id="add_iso3_column-868"><a href="#add_iso3_column-868"><span class="linenos">868</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="add_iso3_column-869"><a href="#add_iso3_column-869"><span class="linenos">869</span></a>
</span><span id="add_iso3_column-870"><a href="#add_iso3_column-870"><span class="linenos">870</span></a>    <span class="c1"># Convert country names to ISO3</span>
</span><span id="add_iso3_column-871"><a href="#add_iso3_column-871"><span class="linenos">871</span></a>    <span class="n">base_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
</span><span id="add_iso3_column-872"><a href="#add_iso3_column-872"><span class="linenos">872</span></a>    <span class="n">data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_directory</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
</span><span id="add_iso3_column-873"><a href="#add_iso3_column-873"><span class="linenos">873</span></a>    <span class="n">json_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;Names.json&quot;</span><span class="p">)</span>
</span><span id="add_iso3_column-874"><a href="#add_iso3_column-874"><span class="linenos">874</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="add_iso3_column-875"><a href="#add_iso3_column-875"><span class="linenos">875</span></a>        <span class="n">country_iso3_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="add_iso3_column-876"><a href="#add_iso3_column-876"><span class="linenos">876</span></a>        <span class="c1"># Map the &quot;Country&quot; column to the new &quot;ISO3&quot; column</span>
</span><span id="add_iso3_column-877"><a href="#add_iso3_column-877"><span class="linenos">877</span></a>        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ISO3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">country_iso3_data</span><span class="p">)</span>
</span><span id="add_iso3_column-878"><a href="#add_iso3_column-878"><span class="linenos">878</span></a>        <span class="c1"># Print rows where the specified column has NaN values</span>
</span><span id="add_iso3_column-879"><a href="#add_iso3_column-879"><span class="linenos">879</span></a>        <span class="n">nan_iso3</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ISO3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
</span><span id="add_iso3_column-880"><a href="#add_iso3_column-880"><span class="linenos">880</span></a>        <span class="n">iso3_not_found</span> <span class="o">=</span> <span class="n">nan_iso3</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="add_iso3_column-881"><a href="#add_iso3_column-881"><span class="linenos">881</span></a>        <span class="c1"># Check if the list is not empty before printing</span>
</span><span id="add_iso3_column-882"><a href="#add_iso3_column-882"><span class="linenos">882</span></a>        <span class="k">if</span> <span class="n">iso3_not_found</span><span class="p">:</span>
</span><span id="add_iso3_column-883"><a href="#add_iso3_column-883"><span class="linenos">883</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Country Not Found: </span><span class="si">{</span><span class="n">iso3_not_found</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="add_iso3_column-884"><a href="#add_iso3_column-884"><span class="linenos">884</span></a>    <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>Convert country names in a DataFrame column to their corresponding ISO3 country codes.</p>

<p>This function reads a JSON file containing country names and their corresponding ISO3 codes, then 
maps the values from the specified column in the DataFrame to their ISO3 codes based on the JSON data. 
The resulting ISO3 codes are added as a new column named 'ISO3'.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li>df (pandas.DataFrame): The DataFrame containing a column with country names.</li>
<li>column (str): The name of the column in the DataFrame that contains country names.</li>
</ul>

<h2 id="returns">Returns</h2>

<ul>
<li>pandas.DataFrame: The original DataFrame with an additional 'ISO3' column containing the ISO3 country codes.</li>
</ul>

<h2 id="raises">Raises:</h2>

<ul>
<li>FileNotFoundError: If the JSON file containing country mappings cannot be found.</li>
<li>KeyError: If the specified column is not present in the DataFrame.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">add_iso3_column</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">dataframe</span><span class="p">,</span> 
<span class="gp">... </span>               <span class="n">column</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="plot_histogram">
                            <input id="plot_histogram-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_histogram</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dataset</span>,</span><span class="param">	<span class="n">variable</span>,</span><span class="param">	<span class="n">bin_size</span><span class="o">=</span><span class="mi">30</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span>,</span><span class="param">	<span class="n">plot_title</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">x_label</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">remove_outliers</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">log_transform</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">filename</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="plot_histogram-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_histogram"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_histogram-886"><a href="#plot_histogram-886"><span class="linenos">886</span></a><span class="k">def</span> <span class="nf">plot_histogram</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_outliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="plot_histogram-887"><a href="#plot_histogram-887"><span class="linenos">887</span></a><span class="w">    </span>
</span><span id="plot_histogram-888"><a href="#plot_histogram-888"><span class="linenos">888</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="plot_histogram-889"><a href="#plot_histogram-889"><span class="linenos">889</span></a><span class="sd">    Create a histogram for an array variable in an xarray dataset.</span>
</span><span id="plot_histogram-890"><a href="#plot_histogram-890"><span class="linenos">890</span></a><span class="sd">    Optionally remove outliers and apply log transformations.</span>
</span><span id="plot_histogram-891"><a href="#plot_histogram-891"><span class="linenos">891</span></a><span class="sd">    </span>
</span><span id="plot_histogram-892"><a href="#plot_histogram-892"><span class="linenos">892</span></a><span class="sd">    Parameters:</span>
</span><span id="plot_histogram-893"><a href="#plot_histogram-893"><span class="linenos">893</span></a><span class="sd">    - dataset : xarray.Dataset or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="plot_histogram-894"><a href="#plot_histogram-894"><span class="linenos">894</span></a><span class="sd">    - variable: str, the name of the variable to plot.</span>
</span><span id="plot_histogram-895"><a href="#plot_histogram-895"><span class="linenos">895</span></a><span class="sd">    - bin_size: int, optional, the number of bins in the histogram.</span>
</span><span id="plot_histogram-896"><a href="#plot_histogram-896"><span class="linenos">896</span></a><span class="sd">    - color: str, optional, the color of the histogram bars.</span>
</span><span id="plot_histogram-897"><a href="#plot_histogram-897"><span class="linenos">897</span></a><span class="sd">    - plot_title: str, optional, the title for the plot.</span>
</span><span id="plot_histogram-898"><a href="#plot_histogram-898"><span class="linenos">898</span></a><span class="sd">    - x_label: str, optional, the label for the x-axis.</span>
</span><span id="plot_histogram-899"><a href="#plot_histogram-899"><span class="linenos">899</span></a><span class="sd">    - remove_outliers: bool, optional, whether to remove outliers.</span>
</span><span id="plot_histogram-900"><a href="#plot_histogram-900"><span class="linenos">900</span></a><span class="sd">    - log_transform: str, optional, the type of log transformation (&#39;log10&#39;, &#39;log&#39;, &#39;log2&#39;).</span>
</span><span id="plot_histogram-901"><a href="#plot_histogram-901"><span class="linenos">901</span></a><span class="sd">    - output_dir : str, optional, Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</span>
</span><span id="plot_histogram-902"><a href="#plot_histogram-902"><span class="linenos">902</span></a><span class="sd">    - filename : str, optional, Filename (with extension) for saving the figure. If not provided, the plot is saved as &quot;output_histogram.png&quot;.</span>
</span><span id="plot_histogram-903"><a href="#plot_histogram-903"><span class="linenos">903</span></a><span class="sd">    </span>
</span><span id="plot_histogram-904"><a href="#plot_histogram-904"><span class="linenos">904</span></a><span class="sd">    Returns:</span>
</span><span id="plot_histogram-905"><a href="#plot_histogram-905"><span class="linenos">905</span></a><span class="sd">    - None, displays the plot.</span>
</span><span id="plot_histogram-906"><a href="#plot_histogram-906"><span class="linenos">906</span></a>
</span><span id="plot_histogram-907"><a href="#plot_histogram-907"><span class="linenos">907</span></a><span class="sd">    Example</span>
</span><span id="plot_histogram-908"><a href="#plot_histogram-908"><span class="linenos">908</span></a><span class="sd">    -------</span>
</span><span id="plot_histogram-909"><a href="#plot_histogram-909"><span class="linenos">909</span></a><span class="sd">    &gt;&gt;&gt; plot_histogram(dataset=dataset, </span>
</span><span id="plot_histogram-910"><a href="#plot_histogram-910"><span class="linenos">910</span></a><span class="sd">    ...                variable=&quot;railway_length&quot;, </span>
</span><span id="plot_histogram-911"><a href="#plot_histogram-911"><span class="linenos">911</span></a><span class="sd">    ...                bin_size=30, </span>
</span><span id="plot_histogram-912"><a href="#plot_histogram-912"><span class="linenos">912</span></a><span class="sd">    ...                color=&#39;blue&#39;, </span>
</span><span id="plot_histogram-913"><a href="#plot_histogram-913"><span class="linenos">913</span></a><span class="sd">    ...                plot_title=&quot;Histogram of Railway Length&quot;</span>
</span><span id="plot_histogram-914"><a href="#plot_histogram-914"><span class="linenos">914</span></a><span class="sd">    ... )</span>
</span><span id="plot_histogram-915"><a href="#plot_histogram-915"><span class="linenos">915</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="plot_histogram-916"><a href="#plot_histogram-916"><span class="linenos">916</span></a>    <span class="n">plot</span><span class="o">.</span><span class="n">plot_histogram</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">plot_title</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">remove_outliers</span><span class="p">,</span> <span class="n">log_transform</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a histogram for an array variable in an xarray dataset.
Optionally remove outliers and apply log transformations.</p>

<p>Parameters:</p>

<ul>
<li>dataset : xarray.Dataset or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</li>
<li>variable: str, the name of the variable to plot.</li>
<li>bin_size: int, optional, the number of bins in the histogram.</li>
<li>color: str, optional, the color of the histogram bars.</li>
<li>plot_title: str, optional, the title for the plot.</li>
<li>x_label: str, optional, the label for the x-axis.</li>
<li>remove_outliers: bool, optional, whether to remove outliers.</li>
<li>log_transform: str, optional, the type of log transformation ('log10', 'log', 'log2').</li>
<li>output_dir : str, optional, Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</li>
<li>filename : str, optional, Filename (with extension) for saving the figure. If not provided, the plot is saved as "output_histogram.png".</li>
</ul>

<p>Returns:</p>

<ul>
<li>None, displays the plot.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">plot_histogram</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> 
<span class="gp">... </span>               <span class="n">variable</span><span class="o">=</span><span class="s2">&quot;railway_length&quot;</span><span class="p">,</span> 
<span class="gp">... </span>               <span class="n">bin_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> 
<span class="gp">... </span>               <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> 
<span class="gp">... </span>               <span class="n">plot_title</span><span class="o">=</span><span class="s2">&quot;Histogram of Railway Length&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="plot_scatter">
                            <input id="plot_scatter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_scatter</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">variable1</span>,</span><span class="param">	<span class="n">variable2</span>,</span><span class="param">	<span class="n">dataset</span>,</span><span class="param">	<span class="n">dataset2</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span>,</span><span class="param">	<span class="n">x_label</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">y_label</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">plot_title</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">remove_outliers</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">log_transform_1</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">log_transform_2</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">equation</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">filename</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="plot_scatter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_scatter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_scatter-918"><a href="#plot_scatter-918"><span class="linenos">918</span></a><span class="k">def</span> <span class="nf">plot_scatter</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">dataset2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_outliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log_transform_1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_transform_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="plot_scatter-919"><a href="#plot_scatter-919"><span class="linenos">919</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="plot_scatter-920"><a href="#plot_scatter-920"><span class="linenos">920</span></a><span class="sd">    Create a scatter plot for two variables in an xarray dataset.</span>
</span><span id="plot_scatter-921"><a href="#plot_scatter-921"><span class="linenos">921</span></a><span class="sd">    Optionally remove outliers and apply log transformations.</span>
</span><span id="plot_scatter-922"><a href="#plot_scatter-922"><span class="linenos">922</span></a><span class="sd">    </span>
</span><span id="plot_scatter-923"><a href="#plot_scatter-923"><span class="linenos">923</span></a><span class="sd">    Parameters:</span>
</span><span id="plot_scatter-924"><a href="#plot_scatter-924"><span class="linenos">924</span></a><span class="sd">    - variable1 : str, name of the variable to be plotted on the x-axis. Must be present in `dataset`.</span>
</span><span id="plot_scatter-925"><a href="#plot_scatter-925"><span class="linenos">925</span></a><span class="sd">    - variable2 : str, name of the variable to be plotted on the y-axis. If `dataset2` is provided, this variable will be extracted from `dataset2`; otherwise, it must exist in `dataset`.</span>
</span><span id="plot_scatter-926"><a href="#plot_scatter-926"><span class="linenos">926</span></a><span class="sd">    - dataset : xarray.Dataset or str, the primary dataset or a path to a NetCDF file. This dataset must contain the variable specified by `variable1`, which will be used for the x-axis.</span>
</span><span id="plot_scatter-927"><a href="#plot_scatter-927"><span class="linenos">927</span></a><span class="sd">    - dataset2 : xarray.Dataset or str, optional, a second dataset or a path to a NetCDF file containing the variable specified by `variable2` (for the y-axis). If not provided, `dataset` will be used for both variables.</span>
</span><span id="plot_scatter-928"><a href="#plot_scatter-928"><span class="linenos">928</span></a><span class="sd">    - color: str, optional, the color map of the scatter plot.</span>
</span><span id="plot_scatter-929"><a href="#plot_scatter-929"><span class="linenos">929</span></a><span class="sd">    - x_label: str, optional, the label for the x-axis.</span>
</span><span id="plot_scatter-930"><a href="#plot_scatter-930"><span class="linenos">930</span></a><span class="sd">    - y_label: str, optional, the label for the y-axis.</span>
</span><span id="plot_scatter-931"><a href="#plot_scatter-931"><span class="linenos">931</span></a><span class="sd">    - plot_title: str, optional, the title for the plot.</span>
</span><span id="plot_scatter-932"><a href="#plot_scatter-932"><span class="linenos">932</span></a><span class="sd">    - remove_outliers: bool, optional, whether to remove outliers from the data.</span>
</span><span id="plot_scatter-933"><a href="#plot_scatter-933"><span class="linenos">933</span></a><span class="sd">    - log_transform_1: str, optional, the type of log transformation for variable1 (&#39;log10&#39;, &#39;log&#39;, &#39;log2&#39;).</span>
</span><span id="plot_scatter-934"><a href="#plot_scatter-934"><span class="linenos">934</span></a><span class="sd">    - log_transform_2: str, optional, the type of log transformation for variable2 (&#39;log10&#39;, &#39;log&#39;, &#39;log2&#39;).</span>
</span><span id="plot_scatter-935"><a href="#plot_scatter-935"><span class="linenos">935</span></a><span class="sd">    - equation : bool, optional, ff True, fits and displays a linear regression equation. </span>
</span><span id="plot_scatter-936"><a href="#plot_scatter-936"><span class="linenos">936</span></a><span class="sd">    - output_dir : str, optional, Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</span>
</span><span id="plot_scatter-937"><a href="#plot_scatter-937"><span class="linenos">937</span></a><span class="sd">    - filename : str, optional, Filename (with extension) for saving the figure. If not provided, the plot is saved as &quot;output_scatter.png&quot;.</span>
</span><span id="plot_scatter-938"><a href="#plot_scatter-938"><span class="linenos">938</span></a><span class="sd">    </span>
</span><span id="plot_scatter-939"><a href="#plot_scatter-939"><span class="linenos">939</span></a><span class="sd">    Returns:</span>
</span><span id="plot_scatter-940"><a href="#plot_scatter-940"><span class="linenos">940</span></a><span class="sd">    - None, displays the plot.</span>
</span><span id="plot_scatter-941"><a href="#plot_scatter-941"><span class="linenos">941</span></a>
</span><span id="plot_scatter-942"><a href="#plot_scatter-942"><span class="linenos">942</span></a><span class="sd">    Example</span>
</span><span id="plot_scatter-943"><a href="#plot_scatter-943"><span class="linenos">943</span></a><span class="sd">    -------</span>
</span><span id="plot_scatter-944"><a href="#plot_scatter-944"><span class="linenos">944</span></a><span class="sd">    &gt;&gt;&gt; plot_scatter(variable1=&quot;roads_gross&quot;, </span>
</span><span id="plot_scatter-945"><a href="#plot_scatter-945"><span class="linenos">945</span></a><span class="sd">    ...             variable2=&quot;buildings_gross&quot;, </span>
</span><span id="plot_scatter-946"><a href="#plot_scatter-946"><span class="linenos">946</span></a><span class="sd">    ...             dataset=ds_road, </span>
</span><span id="plot_scatter-947"><a href="#plot_scatter-947"><span class="linenos">947</span></a><span class="sd">    ...             dataset2=ds_build, </span>
</span><span id="plot_scatter-948"><a href="#plot_scatter-948"><span class="linenos">948</span></a><span class="sd">    ...             color=&#39;blue&#39;,</span>
</span><span id="plot_scatter-949"><a href="#plot_scatter-949"><span class="linenos">949</span></a><span class="sd">    ...             plot_title=&quot;Building vs Road&quot;, </span>
</span><span id="plot_scatter-950"><a href="#plot_scatter-950"><span class="linenos">950</span></a><span class="sd">    ...             remove_outliers=True, </span>
</span><span id="plot_scatter-951"><a href="#plot_scatter-951"><span class="linenos">951</span></a><span class="sd">    ...             log_transform_1=&quot;log10&quot;, </span>
</span><span id="plot_scatter-952"><a href="#plot_scatter-952"><span class="linenos">952</span></a><span class="sd">    ...             log_transform_2=&quot;log10&quot;</span>
</span><span id="plot_scatter-953"><a href="#plot_scatter-953"><span class="linenos">953</span></a><span class="sd">    ... )</span>
</span><span id="plot_scatter-954"><a href="#plot_scatter-954"><span class="linenos">954</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="plot_scatter-955"><a href="#plot_scatter-955"><span class="linenos">955</span></a>    <span class="n">plot</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">dataset2</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="p">,</span> <span class="n">plot_title</span><span class="p">,</span> <span class="n">remove_outliers</span><span class="p">,</span> <span class="n">log_transform_1</span><span class="p">,</span> <span class="n">log_transform_2</span><span class="p">,</span> <span class="n">equation</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a scatter plot for two variables in an xarray dataset.
Optionally remove outliers and apply log transformations.</p>

<p>Parameters:</p>

<ul>
<li>variable1 : str, name of the variable to be plotted on the x-axis. Must be present in <code>dataset</code>.</li>
<li>variable2 : str, name of the variable to be plotted on the y-axis. If <code>dataset2</code> is provided, this variable will be extracted from <code>dataset2</code>; otherwise, it must exist in <code>dataset</code>.</li>
<li>dataset : xarray.Dataset or str, the primary dataset or a path to a NetCDF file. This dataset must contain the variable specified by <code>variable1</code>, which will be used for the x-axis.</li>
<li>dataset2 : xarray.Dataset or str, optional, a second dataset or a path to a NetCDF file containing the variable specified by <code>variable2</code> (for the y-axis). If not provided, <code>dataset</code> will be used for both variables.</li>
<li>color: str, optional, the color map of the scatter plot.</li>
<li>x_label: str, optional, the label for the x-axis.</li>
<li>y_label: str, optional, the label for the y-axis.</li>
<li>plot_title: str, optional, the title for the plot.</li>
<li>remove_outliers: bool, optional, whether to remove outliers from the data.</li>
<li>log_transform_1: str, optional, the type of log transformation for variable1 ('log10', 'log', 'log2').</li>
<li>log_transform_2: str, optional, the type of log transformation for variable2 ('log10', 'log', 'log2').</li>
<li>equation : bool, optional, ff True, fits and displays a linear regression equation. </li>
<li>output_dir : str, optional, Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</li>
<li>filename : str, optional, Filename (with extension) for saving the figure. If not provided, the plot is saved as "output_scatter.png".</li>
</ul>

<p>Returns:</p>

<ul>
<li>None, displays the plot.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">plot_scatter</span><span class="p">(</span><span class="n">variable1</span><span class="o">=</span><span class="s2">&quot;roads_gross&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">variable2</span><span class="o">=</span><span class="s2">&quot;buildings_gross&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">dataset</span><span class="o">=</span><span class="n">ds_road</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">dataset2</span><span class="o">=</span><span class="n">ds_build</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">plot_title</span><span class="o">=</span><span class="s2">&quot;Building vs Road&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">remove_outliers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">log_transform_1</span><span class="o">=</span><span class="s2">&quot;log10&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">log_transform_2</span><span class="o">=</span><span class="s2">&quot;log10&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="plot_time_series">
                            <input id="plot_time_series-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_time_series</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dataset</span>,</span><span class="param">	<span class="n">variable</span>,</span><span class="param">	<span class="n">agg_function</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span>,</span><span class="param">	<span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;both&#39;</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span>,</span><span class="param">	<span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;Area Plot&#39;</span>,</span><span class="param">	<span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span>,</span><span class="param">	<span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span>,</span><span class="param">	<span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;Time Series Plot&#39;</span>,</span><span class="param">	<span class="n">smoothing_window</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">filename</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="plot_time_series-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_time_series"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_time_series-957"><a href="#plot_time_series-957"><span class="linenos">957</span></a><span class="k">def</span> <span class="nf">plot_time_series</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">agg_function</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;Area Plot&#39;</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;Time Series Plot&#39;</span><span class="p">,</span> <span class="n">smoothing_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="plot_time_series-958"><a href="#plot_time_series-958"><span class="linenos">958</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="plot_time_series-959"><a href="#plot_time_series-959"><span class="linenos">959</span></a><span class="sd">    Create a line plot and/or area plot for a time series data variable.</span>
</span><span id="plot_time_series-960"><a href="#plot_time_series-960"><span class="linenos">960</span></a><span class="sd">    </span>
</span><span id="plot_time_series-961"><a href="#plot_time_series-961"><span class="linenos">961</span></a><span class="sd">    Parameters:</span>
</span><span id="plot_time_series-962"><a href="#plot_time_series-962"><span class="linenos">962</span></a><span class="sd">    - dataset : xarray.Dataset or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="plot_time_series-963"><a href="#plot_time_series-963"><span class="linenos">963</span></a><span class="sd">    - variable: str, the name of the variable to plot.</span>
</span><span id="plot_time_series-964"><a href="#plot_time_series-964"><span class="linenos">964</span></a><span class="sd">    - agg_function: str, the operation to apply (&#39;sum&#39;, &#39;mean&#39;, &#39;max&#39;, &#39;std&#39;).</span>
</span><span id="plot_time_series-965"><a href="#plot_time_series-965"><span class="linenos">965</span></a><span class="sd">    - plot_type: str, optional, the type of plot (&#39;line&#39;, &#39;area&#39;, &#39;both&#39;). Default is &#39;both&#39;.</span>
</span><span id="plot_time_series-966"><a href="#plot_time_series-966"><span class="linenos">966</span></a><span class="sd">    - color: str, optional, the color of the plot. Default is &#39;blue&#39;.</span>
</span><span id="plot_time_series-967"><a href="#plot_time_series-967"><span class="linenos">967</span></a><span class="sd">    - plot_label: str, optional, the label for the plot. Default is &#39;Area Plot&#39;.</span>
</span><span id="plot_time_series-968"><a href="#plot_time_series-968"><span class="linenos">968</span></a><span class="sd">    - x_label: str, optional, the label for the x-axis. Default is &#39;Year&#39;.</span>
</span><span id="plot_time_series-969"><a href="#plot_time_series-969"><span class="linenos">969</span></a><span class="sd">    - y_label: str, optional, the label for the y-axis. Default is &#39;Value&#39;.</span>
</span><span id="plot_time_series-970"><a href="#plot_time_series-970"><span class="linenos">970</span></a><span class="sd">    - plot_title: str, optional, the title of the plot. Default is &#39;Time Series Plot&#39;.</span>
</span><span id="plot_time_series-971"><a href="#plot_time_series-971"><span class="linenos">971</span></a><span class="sd">    - smoothing_window: int, optional, the window size for rolling mean smoothing.</span>
</span><span id="plot_time_series-972"><a href="#plot_time_series-972"><span class="linenos">972</span></a><span class="sd">    - output_dir : str, optional, Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</span>
</span><span id="plot_time_series-973"><a href="#plot_time_series-973"><span class="linenos">973</span></a><span class="sd">    - filename : str, optional, Filename (with extension) for saving the figure. If not provided, the plot is saved as &quot;output_time_series.png&quot;.</span>
</span><span id="plot_time_series-974"><a href="#plot_time_series-974"><span class="linenos">974</span></a><span class="sd">    </span>
</span><span id="plot_time_series-975"><a href="#plot_time_series-975"><span class="linenos">975</span></a><span class="sd">    Returns:</span>
</span><span id="plot_time_series-976"><a href="#plot_time_series-976"><span class="linenos">976</span></a><span class="sd">    - None, displays the plot.</span>
</span><span id="plot_time_series-977"><a href="#plot_time_series-977"><span class="linenos">977</span></a>
</span><span id="plot_time_series-978"><a href="#plot_time_series-978"><span class="linenos">978</span></a><span class="sd">    Example</span>
</span><span id="plot_time_series-979"><a href="#plot_time_series-979"><span class="linenos">979</span></a><span class="sd">    -------</span>
</span><span id="plot_time_series-980"><a href="#plot_time_series-980"><span class="linenos">980</span></a><span class="sd">    &gt;&gt;&gt; plot_time_series(variable=&quot;buildings_gross&quot;, </span>
</span><span id="plot_time_series-981"><a href="#plot_time_series-981"><span class="linenos">981</span></a><span class="sd">    ...                dataset=ds_build, </span>
</span><span id="plot_time_series-982"><a href="#plot_time_series-982"><span class="linenos">982</span></a><span class="sd">    ...                agg_function=&#39;sum&#39;, </span>
</span><span id="plot_time_series-983"><a href="#plot_time_series-983"><span class="linenos">983</span></a><span class="sd">    ...                plot_type=&#39;both&#39;, </span>
</span><span id="plot_time_series-984"><a href="#plot_time_series-984"><span class="linenos">984</span></a><span class="sd">    ...                color=&#39;blue&#39;, </span>
</span><span id="plot_time_series-985"><a href="#plot_time_series-985"><span class="linenos">985</span></a><span class="sd">    ...                x_label=&#39;Year&#39;, </span>
</span><span id="plot_time_series-986"><a href="#plot_time_series-986"><span class="linenos">986</span></a><span class="sd">    ...                y_label=&#39;Value&#39;, </span>
</span><span id="plot_time_series-987"><a href="#plot_time_series-987"><span class="linenos">987</span></a><span class="sd">    ...                plot_title=&#39;Time Series Plot&#39;</span>
</span><span id="plot_time_series-988"><a href="#plot_time_series-988"><span class="linenos">988</span></a><span class="sd">    ... )    </span>
</span><span id="plot_time_series-989"><a href="#plot_time_series-989"><span class="linenos">989</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="plot_time_series-990"><a href="#plot_time_series-990"><span class="linenos">990</span></a>    
</span><span id="plot_time_series-991"><a href="#plot_time_series-991"><span class="linenos">991</span></a>    <span class="n">plot</span><span class="o">.</span><span class="n">plot_time_series</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">agg_function</span><span class="p">,</span> <span class="n">plot_type</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">plot_label</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="p">,</span> <span class="n">plot_title</span><span class="p">,</span> <span class="n">smoothing_window</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a line plot and/or area plot for a time series data variable.</p>

<p>Parameters:</p>

<ul>
<li>dataset : xarray.Dataset or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</li>
<li>variable: str, the name of the variable to plot.</li>
<li>agg_function: str, the operation to apply ('sum', 'mean', 'max', 'std').</li>
<li>plot_type: str, optional, the type of plot ('line', 'area', 'both'). Default is 'both'.</li>
<li>color: str, optional, the color of the plot. Default is 'blue'.</li>
<li>plot_label: str, optional, the label for the plot. Default is 'Area Plot'.</li>
<li>x_label: str, optional, the label for the x-axis. Default is 'Year'.</li>
<li>y_label: str, optional, the label for the y-axis. Default is 'Value'.</li>
<li>plot_title: str, optional, the title of the plot. Default is 'Time Series Plot'.</li>
<li>smoothing_window: int, optional, the window size for rolling mean smoothing.</li>
<li>output_dir : str, optional, Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</li>
<li>filename : str, optional, Filename (with extension) for saving the figure. If not provided, the plot is saved as "output_time_series.png".</li>
</ul>

<p>Returns:</p>

<ul>
<li>None, displays the plot.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">plot_time_series</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="s2">&quot;buildings_gross&quot;</span><span class="p">,</span> 
<span class="gp">... </span>               <span class="n">dataset</span><span class="o">=</span><span class="n">ds_build</span><span class="p">,</span> 
<span class="gp">... </span>               <span class="n">agg_function</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> 
<span class="gp">... </span>               <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> 
<span class="gp">... </span>               <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> 
<span class="gp">... </span>               <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> 
<span class="gp">... </span>               <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> 
<span class="gp">... </span>               <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;Time Series Plot&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="plot_hexbin">
                            <input id="plot_hexbin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_hexbin</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">variable1</span>,</span><span class="param">	<span class="n">variable2</span>,</span><span class="param">	<span class="n">dataset</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">dataset2</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink_r&#39;</span>,</span><span class="param">	<span class="n">grid_size</span><span class="o">=</span><span class="mi">30</span>,</span><span class="param">	<span class="n">x_label</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">y_label</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">plot_title</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">remove_outliers</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">log_transform_1</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">log_transform_2</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">filename</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="plot_hexbin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_hexbin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_hexbin-993"><a href="#plot_hexbin-993"><span class="linenos"> 993</span></a><span class="k">def</span> <span class="nf">plot_hexbin</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dataset2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink_r&#39;</span><span class="p">,</span> <span class="n">grid_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_outliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log_transform_1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_transform_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="plot_hexbin-994"><a href="#plot_hexbin-994"><span class="linenos"> 994</span></a><span class="w">    </span>
</span><span id="plot_hexbin-995"><a href="#plot_hexbin-995"><span class="linenos"> 995</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="plot_hexbin-996"><a href="#plot_hexbin-996"><span class="linenos"> 996</span></a><span class="sd">    Create a hexbin plot for two variables in an xarray dataset.</span>
</span><span id="plot_hexbin-997"><a href="#plot_hexbin-997"><span class="linenos"> 997</span></a>
</span><span id="plot_hexbin-998"><a href="#plot_hexbin-998"><span class="linenos"> 998</span></a><span class="sd">    Parameters:</span>
</span><span id="plot_hexbin-999"><a href="#plot_hexbin-999"><span class="linenos"> 999</span></a><span class="sd">    - variable1 : str, name of the variable to be plotted on the x-axis. Must be present in `dataset`.</span>
</span><span id="plot_hexbin-1000"><a href="#plot_hexbin-1000"><span class="linenos">1000</span></a><span class="sd">    - variable2 : str, name of the variable to be plotted on the y-axis. If `dataset2` is provided, this variable will be extracted from `dataset2`; otherwise, it must exist in `dataset`.</span>
</span><span id="plot_hexbin-1001"><a href="#plot_hexbin-1001"><span class="linenos">1001</span></a><span class="sd">    - dataset : xarray.Dataset or str, the primary dataset or a path to a NetCDF file. This dataset must contain the variable specified by `variable1`, which will be used for the x-axis.</span>
</span><span id="plot_hexbin-1002"><a href="#plot_hexbin-1002"><span class="linenos">1002</span></a><span class="sd">    - dataset2 : xarray.Dataset or str, optional, a second dataset or a path to a NetCDF file containing the variable specified by `variable2` (for the y-axis). If not provided, `dataset` will be used for both variables.</span>
</span><span id="plot_hexbin-1003"><a href="#plot_hexbin-1003"><span class="linenos">1003</span></a><span class="sd">    - color: str, optional, the color map of the hexbin plot.</span>
</span><span id="plot_hexbin-1004"><a href="#plot_hexbin-1004"><span class="linenos">1004</span></a><span class="sd">    - grid_size: int, optional, the number of hexagons in the x-direction.</span>
</span><span id="plot_hexbin-1005"><a href="#plot_hexbin-1005"><span class="linenos">1005</span></a><span class="sd">    - x_label: str, optional, the label for the x-axis.</span>
</span><span id="plot_hexbin-1006"><a href="#plot_hexbin-1006"><span class="linenos">1006</span></a><span class="sd">    - y_label: str, optional, the label for the y-axis.</span>
</span><span id="plot_hexbin-1007"><a href="#plot_hexbin-1007"><span class="linenos">1007</span></a><span class="sd">    - plot_title: str, optional, the title for the plot.</span>
</span><span id="plot_hexbin-1008"><a href="#plot_hexbin-1008"><span class="linenos">1008</span></a><span class="sd">    - remove_outliers: bool, optional, whether to remove outliers from the data.</span>
</span><span id="plot_hexbin-1009"><a href="#plot_hexbin-1009"><span class="linenos">1009</span></a><span class="sd">    - log_transform_1: str, optional, the type of log transformation for variable1 (&#39;log10&#39;, &#39;log&#39;, &#39;log2&#39;).</span>
</span><span id="plot_hexbin-1010"><a href="#plot_hexbin-1010"><span class="linenos">1010</span></a><span class="sd">    - log_transform_2: str, optional, the type of log transformation for variable2 (&#39;log10&#39;, &#39;log&#39;, &#39;log2&#39;).</span>
</span><span id="plot_hexbin-1011"><a href="#plot_hexbin-1011"><span class="linenos">1011</span></a><span class="sd">    - output_dir : str, optional, Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</span>
</span><span id="plot_hexbin-1012"><a href="#plot_hexbin-1012"><span class="linenos">1012</span></a><span class="sd">    - filename : str, optional, Filename (with extension) for saving the figure. If not provided, the plot is saved as &quot;output_hexbin.png&quot;.</span>
</span><span id="plot_hexbin-1013"><a href="#plot_hexbin-1013"><span class="linenos">1013</span></a><span class="sd">    </span>
</span><span id="plot_hexbin-1014"><a href="#plot_hexbin-1014"><span class="linenos">1014</span></a><span class="sd">    Returns:</span>
</span><span id="plot_hexbin-1015"><a href="#plot_hexbin-1015"><span class="linenos">1015</span></a><span class="sd">    - None, displays the plot.</span>
</span><span id="plot_hexbin-1016"><a href="#plot_hexbin-1016"><span class="linenos">1016</span></a><span class="sd">    Example</span>
</span><span id="plot_hexbin-1017"><a href="#plot_hexbin-1017"><span class="linenos">1017</span></a><span class="sd">    -------</span>
</span><span id="plot_hexbin-1018"><a href="#plot_hexbin-1018"><span class="linenos">1018</span></a><span class="sd">    &gt;&gt;&gt; plot_hexbin(variable1=&quot;roads_gross&quot;, </span>
</span><span id="plot_hexbin-1019"><a href="#plot_hexbin-1019"><span class="linenos">1019</span></a><span class="sd">    ...             variable2=&quot;buildings_gross&quot;, </span>
</span><span id="plot_hexbin-1020"><a href="#plot_hexbin-1020"><span class="linenos">1020</span></a><span class="sd">    ...             dataset=ds_road, </span>
</span><span id="plot_hexbin-1021"><a href="#plot_hexbin-1021"><span class="linenos">1021</span></a><span class="sd">    ...             dataset2=ds_build, </span>
</span><span id="plot_hexbin-1022"><a href="#plot_hexbin-1022"><span class="linenos">1022</span></a><span class="sd">    ...             color=&#39;blue&#39;, </span>
</span><span id="plot_hexbin-1023"><a href="#plot_hexbin-1023"><span class="linenos">1023</span></a><span class="sd">    ...             plot_title=&quot;Building vs Road&quot;</span>
</span><span id="plot_hexbin-1024"><a href="#plot_hexbin-1024"><span class="linenos">1024</span></a><span class="sd">    ... )</span>
</span><span id="plot_hexbin-1025"><a href="#plot_hexbin-1025"><span class="linenos">1025</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="plot_hexbin-1026"><a href="#plot_hexbin-1026"><span class="linenos">1026</span></a>    
</span><span id="plot_hexbin-1027"><a href="#plot_hexbin-1027"><span class="linenos">1027</span></a>    <span class="n">plot</span><span class="o">.</span><span class="n">plot_hexbin</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">dataset2</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="p">,</span> <span class="n">plot_title</span><span class="p">,</span> <span class="n">remove_outliers</span><span class="p">,</span> <span class="n">log_transform_1</span><span class="p">,</span> <span class="n">log_transform_2</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a hexbin plot for two variables in an xarray dataset.</p>

<p>Parameters:</p>

<ul>
<li>variable1 : str, name of the variable to be plotted on the x-axis. Must be present in <code>dataset</code>.</li>
<li>variable2 : str, name of the variable to be plotted on the y-axis. If <code>dataset2</code> is provided, this variable will be extracted from <code>dataset2</code>; otherwise, it must exist in <code>dataset</code>.</li>
<li>dataset : xarray.Dataset or str, the primary dataset or a path to a NetCDF file. This dataset must contain the variable specified by <code>variable1</code>, which will be used for the x-axis.</li>
<li>dataset2 : xarray.Dataset or str, optional, a second dataset or a path to a NetCDF file containing the variable specified by <code>variable2</code> (for the y-axis). If not provided, <code>dataset</code> will be used for both variables.</li>
<li>color: str, optional, the color map of the hexbin plot.</li>
<li>grid_size: int, optional, the number of hexagons in the x-direction.</li>
<li>x_label: str, optional, the label for the x-axis.</li>
<li>y_label: str, optional, the label for the y-axis.</li>
<li>plot_title: str, optional, the title for the plot.</li>
<li>remove_outliers: bool, optional, whether to remove outliers from the data.</li>
<li>log_transform_1: str, optional, the type of log transformation for variable1 ('log10', 'log', 'log2').</li>
<li>log_transform_2: str, optional, the type of log transformation for variable2 ('log10', 'log', 'log2').</li>
<li>output_dir : str, optional, Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</li>
<li>filename : str, optional, Filename (with extension) for saving the figure. If not provided, the plot is saved as "output_hexbin.png".</li>
</ul>

<p>Returns:</p>

<ul>
<li>None, displays the plot.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">plot_hexbin</span><span class="p">(</span><span class="n">variable1</span><span class="o">=</span><span class="s2">&quot;roads_gross&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">variable2</span><span class="o">=</span><span class="s2">&quot;buildings_gross&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">dataset</span><span class="o">=</span><span class="n">ds_road</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">dataset2</span><span class="o">=</span><span class="n">ds_build</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">plot_title</span><span class="o">=</span><span class="s2">&quot;Building vs Road&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="plot_map">
                            <input id="plot_map-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_map</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">variable</span>,</span><span class="param">	<span class="n">dataset</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="s1">&#39;hot_r&#39;</span>,</span><span class="param">	<span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">vmin</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">vmax</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">extend_min</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">extend_max</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">levels</span><span class="o">=</span><span class="mi">10</span>,</span><span class="param">	<span class="n">out_bound</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">remove_ata</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">filename</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">show</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="plot_map-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_map"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_map-1029"><a href="#plot_map-1029"><span class="linenos">1029</span></a><span class="k">def</span> <span class="nf">plot_map</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;hot_r&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extend_min</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extend_max</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">out_bound</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">remove_ata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="plot_map-1030"><a href="#plot_map-1030"><span class="linenos">1030</span></a><span class="w">    </span>
</span><span id="plot_map-1031"><a href="#plot_map-1031"><span class="linenos">1031</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="plot_map-1032"><a href="#plot_map-1032"><span class="linenos">1032</span></a><span class="sd">    Plots a 2D map of a variable from an xarray Dataset or NetCDF file with customizable colorbar, projection, and map appearance.</span>
</span><span id="plot_map-1033"><a href="#plot_map-1033"><span class="linenos">1033</span></a>
</span><span id="plot_map-1034"><a href="#plot_map-1034"><span class="linenos">1034</span></a><span class="sd">    Parameters</span>
</span><span id="plot_map-1035"><a href="#plot_map-1035"><span class="linenos">1035</span></a><span class="sd">    ----------</span>
</span><span id="plot_map-1036"><a href="#plot_map-1036"><span class="linenos">1036</span></a><span class="sd">    variable : str</span>
</span><span id="plot_map-1037"><a href="#plot_map-1037"><span class="linenos">1037</span></a><span class="sd">        Name of the variable in the xarray Dataset to plot.</span>
</span><span id="plot_map-1038"><a href="#plot_map-1038"><span class="linenos">1038</span></a><span class="sd">    dataset : xarray.Dataset, or str</span>
</span><span id="plot_map-1039"><a href="#plot_map-1039"><span class="linenos">1039</span></a><span class="sd">        xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="plot_map-1040"><a href="#plot_map-1040"><span class="linenos">1040</span></a><span class="sd">    color : str, default &#39;hot_r&#39;</span>
</span><span id="plot_map-1041"><a href="#plot_map-1041"><span class="linenos">1041</span></a><span class="sd">        Matplotlib colormap name for the plot (discrete color scale).</span>
</span><span id="plot_map-1042"><a href="#plot_map-1042"><span class="linenos">1042</span></a><span class="sd">    title : str, default &#39;&#39;</span>
</span><span id="plot_map-1043"><a href="#plot_map-1043"><span class="linenos">1043</span></a><span class="sd">        Title of the map.</span>
</span><span id="plot_map-1044"><a href="#plot_map-1044"><span class="linenos">1044</span></a><span class="sd">    label : str, default &#39;&#39;</span>
</span><span id="plot_map-1045"><a href="#plot_map-1045"><span class="linenos">1045</span></a><span class="sd">        Label for the colorbar.</span>
</span><span id="plot_map-1046"><a href="#plot_map-1046"><span class="linenos">1046</span></a><span class="sd">    vmin : float, optional</span>
</span><span id="plot_map-1047"><a href="#plot_map-1047"><span class="linenos">1047</span></a><span class="sd">        Minimum data value for the colorbar range. If not provided, the minimum of the variable is used.</span>
</span><span id="plot_map-1048"><a href="#plot_map-1048"><span class="linenos">1048</span></a><span class="sd">    vmax : float, optional</span>
</span><span id="plot_map-1049"><a href="#plot_map-1049"><span class="linenos">1049</span></a><span class="sd">        Maximum data value for the colorbar range. If not provided, the maximum of the variable is used.</span>
</span><span id="plot_map-1050"><a href="#plot_map-1050"><span class="linenos">1050</span></a><span class="sd">    extend_min : bool, default False</span>
</span><span id="plot_map-1051"><a href="#plot_map-1051"><span class="linenos">1051</span></a><span class="sd">        If True, includes values below `vmin` in the first color class and shows a left arrow on the colorbar.</span>
</span><span id="plot_map-1052"><a href="#plot_map-1052"><span class="linenos">1052</span></a><span class="sd">    extend_max : bool, default False</span>
</span><span id="plot_map-1053"><a href="#plot_map-1053"><span class="linenos">1053</span></a><span class="sd">        If True, includes values above `vmax` in the last color class and shows a right arrow on the colorbar.</span>
</span><span id="plot_map-1054"><a href="#plot_map-1054"><span class="linenos">1054</span></a><span class="sd">    levels : int or list of float, default 10</span>
</span><span id="plot_map-1055"><a href="#plot_map-1055"><span class="linenos">1055</span></a><span class="sd">        Either the number of color intervals or a list of explicit interval boundaries.</span>
</span><span id="plot_map-1056"><a href="#plot_map-1056"><span class="linenos">1056</span></a><span class="sd">    out_bound : bool, default True</span>
</span><span id="plot_map-1057"><a href="#plot_map-1057"><span class="linenos">1057</span></a><span class="sd">        Whether to display the outer boundary (spine) of the map projection.</span>
</span><span id="plot_map-1058"><a href="#plot_map-1058"><span class="linenos">1058</span></a><span class="sd">    remove_ata : bool, default False</span>
</span><span id="plot_map-1059"><a href="#plot_map-1059"><span class="linenos">1059</span></a><span class="sd">        If True, removes Antarctica from the map by excluding data below 60S latitude.</span>
</span><span id="plot_map-1060"><a href="#plot_map-1060"><span class="linenos">1060</span></a><span class="sd">    output_dir : str, optional</span>
</span><span id="plot_map-1061"><a href="#plot_map-1061"><span class="linenos">1061</span></a><span class="sd">        Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</span>
</span><span id="plot_map-1062"><a href="#plot_map-1062"><span class="linenos">1062</span></a><span class="sd">    filename : str, optional</span>
</span><span id="plot_map-1063"><a href="#plot_map-1063"><span class="linenos">1063</span></a><span class="sd">        Filename (with extension) for saving the figure. If not provided, the plot is saved as &quot;output_plot.png&quot;.</span>
</span><span id="plot_map-1064"><a href="#plot_map-1064"><span class="linenos">1064</span></a><span class="sd">    show: bool, True</span>
</span><span id="plot_map-1065"><a href="#plot_map-1065"><span class="linenos">1065</span></a><span class="sd">        Whether or not show the map</span>
</span><span id="plot_map-1066"><a href="#plot_map-1066"><span class="linenos">1066</span></a>
</span><span id="plot_map-1067"><a href="#plot_map-1067"><span class="linenos">1067</span></a><span class="sd">    Notes</span>
</span><span id="plot_map-1068"><a href="#plot_map-1068"><span class="linenos">1068</span></a><span class="sd">    -----</span>
</span><span id="plot_map-1069"><a href="#plot_map-1069"><span class="linenos">1069</span></a><span class="sd">    - If both `extend_min` and `extend_max` are False, the dataset is clipped strictly within [vmin, vmax].</span>
</span><span id="plot_map-1070"><a href="#plot_map-1070"><span class="linenos">1070</span></a><span class="sd">    - The colorbar will use arrows to indicate out-of-bound values only if `extend_min` or `extend_max` is True.</span>
</span><span id="plot_map-1071"><a href="#plot_map-1071"><span class="linenos">1071</span></a><span class="sd">    - Tick formatting on the colorbar is:</span>
</span><span id="plot_map-1072"><a href="#plot_map-1072"><span class="linenos">1072</span></a><span class="sd">        - Two decimal places if (vmax - vmin) &lt;= 10.</span>
</span><span id="plot_map-1073"><a href="#plot_map-1073"><span class="linenos">1073</span></a><span class="sd">    - If `remove_ata` is True, the colorbar is placed slightly higher to avoid overlap with the map.</span>
</span><span id="plot_map-1074"><a href="#plot_map-1074"><span class="linenos">1074</span></a>
</span><span id="plot_map-1075"><a href="#plot_map-1075"><span class="linenos">1075</span></a><span class="sd">    Raises</span>
</span><span id="plot_map-1076"><a href="#plot_map-1076"><span class="linenos">1076</span></a><span class="sd">    ------</span>
</span><span id="plot_map-1077"><a href="#plot_map-1077"><span class="linenos">1077</span></a><span class="sd">    ValueError</span>
</span><span id="plot_map-1078"><a href="#plot_map-1078"><span class="linenos">1078</span></a><span class="sd">        If both or neither of `dataset` and `netcdf_directory` are provided.</span>
</span><span id="plot_map-1079"><a href="#plot_map-1079"><span class="linenos">1079</span></a><span class="sd">        </span>
</span><span id="plot_map-1080"><a href="#plot_map-1080"><span class="linenos">1080</span></a><span class="sd">    Returns:</span>
</span><span id="plot_map-1081"><a href="#plot_map-1081"><span class="linenos">1081</span></a><span class="sd">    - Axes class of the map.</span>
</span><span id="plot_map-1082"><a href="#plot_map-1082"><span class="linenos">1082</span></a>
</span><span id="plot_map-1083"><a href="#plot_map-1083"><span class="linenos">1083</span></a><span class="sd">    Example</span>
</span><span id="plot_map-1084"><a href="#plot_map-1084"><span class="linenos">1084</span></a><span class="sd">    -------</span>
</span><span id="plot_map-1085"><a href="#plot_map-1085"><span class="linenos">1085</span></a><span class="sd">    &gt;&gt;&gt; plot_map(</span>
</span><span id="plot_map-1086"><a href="#plot_map-1086"><span class="linenos">1086</span></a><span class="sd">    ...     variable=&#39;npp&#39;,</span>
</span><span id="plot_map-1087"><a href="#plot_map-1087"><span class="linenos">1087</span></a><span class="sd">    ...     dataset=ds.isel(time=-1),</span>
</span><span id="plot_map-1088"><a href="#plot_map-1088"><span class="linenos">1088</span></a><span class="sd">    ...     vmin=0,</span>
</span><span id="plot_map-1089"><a href="#plot_map-1089"><span class="linenos">1089</span></a><span class="sd">    ...     vmax=1200,</span>
</span><span id="plot_map-1090"><a href="#plot_map-1090"><span class="linenos">1090</span></a><span class="sd">    ...     extend_max=True,</span>
</span><span id="plot_map-1091"><a href="#plot_map-1091"><span class="linenos">1091</span></a><span class="sd">    ...     color=&#39;Greens&#39;,</span>
</span><span id="plot_map-1092"><a href="#plot_map-1092"><span class="linenos">1092</span></a><span class="sd">    ...     levels=10,</span>
</span><span id="plot_map-1093"><a href="#plot_map-1093"><span class="linenos">1093</span></a><span class="sd">    ...     remove_ata=True,</span>
</span><span id="plot_map-1094"><a href="#plot_map-1094"><span class="linenos">1094</span></a><span class="sd">    ...     title=&#39;Net Primary Productivity&#39;,</span>
</span><span id="plot_map-1095"><a href="#plot_map-1095"><span class="linenos">1095</span></a><span class="sd">    ...     label=&#39;gC/m/year&#39;,</span>
</span><span id="plot_map-1096"><a href="#plot_map-1096"><span class="linenos">1096</span></a><span class="sd">    ...     filename=&#39;npp_map.png&#39;</span>
</span><span id="plot_map-1097"><a href="#plot_map-1097"><span class="linenos">1097</span></a><span class="sd">    ... )</span>
</span><span id="plot_map-1098"><a href="#plot_map-1098"><span class="linenos">1098</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="plot_map-1099"><a href="#plot_map-1099"><span class="linenos">1099</span></a>    
</span><span id="plot_map-1100"><a href="#plot_map-1100"><span class="linenos">1100</span></a>    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">plot_map</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="plot_map-1101"><a href="#plot_map-1101"><span class="linenos">1101</span></a>             <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">extend_min</span><span class="o">=</span><span class="n">extend_min</span><span class="p">,</span> <span class="n">extend_max</span><span class="o">=</span><span class="n">extend_max</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> 
</span><span id="plot_map-1102"><a href="#plot_map-1102"><span class="linenos">1102</span></a>             <span class="n">out_bound</span><span class="o">=</span><span class="n">out_bound</span><span class="p">,</span> <span class="n">remove_ata</span><span class="o">=</span><span class="n">remove_ata</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">)</span>
</span><span id="plot_map-1103"><a href="#plot_map-1103"><span class="linenos">1103</span></a>    <span class="k">return</span> <span class="n">ax</span>
</span></pre></div>


            <div class="docstring"><p>Plots a 2D map of a variable from an xarray Dataset or NetCDF file with customizable colorbar, projection, and map appearance.</p>

<h2 id="parameters">Parameters</h2>

<p>variable : str
    Name of the variable in the xarray Dataset to plot.
dataset : xarray.Dataset, or str
    xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.
color : str, default 'hot_r'
    Matplotlib colormap name for the plot (discrete color scale).
title : str, default ''
    Title of the map.
label : str, default ''
    Label for the colorbar.
vmin : float, optional
    Minimum data value for the colorbar range. If not provided, the minimum of the variable is used.
vmax : float, optional
    Maximum data value for the colorbar range. If not provided, the maximum of the variable is used.
extend_min : bool, default False
    If True, includes values below <code>vmin</code> in the first color class and shows a left arrow on the colorbar.
extend_max : bool, default False
    If True, includes values above <code>vmax</code> in the last color class and shows a right arrow on the colorbar.
levels : int or list of float, default 10
    Either the number of color intervals or a list of explicit interval boundaries.
out_bound : bool, default True
    Whether to display the outer boundary (spine) of the map projection.
remove_ata : bool, default False
    If True, removes Antarctica from the map by excluding data below 60S latitude.
output_dir : str, optional
    Directory path to save the output figure. If not provided, the figure is saved in the current working directory.
filename : str, optional
    Filename (with extension) for saving the figure. If not provided, the plot is saved as "output_plot.png".
show: bool, True
    Whether or not show the map</p>

<h2 id="notes">Notes</h2>

<ul>
<li>If both <code>extend_min</code> and <code>extend_max</code> are False, the dataset is clipped strictly within [vmin, vmax].</li>
<li>The colorbar will use arrows to indicate out-of-bound values only if <code>extend_min</code> or <code>extend_max</code> is True.</li>
<li>Tick formatting on the colorbar is:
<ul>
<li>Two decimal places if (vmax - vmin) &lt;= 10.</li>
</ul></li>
<li>If <code>remove_ata</code> is True, the colorbar is placed slightly higher to avoid overlap with the map.</li>
</ul>

<h2 id="raises">Raises</h2>

<p>ValueError
    If both or neither of <code>dataset</code> and <code>netcdf_directory</code> are provided.</p>

<p>Returns:</p>

<ul>
<li>Axes class of the map.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">plot_map</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">variable</span><span class="o">=</span><span class="s1">&#39;npp&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">vmax</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">extend_max</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">remove_ata</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Net Primary Productivity&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;gC/m/year&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;npp_map.png&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="plot_country">
                            <input id="plot_country-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_country</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">tabular_file</span>,</span><span class="param">	<span class="n">column</span>,</span><span class="param">	<span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span>,</span><span class="param">	<span class="n">levels</span><span class="o">=</span><span class="mi">10</span>,</span><span class="param">	<span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">filename</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">remove_ata</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">out_bound</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">vmin</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">vmax</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">extend_min</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">extend_max</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="plot_country-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_country"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_country-1105"><a href="#plot_country-1105"><span class="linenos">1105</span></a><span class="k">def</span> <span class="nf">plot_country</span><span class="p">(</span><span class="n">tabular_file</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove_ata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out_bound</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extend_min</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extend_max</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="plot_country-1106"><a href="#plot_country-1106"><span class="linenos">1106</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="plot_country-1107"><a href="#plot_country-1107"><span class="linenos">1107</span></a><span class="sd">    Plots a choropleth map of countries using a specified data column and a world shapefile.</span>
</span><span id="plot_country-1108"><a href="#plot_country-1108"><span class="linenos">1108</span></a>
</span><span id="plot_country-1109"><a href="#plot_country-1109"><span class="linenos">1109</span></a><span class="sd">    Parameters:</span>
</span><span id="plot_country-1110"><a href="#plot_country-1110"><span class="linenos">1110</span></a><span class="sd">    -----------</span>
</span><span id="plot_country-1111"><a href="#plot_country-1111"><span class="linenos">1111</span></a><span class="sd">    - tabular_file : pandas.DataFrame or str</span>
</span><span id="plot_country-1112"><a href="#plot_country-1112"><span class="linenos">1112</span></a><span class="sd">        Input table containing country-level data. Can be either:</span>
</span><span id="plot_country-1113"><a href="#plot_country-1113"><span class="linenos">1113</span></a><span class="sd">        - A pandas DataFrame with the required `column`</span>
</span><span id="plot_country-1114"><a href="#plot_country-1114"><span class="linenos">1114</span></a><span class="sd">        - A string path to a CSV file, which will be automatically read into a DataFrame</span>
</span><span id="plot_country-1115"><a href="#plot_country-1115"><span class="linenos">1115</span></a><span class="sd">    - column : str</span>
</span><span id="plot_country-1116"><a href="#plot_country-1116"><span class="linenos">1116</span></a><span class="sd">        Name of the column in the dataframe to visualize.</span>
</span><span id="plot_country-1117"><a href="#plot_country-1117"><span class="linenos">1117</span></a><span class="sd">    - title : str, optional</span>
</span><span id="plot_country-1118"><a href="#plot_country-1118"><span class="linenos">1118</span></a><span class="sd">        Title of the map. Default is an empty string.</span>
</span><span id="plot_country-1119"><a href="#plot_country-1119"><span class="linenos">1119</span></a><span class="sd">    - label : str, optional</span>
</span><span id="plot_country-1120"><a href="#plot_country-1120"><span class="linenos">1120</span></a><span class="sd">        Label for the colorbar. Default is an empty string.</span>
</span><span id="plot_country-1121"><a href="#plot_country-1121"><span class="linenos">1121</span></a><span class="sd">    - color : str, optional</span>
</span><span id="plot_country-1122"><a href="#plot_country-1122"><span class="linenos">1122</span></a><span class="sd">        Name of the matplotlib colormap to use. Default is &#39;viridis&#39;.</span>
</span><span id="plot_country-1123"><a href="#plot_country-1123"><span class="linenos">1123</span></a><span class="sd">    - levels : int or list of float, optional</span>
</span><span id="plot_country-1124"><a href="#plot_country-1124"><span class="linenos">1124</span></a><span class="sd">        Number of color levels (if int) or list of bin edges (if list). Default is 10.</span>
</span><span id="plot_country-1125"><a href="#plot_country-1125"><span class="linenos">1125</span></a><span class="sd">    - remove_ata : bool, optional</span>
</span><span id="plot_country-1126"><a href="#plot_country-1126"><span class="linenos">1126</span></a><span class="sd">        Whether to remove Antarctica (&#39;ATA&#39;) from the data. Default is False.</span>
</span><span id="plot_country-1127"><a href="#plot_country-1127"><span class="linenos">1127</span></a><span class="sd">    - out_bound : bool, optional</span>
</span><span id="plot_country-1128"><a href="#plot_country-1128"><span class="linenos">1128</span></a><span class="sd">        Whether to display map boundaries (spines). Default is True.</span>
</span><span id="plot_country-1129"><a href="#plot_country-1129"><span class="linenos">1129</span></a><span class="sd">    - vmin : float or None, optional</span>
</span><span id="plot_country-1130"><a href="#plot_country-1130"><span class="linenos">1130</span></a><span class="sd">        Minimum value for the colormap. If None, calculated from the data.</span>
</span><span id="plot_country-1131"><a href="#plot_country-1131"><span class="linenos">1131</span></a><span class="sd">    - vmax : float or None, optional</span>
</span><span id="plot_country-1132"><a href="#plot_country-1132"><span class="linenos">1132</span></a><span class="sd">        Maximum value for the colormap. If None, calculated from the data.</span>
</span><span id="plot_country-1133"><a href="#plot_country-1133"><span class="linenos">1133</span></a><span class="sd">    - extend_min : bool, optional</span>
</span><span id="plot_country-1134"><a href="#plot_country-1134"><span class="linenos">1134</span></a><span class="sd">        Whether to extend the colorbar below `vmin`. Default is False.</span>
</span><span id="plot_country-1135"><a href="#plot_country-1135"><span class="linenos">1135</span></a><span class="sd">    - extend_max : bool, optional</span>
</span><span id="plot_country-1136"><a href="#plot_country-1136"><span class="linenos">1136</span></a><span class="sd">        Whether to extend the colorbar above `vmax`. Default is False.</span>
</span><span id="plot_country-1137"><a href="#plot_country-1137"><span class="linenos">1137</span></a><span class="sd">    - output_dir : str, optional</span>
</span><span id="plot_country-1138"><a href="#plot_country-1138"><span class="linenos">1138</span></a><span class="sd">        Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</span>
</span><span id="plot_country-1139"><a href="#plot_country-1139"><span class="linenos">1139</span></a><span class="sd">    - filename : str, optional</span>
</span><span id="plot_country-1140"><a href="#plot_country-1140"><span class="linenos">1140</span></a><span class="sd">        Filename (with extension) for saving the figure. If not provided, the plot is saved as &quot;output_country_plot.png&quot;.</span>
</span><span id="plot_country-1141"><a href="#plot_country-1141"><span class="linenos">1141</span></a>
</span><span id="plot_country-1142"><a href="#plot_country-1142"><span class="linenos">1142</span></a><span class="sd">    Raises:</span>
</span><span id="plot_country-1143"><a href="#plot_country-1143"><span class="linenos">1143</span></a><span class="sd">    -------</span>
</span><span id="plot_country-1144"><a href="#plot_country-1144"><span class="linenos">1144</span></a><span class="sd">    ValueError</span>
</span><span id="plot_country-1145"><a href="#plot_country-1145"><span class="linenos">1145</span></a><span class="sd">        If neither `dataframe` nor `csv_path` is provided, or if both are provided.</span>
</span><span id="plot_country-1146"><a href="#plot_country-1146"><span class="linenos">1146</span></a>
</span><span id="plot_country-1147"><a href="#plot_country-1147"><span class="linenos">1147</span></a><span class="sd">    Returns:</span>
</span><span id="plot_country-1148"><a href="#plot_country-1148"><span class="linenos">1148</span></a><span class="sd">    --------</span>
</span><span id="plot_country-1149"><a href="#plot_country-1149"><span class="linenos">1149</span></a><span class="sd">    - None, displays the map and optionally saves it to a file.</span>
</span><span id="plot_country-1150"><a href="#plot_country-1150"><span class="linenos">1150</span></a>
</span><span id="plot_country-1151"><a href="#plot_country-1151"><span class="linenos">1151</span></a><span class="sd">    Example</span>
</span><span id="plot_country-1152"><a href="#plot_country-1152"><span class="linenos">1152</span></a><span class="sd">    -------</span>
</span><span id="plot_country-1153"><a href="#plot_country-1153"><span class="linenos">1153</span></a><span class="sd">    &gt;&gt;&gt; plot_country(tabular_file=&quot;country_data.csv&quot;, </span>
</span><span id="plot_country-1154"><a href="#plot_country-1154"><span class="linenos">1154</span></a><span class="sd">    ...             column=&quot;population&quot;, </span>
</span><span id="plot_country-1155"><a href="#plot_country-1155"><span class="linenos">1155</span></a><span class="sd">    ...             title=&quot;Population of Countries&quot;, </span>
</span><span id="plot_country-1156"><a href="#plot_country-1156"><span class="linenos">1156</span></a><span class="sd">    ...             label=&quot;Population&quot;, </span>
</span><span id="plot_country-1157"><a href="#plot_country-1157"><span class="linenos">1157</span></a><span class="sd">    ...             color=&#39;viridis&#39;</span>
</span><span id="plot_country-1158"><a href="#plot_country-1158"><span class="linenos">1158</span></a><span class="sd">    ... )</span>
</span><span id="plot_country-1159"><a href="#plot_country-1159"><span class="linenos">1159</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="plot_country-1160"><a href="#plot_country-1160"><span class="linenos">1160</span></a>
</span><span id="plot_country-1161"><a href="#plot_country-1161"><span class="linenos">1161</span></a>    <span class="n">plot</span><span class="o">.</span><span class="n">plot_country</span><span class="p">(</span><span class="n">tabular_file</span><span class="o">=</span><span class="n">tabular_file</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">column</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">remove_ata</span><span class="o">=</span><span class="n">remove_ata</span><span class="p">,</span> <span class="n">out_bound</span><span class="o">=</span><span class="n">out_bound</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">extend_min</span><span class="o">=</span><span class="n">extend_min</span><span class="p">,</span> <span class="n">extend_max</span><span class="o">=</span><span class="n">extend_max</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Plots a choropleth map of countries using a specified data column and a world shapefile.</p>

<h2 id="parameters">Parameters:</h2>

<ul>
<li>tabular_file : pandas.DataFrame or str
Input table containing country-level data. Can be either:
<ul>
<li>A pandas DataFrame with the required <code>column</code></li>
<li>A string path to a CSV file, which will be automatically read into a DataFrame</li>
</ul></li>
<li>column : str
Name of the column in the dataframe to visualize.</li>
<li>title : str, optional
Title of the map. Default is an empty string.</li>
<li>label : str, optional
Label for the colorbar. Default is an empty string.</li>
<li>color : str, optional
Name of the matplotlib colormap to use. Default is 'viridis'.</li>
<li>levels : int or list of float, optional
Number of color levels (if int) or list of bin edges (if list). Default is 10.</li>
<li>remove_ata : bool, optional
Whether to remove Antarctica ('ATA') from the data. Default is False.</li>
<li>out_bound : bool, optional
Whether to display map boundaries (spines). Default is True.</li>
<li>vmin : float or None, optional
Minimum value for the colormap. If None, calculated from the data.</li>
<li>vmax : float or None, optional
Maximum value for the colormap. If None, calculated from the data.</li>
<li>extend_min : bool, optional
Whether to extend the colorbar below <code>vmin</code>. Default is False.</li>
<li>extend_max : bool, optional
Whether to extend the colorbar above <code>vmax</code>. Default is False.</li>
<li>output_dir : str, optional
Directory path to save the output figure. If not provided, the figure is saved in the current working directory.</li>
<li>filename : str, optional
Filename (with extension) for saving the figure. If not provided, the plot is saved as "output_country_plot.png".</li>
</ul>

<h2 id="raises">Raises:</h2>

<p>ValueError
    If neither <code>dataframe</code> nor <code>csv_path</code> is provided, or if both are provided.</p>

<h2 id="returns">Returns:</h2>

<ul>
<li>None, displays the map and optionally saves it to a file.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">plot_country</span><span class="p">(</span><span class="n">tabular_file</span><span class="o">=</span><span class="s2">&quot;country_data.csv&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;population&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Population of Countries&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Population&quot;</span><span class="p">,</span> 
<span class="gp">... </span>            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="sum_variables">
                            <input id="sum_variables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sum_variables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">dataset</span>, </span><span class="param"><span class="n">variables</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">time</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sum_variables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sum_variables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sum_variables-1163"><a href="#sum_variables-1163"><span class="linenos">1163</span></a><span class="k">def</span> <span class="nf">sum_variables</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="sum_variables-1164"><a href="#sum_variables-1164"><span class="linenos">1164</span></a>
</span><span id="sum_variables-1165"><a href="#sum_variables-1165"><span class="linenos">1165</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="sum_variables-1166"><a href="#sum_variables-1166"><span class="linenos">1166</span></a><span class="sd">    Sum specified variables in the xarray dataset. If no variables are specified, sum all variables</span>
</span><span id="sum_variables-1167"><a href="#sum_variables-1167"><span class="linenos">1167</span></a><span class="sd">    except those starting with &#39;grid_area&#39;. Fill NaNs with zero before summing, and convert resulting</span>
</span><span id="sum_variables-1168"><a href="#sum_variables-1168"><span class="linenos">1168</span></a><span class="sd">    zeros back to NaNs.</span>
</span><span id="sum_variables-1169"><a href="#sum_variables-1169"><span class="linenos">1169</span></a><span class="sd">    </span>
</span><span id="sum_variables-1170"><a href="#sum_variables-1170"><span class="linenos">1170</span></a><span class="sd">    Parameters:</span>
</span><span id="sum_variables-1171"><a href="#sum_variables-1171"><span class="linenos">1171</span></a><span class="sd">    - dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="sum_variables-1172"><a href="#sum_variables-1172"><span class="linenos">1172</span></a><span class="sd">    - variables: list of str, the names of the variables to sum. If None, sum all variables except those starting with &#39;grid_area&#39; and &#39;land_frac&#39;.</span>
</span><span id="sum_variables-1173"><a href="#sum_variables-1173"><span class="linenos">1173</span></a><span class="sd">    - new_variable_name: str, optional, the name of the new variable to store the sum.</span>
</span><span id="sum_variables-1174"><a href="#sum_variables-1174"><span class="linenos">1174</span></a><span class="sd">    - time: optional, a specific time slice to select from the dataset.</span>
</span><span id="sum_variables-1175"><a href="#sum_variables-1175"><span class="linenos">1175</span></a><span class="sd">    </span>
</span><span id="sum_variables-1176"><a href="#sum_variables-1176"><span class="linenos">1176</span></a><span class="sd">    Returns:</span>
</span><span id="sum_variables-1177"><a href="#sum_variables-1177"><span class="linenos">1177</span></a><span class="sd">    - xarray.Dataset, with the summed variable.</span>
</span><span id="sum_variables-1178"><a href="#sum_variables-1178"><span class="linenos">1178</span></a>
</span><span id="sum_variables-1179"><a href="#sum_variables-1179"><span class="linenos">1179</span></a><span class="sd">    Example</span>
</span><span id="sum_variables-1180"><a href="#sum_variables-1180"><span class="linenos">1180</span></a><span class="sd">    -------</span>
</span><span id="sum_variables-1181"><a href="#sum_variables-1181"><span class="linenos">1181</span></a><span class="sd">    &gt;&gt;&gt; sum_variables(dataset=ds, </span>
</span><span id="sum_variables-1182"><a href="#sum_variables-1182"><span class="linenos">1182</span></a><span class="sd">    ...              variables=[&quot;roads_gross&quot;, &quot;buildings_gross&quot;], </span>
</span><span id="sum_variables-1183"><a href="#sum_variables-1183"><span class="linenos">1183</span></a><span class="sd">    ...              new_variable_name=&quot;total_gross&quot;</span>
</span><span id="sum_variables-1184"><a href="#sum_variables-1184"><span class="linenos">1184</span></a><span class="sd">    ... )</span>
</span><span id="sum_variables-1185"><a href="#sum_variables-1185"><span class="linenos">1185</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="sum_variables-1186"><a href="#sum_variables-1186"><span class="linenos">1186</span></a>    
</span><span id="sum_variables-1187"><a href="#sum_variables-1187"><span class="linenos">1187</span></a>    <span class="n">ds</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">sum_variables</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="sum_variables-1188"><a href="#sum_variables-1188"><span class="linenos">1188</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span></pre></div>


            <div class="docstring"><p>Sum specified variables in the xarray dataset. If no variables are specified, sum all variables
except those starting with 'grid_area'. Fill NaNs with zero before summing, and convert resulting
zeros back to NaNs.</p>

<p>Parameters:</p>

<ul>
<li>dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</li>
<li>variables: list of str, the names of the variables to sum. If None, sum all variables except those starting with 'grid_area' and 'land_frac'.</li>
<li>new_variable_name: str, optional, the name of the new variable to store the sum.</li>
<li>time: optional, a specific time slice to select from the dataset.</li>
</ul>

<p>Returns:</p>

<ul>
<li>xarray.Dataset, with the summed variable.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">sum_variables</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> 
<span class="gp">... </span>             <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;roads_gross&quot;</span><span class="p">,</span> <span class="s2">&quot;buildings_gross&quot;</span><span class="p">],</span> 
<span class="gp">... </span>             <span class="n">new_variable_name</span><span class="o">=</span><span class="s2">&quot;total_gross&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="subtract_variables">
                            <input id="subtract_variables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">subtract_variables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">variable1</span>, </span><span class="param"><span class="n">variable2</span>, </span><span class="param"><span class="n">dataset</span>, </span><span class="param"><span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">time</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="subtract_variables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#subtract_variables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="subtract_variables-1190"><a href="#subtract_variables-1190"><span class="linenos">1190</span></a><span class="k">def</span> <span class="nf">subtract_variables</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="subtract_variables-1191"><a href="#subtract_variables-1191"><span class="linenos">1191</span></a><span class="w">    </span>
</span><span id="subtract_variables-1192"><a href="#subtract_variables-1192"><span class="linenos">1192</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="subtract_variables-1193"><a href="#subtract_variables-1193"><span class="linenos">1193</span></a><span class="sd">    Subtract one variable from another in the xarray dataset.</span>
</span><span id="subtract_variables-1194"><a href="#subtract_variables-1194"><span class="linenos">1194</span></a><span class="sd">    Fill NaNs with zero before subtracting, and convert resulting zeros back to NaNs.</span>
</span><span id="subtract_variables-1195"><a href="#subtract_variables-1195"><span class="linenos">1195</span></a><span class="sd">    </span>
</span><span id="subtract_variables-1196"><a href="#subtract_variables-1196"><span class="linenos">1196</span></a><span class="sd">    Parameters:</span>
</span><span id="subtract_variables-1197"><a href="#subtract_variables-1197"><span class="linenos">1197</span></a><span class="sd">    - variable1: str, the name of the variable to subtract from.</span>
</span><span id="subtract_variables-1198"><a href="#subtract_variables-1198"><span class="linenos">1198</span></a><span class="sd">    - variable2: str, the name of the variable to subtract.</span>
</span><span id="subtract_variables-1199"><a href="#subtract_variables-1199"><span class="linenos">1199</span></a><span class="sd">    - dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="subtract_variables-1200"><a href="#subtract_variables-1200"><span class="linenos">1200</span></a><span class="sd">    - new_variable_name: str, optional, the name of the new variable to store the result.</span>
</span><span id="subtract_variables-1201"><a href="#subtract_variables-1201"><span class="linenos">1201</span></a><span class="sd">    - time: optional, a specific time slice to select from the dataset.</span>
</span><span id="subtract_variables-1202"><a href="#subtract_variables-1202"><span class="linenos">1202</span></a><span class="sd">    </span>
</span><span id="subtract_variables-1203"><a href="#subtract_variables-1203"><span class="linenos">1203</span></a><span class="sd">    Returns:</span>
</span><span id="subtract_variables-1204"><a href="#subtract_variables-1204"><span class="linenos">1204</span></a><span class="sd">    - xarray.Dataset, with the resulting variable.</span>
</span><span id="subtract_variables-1205"><a href="#subtract_variables-1205"><span class="linenos">1205</span></a>
</span><span id="subtract_variables-1206"><a href="#subtract_variables-1206"><span class="linenos">1206</span></a><span class="sd">    Example</span>
</span><span id="subtract_variables-1207"><a href="#subtract_variables-1207"><span class="linenos">1207</span></a><span class="sd">    -------</span>
</span><span id="subtract_variables-1208"><a href="#subtract_variables-1208"><span class="linenos">1208</span></a><span class="sd">    &gt;&gt;&gt; subtract_variables(variable1=&quot;precipitation&quot;, </span>
</span><span id="subtract_variables-1209"><a href="#subtract_variables-1209"><span class="linenos">1209</span></a><span class="sd">    ...                   variable2=&quot;evaporation&quot;, </span>
</span><span id="subtract_variables-1210"><a href="#subtract_variables-1210"><span class="linenos">1210</span></a><span class="sd">    ...                   dataset=ds, </span>
</span><span id="subtract_variables-1211"><a href="#subtract_variables-1211"><span class="linenos">1211</span></a><span class="sd">    ...                   new_variable_name=&quot;net_water_gain&quot;</span>
</span><span id="subtract_variables-1212"><a href="#subtract_variables-1212"><span class="linenos">1212</span></a><span class="sd">    ... )</span>
</span><span id="subtract_variables-1213"><a href="#subtract_variables-1213"><span class="linenos">1213</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="subtract_variables-1214"><a href="#subtract_variables-1214"><span class="linenos">1214</span></a>    <span class="n">ds</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">subtract_variables</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="subtract_variables-1215"><a href="#subtract_variables-1215"><span class="linenos">1215</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span></pre></div>


            <div class="docstring"><p>Subtract one variable from another in the xarray dataset.
Fill NaNs with zero before subtracting, and convert resulting zeros back to NaNs.</p>

<p>Parameters:</p>

<ul>
<li>variable1: str, the name of the variable to subtract from.</li>
<li>variable2: str, the name of the variable to subtract.</li>
<li>dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</li>
<li>new_variable_name: str, optional, the name of the new variable to store the result.</li>
<li>time: optional, a specific time slice to select from the dataset.</li>
</ul>

<p>Returns:</p>

<ul>
<li>xarray.Dataset, with the resulting variable.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">subtract_variables</span><span class="p">(</span><span class="n">variable1</span><span class="o">=</span><span class="s2">&quot;precipitation&quot;</span><span class="p">,</span> 
<span class="gp">... </span>                  <span class="n">variable2</span><span class="o">=</span><span class="s2">&quot;evaporation&quot;</span><span class="p">,</span> 
<span class="gp">... </span>                  <span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> 
<span class="gp">... </span>                  <span class="n">new_variable_name</span><span class="o">=</span><span class="s2">&quot;net_water_gain&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="divide_variables">
                            <input id="divide_variables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">divide_variables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">variable1</span>, </span><span class="param"><span class="n">variable2</span>, </span><span class="param"><span class="n">dataset</span>, </span><span class="param"><span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">time</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="divide_variables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#divide_variables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="divide_variables-1217"><a href="#divide_variables-1217"><span class="linenos">1217</span></a><span class="k">def</span> <span class="nf">divide_variables</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="divide_variables-1218"><a href="#divide_variables-1218"><span class="linenos">1218</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="divide_variables-1219"><a href="#divide_variables-1219"><span class="linenos">1219</span></a><span class="sd">    Divide one variable by another in the xarray dataset.</span>
</span><span id="divide_variables-1220"><a href="#divide_variables-1220"><span class="linenos">1220</span></a><span class="sd">    Fill NaNs with zero before dividing, and convert resulting zeros back to NaNs.</span>
</span><span id="divide_variables-1221"><a href="#divide_variables-1221"><span class="linenos">1221</span></a><span class="sd">    </span>
</span><span id="divide_variables-1222"><a href="#divide_variables-1222"><span class="linenos">1222</span></a><span class="sd">    Parameters:</span>
</span><span id="divide_variables-1223"><a href="#divide_variables-1223"><span class="linenos">1223</span></a><span class="sd">    - variable1: str, the name of the variable to be divided (numerator).</span>
</span><span id="divide_variables-1224"><a href="#divide_variables-1224"><span class="linenos">1224</span></a><span class="sd">    - variable2: str, the name of the variable to divide by (denominator).</span>
</span><span id="divide_variables-1225"><a href="#divide_variables-1225"><span class="linenos">1225</span></a><span class="sd">    - dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="divide_variables-1226"><a href="#divide_variables-1226"><span class="linenos">1226</span></a><span class="sd">    - new_variable_name: str, optional, the name of the new variable to store the result.</span>
</span><span id="divide_variables-1227"><a href="#divide_variables-1227"><span class="linenos">1227</span></a><span class="sd">    - time: optional, a specific time slice to select from the dataset.</span>
</span><span id="divide_variables-1228"><a href="#divide_variables-1228"><span class="linenos">1228</span></a><span class="sd">    </span>
</span><span id="divide_variables-1229"><a href="#divide_variables-1229"><span class="linenos">1229</span></a><span class="sd">    Returns:</span>
</span><span id="divide_variables-1230"><a href="#divide_variables-1230"><span class="linenos">1230</span></a><span class="sd">    - xarray.Dataset, with the resulting variable.</span>
</span><span id="divide_variables-1231"><a href="#divide_variables-1231"><span class="linenos">1231</span></a>
</span><span id="divide_variables-1232"><a href="#divide_variables-1232"><span class="linenos">1232</span></a><span class="sd">    Example</span>
</span><span id="divide_variables-1233"><a href="#divide_variables-1233"><span class="linenos">1233</span></a><span class="sd">    -------</span>
</span><span id="divide_variables-1234"><a href="#divide_variables-1234"><span class="linenos">1234</span></a><span class="sd">    &gt;&gt;&gt; divide_variables(variable1=&quot;roads_gross&quot;, </span>
</span><span id="divide_variables-1235"><a href="#divide_variables-1235"><span class="linenos">1235</span></a><span class="sd">    ...                  variable2=&quot;grid_area&quot;, </span>
</span><span id="divide_variables-1236"><a href="#divide_variables-1236"><span class="linenos">1236</span></a><span class="sd">    ...                  dataset=ds, </span>
</span><span id="divide_variables-1237"><a href="#divide_variables-1237"><span class="linenos">1237</span></a><span class="sd">    ...                  new_variable_name=&quot;road_density&quot;</span>
</span><span id="divide_variables-1238"><a href="#divide_variables-1238"><span class="linenos">1238</span></a><span class="sd">    ... )</span>
</span><span id="divide_variables-1239"><a href="#divide_variables-1239"><span class="linenos">1239</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="divide_variables-1240"><a href="#divide_variables-1240"><span class="linenos">1240</span></a>    <span class="n">ds</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">divide_variables</span><span class="p">(</span><span class="n">variable1</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="divide_variables-1241"><a href="#divide_variables-1241"><span class="linenos">1241</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span></pre></div>


            <div class="docstring"><p>Divide one variable by another in the xarray dataset.
Fill NaNs with zero before dividing, and convert resulting zeros back to NaNs.</p>

<p>Parameters:</p>

<ul>
<li>variable1: str, the name of the variable to be divided (numerator).</li>
<li>variable2: str, the name of the variable to divide by (denominator).</li>
<li>dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</li>
<li>new_variable_name: str, optional, the name of the new variable to store the result.</li>
<li>time: optional, a specific time slice to select from the dataset.</li>
</ul>

<p>Returns:</p>

<ul>
<li>xarray.Dataset, with the resulting variable.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">divide_variables</span><span class="p">(</span><span class="n">variable1</span><span class="o">=</span><span class="s2">&quot;roads_gross&quot;</span><span class="p">,</span> 
<span class="gp">... </span>                 <span class="n">variable2</span><span class="o">=</span><span class="s2">&quot;grid_area&quot;</span><span class="p">,</span> 
<span class="gp">... </span>                 <span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> 
<span class="gp">... </span>                 <span class="n">new_variable_name</span><span class="o">=</span><span class="s2">&quot;road_density&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="multiply_variables">
                            <input id="multiply_variables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">multiply_variables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">dataset</span>, </span><span class="param"><span class="n">variables</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">time</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="multiply_variables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#multiply_variables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="multiply_variables-1243"><a href="#multiply_variables-1243"><span class="linenos">1243</span></a><span class="k">def</span> <span class="nf">multiply_variables</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="multiply_variables-1244"><a href="#multiply_variables-1244"><span class="linenos">1244</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="multiply_variables-1245"><a href="#multiply_variables-1245"><span class="linenos">1245</span></a><span class="sd">    Multiply specified variables in the xarray dataset. If no variables are specified, multiply all variables.</span>
</span><span id="multiply_variables-1246"><a href="#multiply_variables-1246"><span class="linenos">1246</span></a><span class="sd">    Fill NaNs with one before multiplying, and convert resulting ones back to NaNs.</span>
</span><span id="multiply_variables-1247"><a href="#multiply_variables-1247"><span class="linenos">1247</span></a><span class="sd">    </span>
</span><span id="multiply_variables-1248"><a href="#multiply_variables-1248"><span class="linenos">1248</span></a><span class="sd">    Parameters:</span>
</span><span id="multiply_variables-1249"><a href="#multiply_variables-1249"><span class="linenos">1249</span></a><span class="sd">    - dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="multiply_variables-1250"><a href="#multiply_variables-1250"><span class="linenos">1250</span></a><span class="sd">    - variables: list of str, the names of the variables to multiply. If None, multiply all variables, excluding the &quot;grid_area&quot; and &quot;land_frac&quot; variables included in the dataset.</span>
</span><span id="multiply_variables-1251"><a href="#multiply_variables-1251"><span class="linenos">1251</span></a><span class="sd">    - new_variable_name: str, optional, the name of the new variable to store the product.</span>
</span><span id="multiply_variables-1252"><a href="#multiply_variables-1252"><span class="linenos">1252</span></a><span class="sd">    - time: optional, a specific time slice to select from the dataset.</span>
</span><span id="multiply_variables-1253"><a href="#multiply_variables-1253"><span class="linenos">1253</span></a><span class="sd">    </span>
</span><span id="multiply_variables-1254"><a href="#multiply_variables-1254"><span class="linenos">1254</span></a><span class="sd">    Returns:</span>
</span><span id="multiply_variables-1255"><a href="#multiply_variables-1255"><span class="linenos">1255</span></a><span class="sd">    - xarray.Dataset, with the resulting variable.</span>
</span><span id="multiply_variables-1256"><a href="#multiply_variables-1256"><span class="linenos">1256</span></a>
</span><span id="multiply_variables-1257"><a href="#multiply_variables-1257"><span class="linenos">1257</span></a><span class="sd">    Example</span>
</span><span id="multiply_variables-1258"><a href="#multiply_variables-1258"><span class="linenos">1258</span></a><span class="sd">    -------</span>
</span><span id="multiply_variables-1259"><a href="#multiply_variables-1259"><span class="linenos">1259</span></a><span class="sd">    &gt;&gt;&gt; multiply_variables(</span>
</span><span id="multiply_variables-1260"><a href="#multiply_variables-1260"><span class="linenos">1260</span></a><span class="sd">    ...     dataset=ds,</span>
</span><span id="multiply_variables-1261"><a href="#multiply_variables-1261"><span class="linenos">1261</span></a><span class="sd">    ...     variables=[&quot;crop_area&quot;, &quot;yield_per_hectare&quot;],</span>
</span><span id="multiply_variables-1262"><a href="#multiply_variables-1262"><span class="linenos">1262</span></a><span class="sd">    ...     new_variable_name=&quot;total_crop_yield&quot;</span>
</span><span id="multiply_variables-1263"><a href="#multiply_variables-1263"><span class="linenos">1263</span></a><span class="sd">    ... )</span>
</span><span id="multiply_variables-1264"><a href="#multiply_variables-1264"><span class="linenos">1264</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="multiply_variables-1265"><a href="#multiply_variables-1265"><span class="linenos">1265</span></a>    
</span><span id="multiply_variables-1266"><a href="#multiply_variables-1266"><span class="linenos">1266</span></a>    <span class="n">ds</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">multiply_variables</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="multiply_variables-1267"><a href="#multiply_variables-1267"><span class="linenos">1267</span></a>    
</span><span id="multiply_variables-1268"><a href="#multiply_variables-1268"><span class="linenos">1268</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span></pre></div>


            <div class="docstring"><p>Multiply specified variables in the xarray dataset. If no variables are specified, multiply all variables.
Fill NaNs with one before multiplying, and convert resulting ones back to NaNs.</p>

<p>Parameters:</p>

<ul>
<li>dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</li>
<li>variables: list of str, the names of the variables to multiply. If None, multiply all variables, excluding the "grid_area" and "land_frac" variables included in the dataset.</li>
<li>new_variable_name: str, optional, the name of the new variable to store the product.</li>
<li>time: optional, a specific time slice to select from the dataset.</li>
</ul>

<p>Returns:</p>

<ul>
<li>xarray.Dataset, with the resulting variable.</li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">multiply_variables</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;crop_area&quot;</span><span class="p">,</span> <span class="s2">&quot;yield_per_hectare&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">new_variable_name</span><span class="o">=</span><span class="s2">&quot;total_crop_yield&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="average_variables">
                            <input id="average_variables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">average_variables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">dataset</span>, </span><span class="param"><span class="n">variables</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">time</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="average_variables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#average_variables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="average_variables-1270"><a href="#average_variables-1270"><span class="linenos">1270</span></a><span class="k">def</span> <span class="nf">average_variables</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="average_variables-1271"><a href="#average_variables-1271"><span class="linenos">1271</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="average_variables-1272"><a href="#average_variables-1272"><span class="linenos">1272</span></a><span class="sd">    Average specified variables in the xarray dataset. If no variables are specified, average all variables</span>
</span><span id="average_variables-1273"><a href="#average_variables-1273"><span class="linenos">1273</span></a><span class="sd">    except those starting with &#39;grid_area&#39;. Fill NaNs with zero before averaging, and convert resulting</span>
</span><span id="average_variables-1274"><a href="#average_variables-1274"><span class="linenos">1274</span></a><span class="sd">    zeros back to NaNs.</span>
</span><span id="average_variables-1275"><a href="#average_variables-1275"><span class="linenos">1275</span></a><span class="sd">    </span>
</span><span id="average_variables-1276"><a href="#average_variables-1276"><span class="linenos">1276</span></a><span class="sd">    Parameters:</span>
</span><span id="average_variables-1277"><a href="#average_variables-1277"><span class="linenos">1277</span></a><span class="sd">    - dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</span>
</span><span id="average_variables-1278"><a href="#average_variables-1278"><span class="linenos">1278</span></a><span class="sd">    - variables: list of str, the names of the variables to average. If None, average all variables except those starting with &#39;grid_area&#39; and &#39;land_frac&#39;.</span>
</span><span id="average_variables-1279"><a href="#average_variables-1279"><span class="linenos">1279</span></a><span class="sd">    - new_variable_name: str, optional, the name of the new variable to store the average.</span>
</span><span id="average_variables-1280"><a href="#average_variables-1280"><span class="linenos">1280</span></a><span class="sd">    - time: optional, a specific time slice to select from the dataset.</span>
</span><span id="average_variables-1281"><a href="#average_variables-1281"><span class="linenos">1281</span></a><span class="sd">    </span>
</span><span id="average_variables-1282"><a href="#average_variables-1282"><span class="linenos">1282</span></a><span class="sd">    Returns:</span>
</span><span id="average_variables-1283"><a href="#average_variables-1283"><span class="linenos">1283</span></a><span class="sd">    - xarray.Dataset, with the averaged variable.</span>
</span><span id="average_variables-1284"><a href="#average_variables-1284"><span class="linenos">1284</span></a>
</span><span id="average_variables-1285"><a href="#average_variables-1285"><span class="linenos">1285</span></a><span class="sd">        Example</span>
</span><span id="average_variables-1286"><a href="#average_variables-1286"><span class="linenos">1286</span></a><span class="sd">    -------</span>
</span><span id="average_variables-1287"><a href="#average_variables-1287"><span class="linenos">1287</span></a><span class="sd">    &gt;&gt;&gt; average_variables(dataset=ds, </span>
</span><span id="average_variables-1288"><a href="#average_variables-1288"><span class="linenos">1288</span></a><span class="sd">    ...                  variables=[&quot;roads_gross&quot;, &quot;buildings_gross&quot;], </span>
</span><span id="average_variables-1289"><a href="#average_variables-1289"><span class="linenos">1289</span></a><span class="sd">    ...                  new_variable_name=&quot;average_gross&quot;</span>
</span><span id="average_variables-1290"><a href="#average_variables-1290"><span class="linenos">1290</span></a><span class="sd">    ... )</span>
</span><span id="average_variables-1291"><a href="#average_variables-1291"><span class="linenos">1291</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="average_variables-1292"><a href="#average_variables-1292"><span class="linenos">1292</span></a>    <span class="n">ds</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">average_variables</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">new_variable_name</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="average_variables-1293"><a href="#average_variables-1293"><span class="linenos">1293</span></a>    <span class="k">return</span> <span class="n">ds</span>
</span></pre></div>


            <div class="docstring"><p>Average specified variables in the xarray dataset. If no variables are specified, average all variables
except those starting with 'grid_area'. Fill NaNs with zero before averaging, and convert resulting
zeros back to NaNs.</p>

<p>Parameters:</p>

<ul>
<li>dataset: xarray.Dataset, or str, xarray dataset or a path to a NetCDF file. If a file path is provided, it will be automatically loaded into an xarray.Dataset.</li>
<li>variables: list of str, the names of the variables to average. If None, average all variables except those starting with 'grid_area' and 'land_frac'.</li>
<li>new_variable_name: str, optional, the name of the new variable to store the average.</li>
<li>time: optional, a specific time slice to select from the dataset.</li>
</ul>

<p>Returns:</p>

<ul>
<li>xarray.Dataset, with the averaged variable.</li>
</ul>

<h2 id="example">    Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">average_variables</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> 
<span class="gp">... </span>                 <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;roads_gross&quot;</span><span class="p">,</span> <span class="s2">&quot;buildings_gross&quot;</span><span class="p">],</span> 
<span class="gp">... </span>                 <span class="n">new_variable_name</span><span class="o">=</span><span class="s2">&quot;average_gross&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
    </main>
</body>
</html>